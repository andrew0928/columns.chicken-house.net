# Hash 的妙用

## 摘要提示
- 雜湊概念: Hash 是將任意資料映射為固定長度數值的數學函數，要求不可逆且分布均勻。
- 隨機性要求: 輸出越亂、越難預測越好，避免被人從結果推回原始資料。
- 生活化範例: 身分證最後一碼可視為簡單的雜湊檢查機制，用來驗證編號正確性。
- 常見演算法: MD5、SHA、SHA256、SHA512 等支援對檔案與任意二進位資料做固定長度摘要。
- 密碼安全: 儲存密碼時以雜湊值替代明文，降低資料庫外洩風險。
- 檔案比對: 以雜湊快速判斷兩份檔案是否相同，或在大量檔案中找出重複內容。
- 數位簽章: 用於檢查資料完整性，確保傳輸或儲存過程未被竄改。
- 資料防竄改: 用在 Cookie 或 URL query string 上，保護曝露在外的參數不被修改。
- 實務價值: 在公司系統開發中多處落地應用，顯示雜湊的通用性與高實用性。
- 創意空間: 應用幾乎只受限於想像力，仍有許多可延伸與深化的情境。

## 全文重點
本文以開發者在企業系統中實務使用雜湊演算法的經驗出發，指出好的 Hash（雜湊）演算法用途廣泛，關鍵價值在於能把任意資料透過數學函數轉換成固定長度的「摘要」。理想的雜湊輸出需具備高度隨機性與不可逆性：不同輸入應產生不可預測、分布均勻的結果，且無法從雜湊值反推出原始資料。作者用身分證字號最後一碼作為生活化例子，說明雜湊或檢查碼能用來驗證資料是否合理或是否被亂填。進一步，文章介紹常見且成熟的雜湊演算法，如 MD5、SHA 家族（含 SHA256、SHA512），強調它們可對任意二進位資料（含整個檔案）計算固定長度摘要。

在實務應用面，作者列出四大典型場景。第一是密碼儲存：以雜湊值取代明文，避免資料庫外洩時直接暴露密碼；（在更進階實務中，常會加入 salt 與多次迭代，但本文未深入）。第二是檔案比對：藉由計算檔案雜湊可迅速判斷兩份檔案是否相同，並在大量檔案中鎖定重複內容，提升存儲與備份管理效率。第三是數位簽章與完整性驗證：利用雜湊檢查資料在傳輸或儲存過程是否遭修改。第四是對外曝露資訊的防竄改，例如在 Cookie 或 URL query string 附上雜湊簽章，防止參數被未授權變更。作者強調這些都是實際在公司系統中落地的場景，顯示雜湊演算法的實用性不只在理論層面，更可解決日常工程問題。

文章最後以輕鬆語氣收束，指出雜湊的應用遠不止於此，幾乎只受限於想像力；雖然篇幅有限，但已點出核心思想與典型用例，為後續更深入的技術分享埋下伏筆。

## 段落重點
### 雜湊演算法的本質與設計目標
作者先以「Hash(X) = …」的直白方式說明雜湊本質：將輸入資料透過函數轉為固定長度的輸出。理想雜湊的目標包括不可逆性（無法由輸出還原輸入）、輸出分布均勻且難以預測（降低碰撞與被利用的機率）。這些性質是雜湊能被廣泛採用的基礎，因為只有在難以預測且難以逆推時，雜湊值才具備安全與可靠的檢核功能。

### 生活化範例：身分證檢查碼
為降低抽象度，作者以身分證字號最後一碼為例，將其視為一種簡化的雜湊或檢查碼機制。透過前面字母與數字依規則計算出最後一位，可用來驗證整段編號是否合理、是否被亂填。雖然這並非嚴格意義上的安全雜湊，但足以說明雜湊在「檢核正確性」上的實用價值與直觀用途。

### 常見演算法與輸入輸出特性
作者列舉 MD5、SHA、SHA256、SHA512 等常見演算法，並強調其能處理任意二進位資料（包含整個檔案），最終輸出固定長度的摘要。固定長度輸出讓比對與存放更有效率；同時，成熟演算法在實務中有廣泛實作與工具支援，便於快速落地與整合。

### 四大實務應用場景
- 密碼儲存：以雜湊替代明文，降低資料庫外洩風險（常見的強化方式包括加鹽與多次迭代，本文點到為止）。
- 檔案比對與去重：透過雜湊值快速判斷檔案是否相同，在大量檔案中找出重複內容，提升資源管理效率。
- 數位簽章與完整性：用雜湊驗證資料有無被修改，確保傳輸與儲存過程的可信性。
- 對外資料防竄改：對 Cookie 或 URL query string 加上雜湊簽章，防止被未授權變更。

### 收束與展望：應用只受限於想像力
作者以親身在公司系統中的實作經驗背書雜湊的價值，並以輕鬆語氣收尾，指出本文只是拋磚引玉，更多進階應用與細節尚待展開。中心訊息是：雜湊不僅是理論概念，而是能解決多種工程問題的通用工具，其應用廣度深受創意與需求所驅動。

## 資訊整理

### 知識架構圖
1. 前置知識：
   - 基本資訊安全概念（機密性、完整性、不可否認性）
   - 數位資料表示（位元/位元組、字元編碼、二進位/十六進位）
   - 基本數學與函數概念（單向函數、機率）
   - 常見攻擊模型（碰撞攻擊、字典攻擊、彩虹表）

2. 核心概念：
   - 雜湊函數：輸入任意長度資料，輸出固定長度摘要，且難以反推原文
   - 安全性性質：抗碰撞、抗第二原像、抗原像
   - 常見演算法：MD5、SHA-1、SHA-256、SHA-512（新案場偏向 SHA-2/3）
   - 應用模式：密碼雜湊（含鹽/多次迭代）、檔案指紋、數位簽章前置摘要、訊息驗證碼（HMAC）
   - 完整性保護：利用雜湊或 HMAC 確保資料未被竄改（例如 cookie、URL 簽名）

3. 技術依賴：
   - 密碼雜湊 → 需搭配 Salt/Key-stretching（PBKDF2、bcrypt、scrypt、Argon2）
   - 數位簽章 → 需搭配非對稱加密（RSA/ECDSA/EdDSA）與雜湊（SHA-256 等）
   - 完整性與認證 → 需 HMAC（需共享密鑰）或簽章（私鑰）
   - 檔案比對/去重 → 依賴高速雜湊與檔案讀取 I/O
   - URL/cookie 防竄改 → 依賴祕密金鑰與安全鍵管控

4. 應用場景：
   - 以雜湊儲存密碼，避免明文外洩
   - 以雜湊快速判斷檔案是否相同、重複資料清理
   - 數位簽章流程中的訊息摘要，確保完整性
   - 對外曝露資訊（cookie、Query String、下載連結）加上 HMAC/簽名，防止竄改
   - 軟體發布與下載檔案提供雜湊值供驗證
   - 快速資料比對、快取鍵生成、分片/分桶（hash-based sharding）

### 學習路徑建議
1. 入門者路徑：
   - 了解雜湊基本性質與用途（單向性、固定長度、抗碰撞）
   - 實作工具練習：用 sha256sum、openssl dgst 或程式語言標準庫計算檔案/字串雜湊
   - 認識常見演算法差異與淘汰歷史（MD5/SHA-1 不建議；SHA-256 起跳）
   - 練習以雜湊比對檔案是否一致

2. 進階者路徑：
   - 學會使用 HMAC（HMAC-SHA256）做訊息完整性驗證（cookies、API 簽名）
   - 密碼儲存最佳實務：Salt、迭代、記憶體硬成本（PBKDF2/bcrypt/scrypt/Argon2）
   - 了解碰撞與原像攻擊案例與風險管理（演算法遴選、版本升級策略）
   - 了解數位簽章流程：Hash → Sign → Verify（與 HMAC 的差異）

3. 實戰路徑：
   - 實作安全的密碼儲存模組（Argon2id/bcrypt，含獨立 Salt、參數調優與遷移）
   - 檔案服務：上傳即計算雜湊，做去重與完整性檢查；提供下載雜湊校驗
   - 為 cookie/URL 加入簽名或 HMAC（含到期時間與重放防護）
   - 在後端日誌、API 請求體做摘要比對，快速檢測變更
   - 規劃演算法升級機制（攔截登入即透明升級雜湊成本）

### 關鍵要點清單
- 雜湊單向性: 無法由輸出反推出輸入，有助防止敏感資料被還原 (優先級: 高)
- 固定長度摘要: 任意長度輸入對應固定長度輸出，便於儲存與比對 (優先級: 中)
- 抗碰撞性: 難以找到不同輸入卻同雜湊的兩筆資料，關係到完整性安全 (優先級: 高)
- MD5/SHA-1 淘汰: 已有實際碰撞案例，不宜用於安全場景 (優先級: 高)
- 推薦演算法: 以 SHA-256/SHA-512 或 SHA-3 家族作為安全預設 (優先級: 高)
- 密碼雜湊≠一般雜湊: 密碼需用專門 KDF（bcrypt/scrypt/Argon2）抗暴力破解 (優先級: 高)
- Salt 的必要性: 為每個密碼加入隨機 Salt，抵抗彩虹表與相同密碼聚類 (優先級: 高)
- 迭代與資源成本: 透過多次迭代與記憶體成本提升破解難度 (優先級: 高)
- HMAC 用途: 以共享密鑰提供完整性與身份驗證，適合 cookie/URL 簽名 (優先級: 高)
- 數位簽章流程: Hash 後以私鑰簽名、公開金鑰驗證，確保完整性與不可否認 (優先級: 高)
- 檔案指紋/去重: 利用雜湊快速比對/去重，注意碰撞風險與二次驗證 (優先級: 中)
- 完整性校驗: 發布下載檔提供雜湊值，供使用者驗證未被竄改 (優先級: 中)
- 鍵管理: HMAC/簽章的安全性取決於密鑰保護與輪替策略 (優先級: 高)
- 雜湊與編碼區別: 雜湊是單向摘要，編碼是可還原的表示法（如 Base64） (優先級: 中)
- 演算法升級策略: 設計可漸進升級（登入時重雜湊）以應對新攻擊 (優先級: 中)