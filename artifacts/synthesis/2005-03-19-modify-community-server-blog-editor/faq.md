# 修改 Community Server 的 blog editor

## 問題與答案 (FAQ)

### Q&A 類別 A: 概念理解類

A-Q1: 什麼是 Community Server？
- A簡: 以 ASP.NET 為基礎的社群/部落格平台，常用包裝層管理編輯器與功能整合。
- A詳: Community Server 是一套建立於 ASP.NET 的社群平台，內含部落格、討論區等功能。其部落格編輯器常採「包裝層」設計，以抽象底層編輯器（如 FreeTextBox）的細節，統一設定、行為與外觀，讓平台能一致管理與替換。但缺少包裝層原始碼時，客製化會受限。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q2, A-Q3, B-Q1

A-Q2: 什麼是 FreeTextBox（FTB）？
- A簡: ASP.NET 的所見即所得編輯器，內建多樣工具列，支援插入圖片與表情符號。
- A詳: FreeTextBox 是早期 ASP.NET 常用的 WYSIWYG 編輯器元件，提供文字格式化、連結、圖片插入、表情符號等工具列項目。可透過屬性或設定檔啟用/隱藏不同工具，並以 JavaScript 與伺服端 API 取得與設定 HTML 內容。其可擴充性高，但在被平台包裝後，直接改動常受限。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q9, A-Q15, B-Q2

A-Q3: 什麼是 Editor Wrapper（編輯器包裝層）？
- A簡: 介於平台與第三方編輯器的中介層，統一設定、事件與替換策略。
- A詳: 編輯器包裝層是一種軟體設計方式，將第三方編輯器隔離在內層，以提供一致的 API、設定入口與視覺樣式。好處是可替換內層編輯器、集中控管與跨模組一致；缺點是若未開放原始碼或擴充點，外部很難直接改動內部工具列與事件流程，降低客製化自由度。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q4, A-Q6, B-Q3

A-Q4: 為什麼 Community Server 要用包裝層？
- A簡: 為抽象依賴、統一體驗、集中安全與設定，並保留替換與升級彈性。
- A詳: 採用包裝層可隔離第三方編輯器差異，將樣式、安全過濾、上傳策略與事件處理集中，確保平台跨模組一致。當要升級或改用其他編輯器時，只需調整包裝層，即可降低影響範圍。代價是需要設計良好的擴充點，否則外部客製化將受限。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q1, B-Q3, A-Q22

A-Q5: 缺少包裝層原始碼為何影響客製化？
- A簡: 看不到內部結構與 API，無法把自訂按鈕嵌回原工具列，只能加外掛列。
- A詳: 包裝層負責將功能與 UI 注入編輯器。缺少其原始碼，等於無法修改工具列組成、事件橋接、設定轉換與資源載入點。結果是新增功能無法融入原本工具列，只能放在頁面上方或側邊，靠 JavaScript 對編輯區插入 HTML，導致體驗略顯不一致。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: C-Q3, D-Q1, B-Q8

A-Q6: 直接內嵌 FTB 與透過包裝層的差異？
- A簡: 直接內嵌易客製；包裝層可統一管理但限制改動，需經橋接介面設定。
- A詳: 直接內嵌 FTB 可自由調整工具列、事件與設定，開發效率高；但平台無一致性與替換成本高。包裝層模式集中控制、利於統一體驗與升級，卻需遵循包裝層提供的屬性與擴充點，缺少原始碼時更難動到內層工具列與流程。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q3, B-Q3, A-Q22

A-Q7: 為什麼要修改 blog editor（目標）？
- A簡: 為支援貼圖與表情符號，讓文章更生動並提升使用者互動體驗。
- A詳: 實務上最常見的需求是插入圖片與表情符號。圖片提升資訊密度與可讀性，表情補足語氣與情感傳達。若平台預設未開啟或包裝層限制，便需要客製功能與 UI，以滿足日常發文的效率與品質要求。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q8, A-Q11, C-Q4

A-Q8: 表情符號與貼圖功能的核心價值是什麼？
- A簡: 降低表達成本，明確傳遞情緒與重點，提升可讀性與互動率。
- A詳: 圖片能快速承載大量資訊，表情符號則讓文字表達更貼近口語與情感。兩者共同改善內容吸引力、降低閱讀阻力，並促進社群互動。對內容平台而言，這是提升留存與參與度的關鍵功能群。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q7, A-Q11, B-Q5

A-Q9: FTB 工具列有哪些特點？
- A簡: 內建多項常用按鈕，可透過設定啟用，涵蓋圖片、表情、格式與連結。
- A詳: FTB 提供模組化工具列組件，包含字型、段落、粗斜體、清單、連結、圖片與表情符號等。多數功能可用屬性或設定切換，亦可搭配 JavaScript API 插入 HTML 片段。理想情況下，直接開啟原生項目比重新做一排外掛工具列更一致。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q2, B-Q2, A-Q6

A-Q10: 為何工具列整合很重要？
- A簡: 一致操作與視覺語言，降低學習成本，避免功能分散與認知負擔。
- A詳: 工具列是編輯器的主要入口。分裂成多處或風格不一，會讓使用者迷失、重複導航並降低效率。將自訂功能融入原生工具列，能共享快捷鍵、狀態邏輯與選取範圍管理，使體驗一致且易學易用。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q8, C-Q7, D-Q4

A-Q11: 「貼圖」在編輯器中的意義？
- A簡: 透過上傳或引用圖片 URL，將 <img> 插入編輯區，隨內容預覽與發佈。
- A詳: 貼圖包含前端插入與後端上傳兩面。前端是將 <img src="..."> 插入到當前游標位置；後端需處理檔案上傳、驗證、儲存與回傳 URL。也要考慮路徑、權限與安全過濾，以確保發佈後各環境皆能正確顯示。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q19, B-Q4, C-Q4

A-Q12: 沒有包裝層原始碼時客製化的限制？
- A簡: 無法改內部工具列與事件，只能以外掛列+JS 插入，整合度較低。
- A詳: 因為無法進入包裝層修改，常見限制包括：無法新增原生按鈕、無法攔截內建事件、設定難以注入、樣式難統一。可行替代是做一排外掛工具列，呼叫 JavaScript API 或 execCommand 插入 HTML，但需自理相容與維護。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: C-Q3, B-Q9, D-Q1

A-Q13: 上方外掛工具列與原生工具列差在哪？
- A簡: 外掛列貼近需求但與原生脫節；原生列整合深且共享內部狀態。
- A詳: 原生工具列能讀取選取範圍、同步狀態（如粗體亮起）、共享快捷鍵與樣式。外掛列多半只能在操作後以 JS 插入 HTML，難以取得同等的上下文資訊，導致體驗不一致與維護負擔提高。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q8, C-Q7, D-Q4

A-Q14: 編輯器選擇對平台一致性有何影響？
- A簡: 編輯器與包裝策略決定跨模組一致、升級代價與擴充彈性。
- A詳: 若平台多模組共用同一包裝層，則可統一安全策略、上傳政策與 UI 規範；也能以一次調整影響全站。但封裝過深或擴充點不足，則會壓縮每個模組的客製空間，產生局部需求難落地的矛盾。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q16, A-Q22, D-Q8

A-Q15: 什麼是 WYSIWYG 編輯器？
- A簡: 所見即所得，使用者在瀏覽器直接排版並預覽接近發佈的內容。
- A詳: WYSIWYG（What You See Is What You Get）編輯器透過 contentEditable 或 iframe，讓使用者像在文書系統般排版。它提供工具列按鈕與快捷鍵，背後將操作轉為 HTML。FTB 即屬此類型，適合部落格與 CMS。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q2, B-Q2, B-Q7

A-Q16: 何謂 Toolbar Button 與 Command？
- A簡: 按鈕是 UI 入口，Command 是對編輯區執行的具體指令與行為。
- A詳: 每個工具列按鈕背後對應一個 Command，如 Bold、InsertImage、CreateLink。點擊後會操作選取範圍與內容 DOM，插入或包裹標籤。原生與自訂按鈕的差別在於是否能存取內部狀態與 API。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q2, B-Q6, C-Q6

A-Q17: 為何應避免深度改動核心？
- A簡: 升級與維護成本高，容易與平台更新衝突，風險與技術債上升。
- A詳: 深度改動核心（含包裝層）會造成版本升級困難、修補安全性漏洞延宕、與其他模組相依錯綜。除非可維持長期分支與測試資源，否則應以擴充點、外掛、設定方式達成需求較佳。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: D-Q8, B-Q18, A-Q12

A-Q18: 開啟 FTB 內建功能 vs 自行加外掛列？
- A簡: 開啟內建功能穩定且一致；外掛列彈性高但要自理相容與維護。
- A詳: 原生按鈕享有完整內部狀態與相容保證；外掛列可快速滿足需求，但須處理插入 API 差異、跨瀏覽器、樣式一致與升級適配。若可改包裝層，優先開啟原生項目；否則採外掛列作為折衷方案。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: C-Q2, C-Q3, B-Q8

A-Q19: 什麼是上傳的伺服端流程？
- A簡: 接收檔案、驗證型別與大小、儲存、產出 URL，回傳前端插入。
- A詳: 標準流程含：限制檔案大小/副檔名、掃描惡意內容、儲存到安全位置（避免覆蓋）、產生公開 URL（或透過授權保護），最後以 JSON 回傳結果。前端再將 <img> 插入編輯區，並處理失敗情境與錯誤提示。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q4, C-Q4, D-Q7

A-Q20: 什麼是前端插入 HTML 片段？
- A簡: 透過 JavaScript 於游標處插入 <img>/<span> 等標籤至內容 DOM。
- A詳: 當無法改動原生工具列時，常以 JS 對編輯區執行插入動作。作法含呼叫編輯器 API（若有）或退而用 execCommand/Range 操作 DOM。需注意選取範圍、焦點、跨瀏覽器與撤銷堆疊的一致性。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q6, B-Q7, C-Q6

A-Q21: 何時應評估換用其他編輯器？
- A簡: 當包裝層限制過大、API 不足或需求無法落地，且遷移成本可控。
- A詳: 評估點包含：功能缺口、擴充點、相容性、授權、可維運性與使用者體驗。若現有包裝層無法滿足且修改成本過高，可考慮替換內層編輯器，但需審視包裝層耦合、資料遷移與訓練成本。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q16, D-Q10, A-Q6

A-Q22: CS 與 FTB 的耦合度意味著什麼？
- A簡: 耦合深可保一致但換件難；包裝層降耦合也可能限制外部客製。
- A詳: 高耦合可獲得最佳整合與體驗，但替換與升級代價高。包裝層降低耦合、便於替換，卻需要良好擴充點與文件；否則外部難以客製。選擇取決於平台的演進策略與團隊維運能力。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q4, A-Q6, B-Q16

### Q&A 類別 B: 技術原理類

B-Q1: Community Server 的編輯器架構如何運作？
- A簡: 前端 UI 經包裝層橋接至內層 FTB，統一設定與事件，最後輸出 HTML。
- A詳: 架構通常為「頁面→包裝層→FTB」。包裝層輸出工具列與編輯區，注入設定與安全策略，再把使用者操作轉為編輯器命令或伺服端處理（如上傳）。發佈時取得 HTML 內容並存庫或渲染。核心組件：包裝層控制、FTB 控制項、JS API、上傳端點。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q1, A-Q3, B-Q3

B-Q2: FTB 的工具列如何組成與運作？
- A簡: 由按鈕組成，按鈕觸發命令作用於選取範圍，透過 API 改變內容 DOM。
- A詳: FTB 以工具列容器承載多個按鈕，按鈕綁定命令（如 Bold、InsertImage）。命令操作 contentEditable/iframe 的選取範圍與節點，變更 HTML 結構。可透過設定啟用項目，並以 JS 取得與設定內容。核心組件：Button/Command、選取範圍、API。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q2, A-Q16, C-Q2

B-Q3: 包裝層的攔截與轉換機制是什麼？
- A簡: 將平台設定轉為編輯器屬性，攔截事件並橋接到伺服端與安全策略。
- A詳: 包裝層暴露簡化屬性（如是否允許圖片），內部轉為 FTB 設定、注入 JS、註冊上傳端點；同時攔截發佈流程，執行內容清洗。缺原始碼時，這些映射與事件無法改動。核心：屬性映射、事件橋接、安全過濾。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q3, A-Q5, A-Q6

B-Q4: 插入圖片的技術原理？
- A簡: 前端選檔→上傳端點驗證與存檔→回傳 URL→前端插入 <img>。
- A詳: 前端透過表單或 fetch 將檔案送往伺服端；伺服端驗證型別/大小與安全掃描，儲存並產生公開 URL，再以 JSON 回傳。前端取得 URL，保持游標位置並插入 <img> 標籤。核心組件：上傳端點、儲存服務、插入 API。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q11, A-Q19, C-Q4

B-Q5: 插入表情符號的運作機制？
- A簡: 前端提供選擇器，點擊後將對應圖片或字元 HTML 插入編輯區。
- A詳: 表情符號多以小圖或字元表情呈現。做法是渲染一個選擇器面板，點擊項目後將 <img src> 或對應符號插入游標處。可搭配 sprites 或 SVG。核心組件：選擇器 UI、資源檔、插入 API。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q8, C-Q5, C-Q6

B-Q6: 自訂工具列按鈕如何運作？
- A簡: 綁定點擊事件，透過編輯器 API 或 execCommand 對內容執行命令。
- A詳: 自訂按鈕本質是前端事件處理器，取得當前選取與焦點，執行插入或格式化。若編輯器提供 API，應優先使用；否則回退到 document.execCommand 或 Range。核心：事件綁定、選取管理、插入命令。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q16, A-Q20, C-Q6

B-Q7: 編輯器與 JavaScript 的互動機制？
- A簡: 透過公開 API 取得/設定 HTML、焦點與游標，或以 DOM/Range 操作。
- A詳: 多數編輯器提供方法讀寫內容、控制焦點與插入 HTML。若是 iframe，需存取其 document。沒有 API 時，以原生 Range/Selection 控制插入與包裹節點。核心：API/iframe document、Selection/Range。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q15, C-Q6, B-Q2

B-Q8: 為何外掛按鈕難整合回原工具列？
- A簡: 工具列由內部模板/渲染產出，缺原始碼無法注入或篩選按鈕。
- A詳: 原生工具列通常由控制項內部渲染，按鈕清單與事件於內部綁定。若包裝層不開放擴充點或原始碼，外部無法安全插入，強行 DOM 操作易受版本變動影響。核心：內部渲染、封裝邊界、版本相容。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q5, A-Q13, C-Q3

B-Q9: 缺少原始碼時有哪些擴充途徑？
- A簡: 以頁面層外掛列、JS API/execCommand、CSS 覆蓋與最小侵入注入。
- A詳: 可做獨立工具列呼叫插入 API；以 MutationObserver 監看編輯器載入完後注入必要樣式；使用事件委派避免重綁。必要時用 IFrame postMessage 與內部通信（若支援）。核心：最小侵入、事件註冊、相容抽象。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q12, C-Q3, C-Q6

B-Q10: DOM 動態插入按鈕到原工具列的可行性與風險？
- A簡: 可行但脆弱，易受版本/結構變更破壞，維護成本高。
- A詳: 透過查找原工具列容器並 append 按鈕可暫時達成，但一旦控制項改版、ID/結構變更或重渲染，插入將失效。也可能破壞原生狀態同步。除非有穩定掛點，否則不建議。核心：掛點穩定性、重繪風險。
- 難度: 高級
- 學習階段: 進階
- 關聯概念: D-Q1, D-Q8, B-Q8

B-Q11: 啟用 FTB 內建工具的流程？
- A簡: 透過控制項屬性/設定檔啟用，平台包裝層將設定映射至內層。
- A詳: 直接使用 FTB 時可在標記或程式碼設定顯示的工具列項目；若經包裝層，需在平台設定中開啟相應功能，由包裝層翻譯到 FTB。關鍵是找到對應設定入口與映射關係。核心：屬性設定、包裝層映射。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q9, C-Q2, B-Q3

B-Q12: 在包裝層模式下如何傳遞設定至 FTB？
- A簡: 以包裝層公開屬性接收，內部再套用到 FTB 的屬性或初始化參數。
- A詳: 包裝層通常公開布林/列舉/字串屬性，統一在 OnInit/OnLoad 時套用到 FTB，如是否允許圖片、允許的標籤清單。若無原始碼，則僅能用已公開的設定，無法新增或改定義。核心：屬性橋接、生命週期套用。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q4, B-Q3, C-Q2

B-Q13: 安全性：內容與 XSS 過濾如何運作？
- A簡: 包裝層/伺服端清洗 HTML，僅允許白名單標籤與屬性，過濾腳本。
- A詳: 編輯器輸出 HTML 可能含危險標籤。伺服端應以白名單清洗（允許 p, a, img 等），過濾事件屬性與 JavaScript URL。包裝層可集中設定，確保跨模組一致。核心：HTML Sanitization、白名單策略。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: D-Q7, B-Q3, A-Q14

B-Q14: 上傳檔案的安全機制？
- A簡: 限副檔名/大小、驗毒、隨機檔名、隔離儲存，避免任意程式執行。
- A詳: 限定 MIME/副檔名、掃描內容、使用隨機檔名與目錄、避免可執行檔，儲存在非應用程式路徑或以靜態主機服務。回傳 URL 時不得信任客戶端輸入。核心：驗證、隔離、最小權限。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q19, D-Q7, C-Q4

B-Q15: 圖片 URL 與路徑解析的原理？
- A簡: 相對/絕對路徑依 base/當前 URL 解析，部署環境差異會影響顯示。
- A詳: 編輯器插入的 src 若為相對路徑，瀏覽器依當前頁面與 base 標籤解析；跨子目錄或反向代理時易出錯。建議使用絕對或站內根相對路徑，並處理 CDN/虛擬目錄。核心：URL 解析、base、部署差異。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: D-Q2, D-Q3, C-Q4

B-Q16: 為何平台常採用包裝層（架構考量）？
- A簡: 降耦合、集中治理、可替換，兼顧一致體驗與升級維護。
- A詳: 包裝層隔離第三方差異，讓平台在不動核心邏輯下替換編輯器或調整策略。它也是安全與審計的集中點。但需設計擴充點與文件，否則限制外部客製能力。核心：解耦、治理、擴充設計。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q4, A-Q22, D-Q8

B-Q17: 回退方案如何運作（外掛列 + 插入）？
- A簡: 以獨立工具列完成上傳/選取，再用 API/execCommand 插入內容。
- A詳: 先建置頁面層工具列（圖片上傳端點、表情面板），操作後取得 URL 或 HTML 片段，再插入至編輯區。此法不改動包裝層，升級風險低，但需自行維護樣式與相容。核心：外掛列、端點、插入。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q3, C-Q4, C-Q5

B-Q18: 升級與版本控制的原理（避免回歸）？
- A簡: 將客製與平台分層，採版本分支、變更紀錄與自動化回歸測試。
- A詳: 維持最小侵入，將客製化封裝為可替換模組；以 Git 分支管理版本；建立回歸測試涵蓋插入與上傳流程；升級前做試運行與比較。核心：分層封裝、版本管理、自動化測試。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q17, D-Q8, C-Q10

### Q&A 類別 C: 實作應用類（10題）

C-Q1: 如何在 ASP.NET 頁面直接內嵌 FreeTextBox？
- A簡: 引用控制項組件並於頁面標記放入 FTB，設定大小與基本屬性即可。
- A詳: 
  - 具體實作步驟:
    1) 參考組件並註冊控制項命名空間。
    2) 在 .aspx 放入編輯器。
  - 關鍵程式碼片段或設定:
    <%@ Register Assembly="FreeTextBox" Namespace="FreeTextBoxControls" TagPrefix="FTB" %>
    <FTB:FreeTextBox ID="Editor" runat="server" Width="100%" Height="400px" />
  - 注意事項與最佳實踐:
    - 依版本屬性名稱可能不同，請參考對應文件。
    - 先於測試頁驗證功能，再整合至平台。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q2, B-Q2, C-Q9

C-Q2: 如何啟用 FTB 內建的圖片/表情等工具？
- A簡: 透過屬性或設定檔開啟對應按鈕，交由包裝層映射至 FTB。
- A詳: 
  - 具體實作步驟:
    1) 查閱 FTB 或平台文件找出工具列設定入口。
    2) 啟用圖片/表情/連結等項目。
  - 關鍵程式碼片段或設定（示意）:
    // 依版本不同
    Editor.ToolbarLayout = "Bold,Italic|Image,CreateLink|Emoticons";
  - 注意事項與最佳實踐:
    - 優先開啟原生功能，減少自建外掛列。
    - 測試跨瀏覽器與發佈後內容清洗。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q9, B-Q11, A-Q18

C-Q3: 沒有包裝層原始碼時如何加一排外掛工具列？
- A簡: 在頁面加自訂工具列，按鈕以 JS 對編輯區插入 HTML，達成貼圖與表情。
- A詳: 
  - 具體實作步驟:
    1) 於編輯器上方新增工具列容器與按鈕。
    2) 綁定事件，呼叫插入 API/execCommand。
  - 關鍵程式碼片段或設定:
    <div id="customBar"><button id="btnEmoji">🙂</button></div>
    document.getElementById('btnEmoji').onclick=()=>insertIntoEditor('<img src="/emojis/smile.png">');
  - 注意事項與最佳實踐:
    - 保持樣式一致，避免視覺斷裂。
    - 封裝成可重用模組，降維護成本。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q12, B-Q9, C-Q6

C-Q4: 如何實作「插入圖片」按鈕（含上傳）？
- A簡: 建置上傳端點回傳 URL，前端取得後在游標處插入 <img>。
- A詳: 
  - 具體實作步驟:
    1) ASP.NET 建立 .ashx 或 API 接收檔案、驗證、儲存，回傳 JSON。
    2) 前端用 input[type=file] 上傳，成功後插入 <img>。
  - 關鍵程式碼片段或設定:
    // Handler
    public void ProcessRequest(HttpContext ctx){var f=ctx.Request.Files["file"]; /*驗證與存檔*/ ctx.Response.Write("{\"url\":\"/uploads/a.png\"}");}
    // 前端
    insertIntoEditor(`<img src="${url}" alt="">`);
  - 注意事項與最佳實踐:
    - 嚴格限制副檔名/大小與存放路徑。
    - 失敗時友善提示與重試。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q11, B-Q4, D-Q7

C-Q5: 如何實作「表情符號」選擇面板？
- A簡: 建立表情清單，點擊項目即將對應 <img> 插入編輯區內。
- A詳: 
  - 具體實作步驟:
    1) 以網格展示表情圖片。
    2) click 事件插入對應 HTML。
  - 關鍵程式碼片段或設定:
    <ul id="emojis"><li data-url="/emojis/1.png">🙂</li></ul>
    emojis.onclick=(e)=>{if(e.target.dataset.url) insertIntoEditor(`<img src="${e.target.dataset.url}">`);}
  - 注意事項與最佳實踐:
    - 使用 sprite/SVG 可減少請求。
    - 提供替代文字提升無障礙。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q5, C-Q6, D-Q3

C-Q6: 如何用 JavaScript 將 HTML 插入 FTB 內容？
- A簡: 優先用編輯器 API；無則以 execCommand 或 Range 在游標處插入。
- A詳: 
  - 具體實作步驟:
    1) 嘗試調用編輯器 InsertHtml 類 API（若有）。
    2) 無 API 時取得 iframe document，使用 execCommand('insertHTML',false,html)。
  - 關鍵程式碼片段或設定:
    function insertIntoEditor(html){ if(window.Editor&&Editor.InsertHtml){Editor.InsertHtml(html);}else{const ifr=document.querySelector('#Editor iframe');const d=ifr.contentDocument||ifr.contentWindow.document; d.execCommand('insertHTML',false,html);} }
  - 注意事項與最佳實踐:
    - 先 focus 編輯區；處理撤銷堆疊。
    - 兼容不同瀏覽器差異。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q6, B-Q7, D-Q6

C-Q7: 如何讓外掛工具列的樣式與原生一致？
- A簡: 參考原生配色與間距，採同系統字體與按鈕尺寸，提供 hover/disabled。
- A詳: 
  - 具體實作步驟:
    1) 觀察原生工具列 CSS（色彩、間距、圓角）。
    2) 定義變數與共用樣式套用到外掛列。
  - 關鍵程式碼片段或設定:
    #customBar{display:flex;gap:.5rem} #customBar button{padding:.3rem .5rem;border:1px solid #ccc;background:#fff}
  - 注意事項與最佳實踐:
    - 使用 BEM/原子化命名避免衝突。
    - 暗色/高對比模式相容。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q10, A-Q13, D-Q4

C-Q8: 如何封裝外掛工具列成可重用元件（UserControl）？
- A簡: 建立 .ascx 與程式碼後置，輸出 HTML/JS，提供參數化設定。
- A詳: 
  - 具體實作步驟:
    1) 新建 CustomEditorBar.ascx，放入工具列與腳本。
    2) 提供屬性（如 EditorClientId、上傳端點）。
  - 關鍵程式碼片段或設定:
    // CustomEditorBar.ascx.cs
    public string EditorClientId{get;set;}
    // Render 時把 EditorClientId 帶入 JS
  - 注意事項與最佳實踐:
    - 以事件/回呼暴露擴充點。
    - 嚴格控管依賴，便於跨頁面重用。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: C-Q3, C-Q4, B-Q17

C-Q9: 如何建立「直接用 FTB」的測試頁以驗證功能？
- A簡: 獨立頁面嵌入 FTB，逐項測試工具列、插入與上傳，再回到平台整合。
- A詳: 
  - 具體實作步驟:
    1) 新建 EditorTest.aspx，加入 FTB。
    2) 啟用內建按鈕與測試插入/上傳。
  - 關鍵程式碼片段或設定:
    <FTB:FreeTextBox ID="Editor" runat="server" />
  - 注意事項與最佳實踐:
    - 對照平台行為，找出包裝層差異。
    - 紀錄成功配置以便回填到包裝層設定。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q1, C-Q2, B-Q11

C-Q10: 如何撰寫維運文件以降低風險？
- A簡: 梳理需求、配置、端點、相依與升級步驟，建立回歸檢核清單。
- A詳: 
  - 具體實作步驟:
    1) 紀錄工具列項目、插入流程、上傳端點與安全設定。
    2) 建立升級流程與測試案例（插入/貼圖/表情）。
  - 關鍵程式碼片段或設定:
    - 以 README/手冊列出檔案路徑、設定鍵值、指令。
  - 注意事項與最佳實踐:
    - 用變更紀錄追蹤差異。
    - 自動化測試覆蓋核心路徑。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q18, D-Q8, A-Q17

### Q&A 類別 D: 問題解決類（10題）

D-Q1: 無法把自訂按鈕加到 FTB 原工具列怎麼辦？
- A簡: 因包裝層封裝與缺原始碼，改採外掛工具列並以 JS 插入內容。
- A詳: 
  - 問題症狀描述: 新按鈕無法出現在原工具列或不觸發命令。
  - 可能原因分析: 工具列由內部渲染；包裝層未開放擴充點。
  - 解決步驟: 建立頁面外掛列；用 API/execCommand 插入；避免改內部 DOM。
  - 預防措施: 優先用原生設定；評估掛點穩定性與升級策略。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q5, B-Q8, C-Q3

D-Q2: 插入圖片後顯示錯誤（破圖）怎麼排查？
- A簡: 檢查 URL 路徑、存放權限、MIME 與跨域/反向代理設定是否正確。
- A詳: 
  - 問題症狀描述: 編輯器顯示或發佈後破圖。
  - 可能原因分析: 相對路徑解析錯誤、檔案未上傳成功、權限或 MIME 錯誤。
  - 解決步驟: 改用絕對/站根路徑；確認檔案存在與權限；修正 Content-Type。
  - 預防措施: 上傳端回傳可用 URL；部署一致化與健康檢查。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q15, C-Q4, A-Q19

D-Q3: 表情符號顯示成破圖或錯亂？
- A簡: 驗證資源路徑、快取與 base 標籤影響，統一資源目錄與 URL。
- A詳: 
  - 問題症狀描述: 表情面板正常但文章中破圖。
  - 可能原因分析: base HREF 導致相對路徑錯；資源未部署；快取汙染。
  - 解決步驟: 使用站根路徑；確認資源與 CDN；清除快取。
  - 預防措施: 建立表情資源清單與發佈流程；版本化資產。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q5, B-Q15, C-Q5

D-Q4: 外掛工具列位置跑版或破壞版面？
- A簡: 以獨立樣式命名與容器隔離，遵循原生間距與排版系統。
- A詳: 
  - 問題症狀描述: 上方工具列擠壓或覆蓋編輯器。
  - 可能原因分析: 样式衝突、容器寬度/定位不當。
  - 解決步驟: 使用獨立命名與 Flex 佈局；調整邊距與層級。
  - 預防措施: 設計系統化樣式；跨瀏覽器與視窗大小測試。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q10, C-Q7, B-Q8

D-Q5: 貼上後格式混亂（從 Word/網頁複製）怎麼辦？
- A簡: 啟用貼上清洗或「純文字貼上」，過濾多餘樣式與危險標籤。
- A詳: 
  - 問題症狀描述: 貼上變體積龐大、樣式混亂。
  - 可能原因分析: 來源含大量 inline style/Office 標記。
  - 解決步驟: 啟用 paste-clean；提供「貼為純文字」按鈕；伺服端再清洗。
  - 預防措施: 白名單策略與一致的清洗規則；使用者教育。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q13, B-Q2, A-Q15

D-Q6: 不同瀏覽器下插入功能失效？
- A簡: 因 execCommand/選取 API 差異，需做相容封裝與焦點管理。
- A詳: 
  - 問題症狀描述: 某些瀏覽器無法插入或插入位置錯誤。
  - 可能原因分析: API 行為差異、iframe 焦點未設定。
  - 解決步驟: 封裝插入函式；插入前 focus；使用 Range/Selection 回退。
  - 預防措施: 建立跨瀏覽器測試矩陣與 polyfill。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q7, C-Q6, B-Q6

D-Q7: 上傳功能的安全風險與對策？
- A簡: 防任意檔案上傳與 XSS，限制型別/大小、驗毒、隔離與權限控管。
- A詳: 
  - 問題症狀描述: 可上傳危險檔或被植入腳本。
  - 可能原因分析: 缺少驗證、直接可執行、URL 不受控。
  - 解決步驟: 嚴格白名單、大小限制、存放於靜態區、隨機檔名。
  - 預防措施: 安全審查、日誌與警示、定期掃描資產。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q14, A-Q19, C-Q4

D-Q8: 升級 Community Server 後客製化失效？
- A簡: 由於包裝層/標記變更，需以最小侵入重構與建立回歸測試。
- A詳: 
  - 問題症狀描述: 外掛列或插入 API 失效。
  - 可能原因分析: 控制項結構/初始化時機改變。
  - 解決步驟: 查差異、修正掛點、以配置驅動；更新測試。
  - 預防措施: 分層封裝、版本化、預備測試環境與檢核清單。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q18, A-Q17, C-Q10

D-Q9: 找不到包裝層原始碼時怎麼辦？
- A簡: 先確認授權與擴充點，改採外掛列與設定策略，必要時與供應方溝通。
- A詳: 
  - 問題症狀描述: 無法取得或修改包裝層。
  - 可能原因分析: 授權限制、產品發佈策略。
  - 解決步驟: 搜文件與設定；用外掛列滿足需求；提需求至供應方。
  - 預防措施: 選型時審視開放度與文件；備妥替代方案。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q12, B-Q9, A-Q21

D-Q10: 要不要更換編輯器（決策）？
- A簡: 比較需求缺口與遷移成本，若包裝層限制大且無法彌補可考慮替換。
- A詳: 
  - 問題症狀描述: 長期功能缺口、維護成本高。
  - 可能原因分析: API/擴充點不足、技術債。
  - 解決步驟: 盤點需求與替代品；評估相容、授權、訓練與資料遷移。
  - 預防措施: 在包裝層設計上預留抽換與配置能力。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q21, A-Q22, B-Q16

### 學習路徑索引
- 初學者：建議先學習哪 15 題
    - A-Q1: 什麼是 Community Server？
    - A-Q2: 什麼是 FreeTextBox（FTB）？
    - A-Q3: 什麼是 Editor Wrapper（編輯器包裝層）？
    - A-Q7: 為什麼要修改 blog editor（目標）？
    - A-Q8: 表情符號與貼圖功能的核心價值是什麼？
    - A-Q9: FTB 工具列有哪些特點？
    - A-Q11: 「貼圖」在編輯器中的意義？
    - A-Q15: 什麼是 WYSIWYG 編輯器？
    - A-Q16: 何謂 Toolbar Button 與 Command？
    - A-Q10: 為何工具列整合很重要？
    - C-Q1: 如何在 ASP.NET 頁面直接內嵌 FreeTextBox？
    - C-Q2: 如何啟用 FTB 內建的圖片/表情等工具？
    - C-Q5: 如何實作「表情符號」選擇面板？
    - D-Q2: 插入圖片後顯示錯誤（破圖）怎麼排查？
    - D-Q3: 表情符號顯示成破圖或錯亂？

- 中級者：建議學習哪 20 題
    - A-Q4: 為什麼 Community Server 要用包裝層？
    - A-Q5: 缺少包裝層原始碼為何影響客製化？
    - A-Q6: 直接內嵌 FTB 與透過包裝層的差異？
    - A-Q12: 沒有包裝層原始碼時客製化的限制？
    - A-Q13: 上方外掛工具列與原生工具列差在哪？
    - A-Q18: 開啟 FTB 內建功能 vs 自行加外掛列？
    - A-Q19: 什麼是上傳的伺服端流程？
    - A-Q20: 什麼是前端插入 HTML 片段？
    - B-Q1: Community Server 的編輯器架構如何運作？
    - B-Q2: FTB 的工具列如何組成與運作？
    - B-Q4: 插入圖片的技術原理？
    - B-Q5: 插入表情符號的運作機制？
    - B-Q6: 自訂工具列按鈕如何運作？
    - B-Q7: 編輯器與 JavaScript 的互動機制？
    - B-Q11: 啟用 FTB 內建工具的流程？
    - C-Q3: 沒有包裝層原始碼時如何加一排外掛工具列？
    - C-Q4: 如何實作「插入圖片」按鈕（含上傳）？
    - C-Q6: 如何用 JavaScript 將 HTML 插入 FTB 內容？
    - D-Q1: 無法把自訂按鈕加到 FTB 原工具列怎麼辦？
    - D-Q6: 不同瀏覽器下插入功能失效？

- 高級者：建議關注哪 15 題
    - B-Q3: 包裝層的攔截與轉換機制是什麼？
    - B-Q8: 為何外掛按鈕難整合回原工具列？
    - B-Q9: 缺少原始碼時有哪些擴充途徑？
    - B-Q10: DOM 動態插入按鈕到原工具列的可行性與風險？
    - B-Q12: 在包裝層模式下如何傳遞設定至 FTB？
    - B-Q13: 安全性：內容與 XSS 過濾如何運作？
    - B-Q14: 上傳檔案的安全機制？
    - B-Q15: 圖片 URL 與路徑解析的原理？
    - B-Q16: 為何平台常採用包裝層（架構考量）？
    - B-Q18: 升級與版本控制的原理（避免回歸）？
    - C-Q8: 如何封裝外掛工具列成可重用元件（UserControl）？
    - C-Q9: 如何建立「直接用 FTB」的測試頁以驗證功能？
    - D-Q7: 上傳功能的安全風險與對策？
    - D-Q8: 升級 Community Server 後客製化失效？
    - D-Q10: 要不要更換編輯器（決策）？