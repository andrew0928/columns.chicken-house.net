# community server 改造工程

## 問題與答案 (FAQ)

### Q&A 類別 A: 概念理解類

A-Q1: 什麼是 Community Server (CS) 1.0？
- A簡: CS 1.0 是整合部落格、論壇、相簿的 ASP.NET 社群平台。
- A詳: Community Server 1.0 是一套以 ASP.NET 為基礎的社群系統，整合部落格、論壇與相簿等功能，採模組化與 Provider 架構，便於擴充與客製。本文中的改造聚焦於改進編輯器（FTB 3.0）進階功能、啟用圖庫插圖、加入表情工具列、實作相簿批次上傳與改造首頁與部落格頁面，以改善內容編輯、媒體管理與瀏覽體驗。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q1, A-Q11, C-Q7

A-Q2: 什麼是 FreeTextBox (FTB) 3.0？
- A簡: FTB 3.0 是 ASP.NET 的所見即所得 HTML 編輯器元件。
- A詳: FreeTextBox（FTB）3.0 是一個常用於 ASP.NET 的 WYSIWYG HTML 編輯器，支持豐富的工具列、圖片插入、表情符號、語法高亮等功能。CS 1.0 內建使用 FTB 但預設未開啟多數進階功能。透過改寫 TextEditorProvider 與配置 Toolbar，可解鎖「從圖庫插圖」與「表情工具列」等強化使用者編輯體驗的能力。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q3, B-Q2, C-Q1

A-Q3: 什麼是 CS 的 TextEditorProvider 與 TextEditorWrapper？
- A簡: Provider 抽象編輯器，Wrapper 負責與系統頁面整合與渲染。
- A詳: 在 CS 中，TextEditorProvider 以 Provider 模式抽象編輯器行為（建立、設定、渲染），允許以設定切換不同編輯器的實作。TextEditorWrapper 則包裝 Provider 的輸出，協調頁面生命週期、樣式與事件綁定。改寫 Provider 可啟用 FTB 的進階功能，並由 Wrapper 確保在 Blog 與 Forum 內一致呈現。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q1, B-Q2, C-Q1

A-Q4: 為什麼要啟用 FTB 3.0 的進階功能？
- A簡: 進階功能提升編輯效率、媒體管理與貼文表現。
- A詳: CS 預設關閉多項 FTB 進階功能，導致編輯體驗受限。啟用後可直接插入圖庫圖片、快速加入表情、改善貼文排版與媒體內容豐富度。對論壇與部落格皆能提升內容產製效率與可閱讀性，並減少使用者切換工具或手動貼 HTML 的成本，改善整體社群平台的易用性與參與度。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q2, B-Q2, C-Q2

A-Q5: 什麼是 FTB 的 Insert Image From Gallery？
- A簡: 讓使用者從內建圖庫挑選或上傳圖片後插入文章。
- A詳: Insert Image From Gallery 是 FTB 3.0 的對話框功能，整合伺服器端的圖片圖庫，使用者可於編輯時選擇已上傳圖片或即時上傳，再自動插入至內文。啟用後，Blog 與 Forum 的貼文可快速加入一致尺寸與路徑管理的圖片，有助於內容管理、儲存一致性與權限控管，並避免外連圖片帶來的風險。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q3, C-Q2, D-Q2

A-Q6: 為什麼在 CS 中啟用 Image Gallery 插圖？
- A簡: 提升媒體編輯效率、統一圖片來源與權限管理。
- A詳: 啟用圖庫插圖讓使用者能直接使用受控的圖片來源，確保圖片路徑、尺寸與壓縮品質一致，避免外部連結失效與版權風險。對管理者而言，圖庫可與相簿權限一致運作，便於審核與維護；對使用者而言，插圖流程簡化、編輯效率提升，降低貼文門檻，促進豐富媒體內容的產生。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q5, B-Q12, D-Q3

A-Q7: 什麼是 FTB 的 emotion icons 工具列？
- A簡: 一組表情符號按鈕，點選即可插入對應圖示。
- A詳: Emotion icons 是 FTB 工具列的一部分，提供常見表情圖示，點選即在游標處插入對應圖片或短碼。此功能提升互動氛圍與表達力，特別適合論壇回覆與輕量貼文。啟用時需正確配置圖示路徑、資源載入與按鈕定義，確保不同頁面（Blog、Forum）皆能一致顯示與運作。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q4, C-Q3, D-Q6

A-Q8: 為什麼需要相簿批次上傳功能？
- A簡: 批次上傳節省時間，統一縮圖與相簿自動化管理。
- A詳: CS 原生缺少批次上傳，導致大量圖片上傳流程冗長。藉由批次上傳，可先在本機縮圖再一次性傳送，並自動建立群組與相簿，避免手動建置錯誤與重工。此舉大幅縮短內容發布時間，提升照片管理一致性，適用於活動照片、教學圖庫與長期系列內容維護。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q5, C-Q5, C-Q6

A-Q9: 什麼是以 Web Service 實作的批次上傳？
- A簡: 透過網路服務提供驗證、上傳、建相簿的 API。
- A詳: 批次上傳以 Web Service（如 ASMX/SOAP）提供標準化 API，客戶端命令列工具可呼叫服務驗證、建立群組/相簿、縮圖後上傳檔案。此設計讓不同工具或工作流程能一致地與 CS 後端互動，並集中處理驗證、權限、檔案規範與紀錄，易於維護與擴充。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q5, B-Q6, C-Q4

A-Q10: 這個專案中的命令列工具扮演什麼角色？
- A簡: 負責本地縮圖、呼叫 Web Service、批次自動化。
- A詳: 命令列工具將本地圖片依規格批次縮圖、讀取目錄結構決定群組/相簿，並呼叫 Web Service 完成認證、建立相簿與上傳。它解決瀏覽器大量上傳的效率瓶頸，易於腳本化與排程，適合內容管理者在發佈前先行整理與轉換圖片。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q5, C-Q6, B-Q7

A-Q11: 什麼是 CS 頁面自訂？有哪些頁面被改造？
- A簡: 以控制項重構首頁與部落格頁，調整布局與資訊密度。
- A詳: CS 頁面自訂指針對既有頁面改寫模板或替換控制項，以符合需求與體驗。本文改造包含：首頁改為以 Gallery/Blogs/Forums 控制項呈現；Blog 首頁改為部落格清單；部落格首頁（Homepage）僅顯示標題、點入才見內文。此舉提升導覽效率、減少首屏負荷，亦符合使用者偏好。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q7, C-Q8, C-Q9

A-Q12: 為什麼將 Blog 首頁改為列表？
- A簡: 強化導覽與概覽，減少長文占位，提升可掃讀性。
- A詳: 將 Blog 首頁改為列表，可在有限視窗一次展示多個部落格或文章摘要，使用者快速找到感興趣的內容。對平台而言可降低單頁渲染成本與圖片載入量，改善首屏時間與跳出率。搭配分類、搜尋與排序，可進一步提升探索效率與整體使用體驗。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q10, C-Q8, D-Q7

A-Q13: 為什麼 Blog Homepage 只顯示標題？
- A簡: 降低頁面冗長與載入負擔，聚焦清單導覽。
- A詳: 只顯示標題可避免長文與多媒體造成首頁冗長與耗流量，讓使用者先瀏覽標題快速定位，再點入閱讀全文。此設計兼顧效能與可用性，特別適合多圖貼文的場景。不過需在 SEO 與可發現性間平衡，如提供摘要、結構化資料或內頁導覽來補強。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q11, C-Q9, D-Q8

A-Q14: CS 的 Group 與 Gallery 有何關係？
- A簡: Group 作為邏輯分組，Gallery 為其下的相簿集合。
- A詳: 在相簿設計中，Group 通常代表較高層的分類或群組，底下可包含多個 Gallery（相簿）。批次上傳時可依資料夾結構對應 Group/Gallery，自動檢查是否存在並建立，維持清晰有序的媒體管理階層，有助權限配置與導覽。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q8, C-Q6, D-Q5

A-Q15: 官方未提供批次上傳與自行擴充的差異？
- A簡: 官方缺批次能力，自行擴充補齊自動縮圖與建相簿。
- A詳: CS 原生上傳偏向單檔或表單導向，無法有效處理大量圖片與自動結構化管理。自行擴充透過 Web Service 與命令列工具，加入批次縮圖、重試、錯誤回報與自動建立 Group/Gallery 的能力，強化效率與一致性，同時可依需求調整驗證、命名與壓縮策略。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q8, B-Q5, C-Q5

A-Q16: CS 1.0 預設 FTB 設定與自訂 Provider 的差異？
- A簡: 預設關閉進階功能，自訂可解鎖插圖與表情等。
- A詳: CS 預設採保守設定，FTB 僅暴露基本編輯工具。改寫 TextEditorProvider 後，可自訂 Toolbar、啟用 Insert Image From Gallery、情緒圖示等，並統一在 Blog/Forum 內生效。此作法將行為從設定檔抽出到程式層，利於版本控管與持續整合。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q2, C-Q1, D-Q1

A-Q17: 啟用 FTB 插圖對 Blog 與 Forum 的影響？
- A簡: 插圖更便捷一致，提升閱讀性並簡化圖片管理。
- A詳: 啟用圖庫插圖後，作者可在 Blog 與 Forum 中一致地插入受管控的圖片，減少外連與版面錯亂。對讀者而言，圖片尺寸與清晰度更穩定，內容更易讀。對管理者而言，圖片可追蹤、可審核、可替換，降低維護成本。但需留意容量、快取與權限策略。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q5, B-Q12, D-Q3

A-Q18: 以 ASP.NET Control 重做首頁的核心價值？
- A簡: 元件化、可重用、易維護並可獨立測試與部署。
- A詳: 以控制項重新組構首頁，可將 Blogs、Forums、Gallery 的顯示邏輯各自封裝，降低耦合、提升重用性。透過配置或 Feature Flag 可逐步上線與回滾，亦利於快取與效能優化。此作法符合 ASP.NET 的元件化精神，讓版面與資料存取能清楚分離。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q9, C-Q7, D-Q7

A-Q19: 這次改造的整體目標與價值是什麼？
- A簡: 改善編輯體驗、媒體管理、上傳效率與瀏覽效能。
- A詳: 本次改造集中在四面向：編輯（啟用 FTB 進階功能）、媒體（圖庫插圖與表情）、上傳（批次縮圖與自動建相簿）、瀏覽（首頁與 Blog 頁面改版）。綜合提升使用者創作效率、內容豐富性、運維一致性與前端效能，最終改善整體社群平台的使用體驗與可維護性。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q4, A-Q8, A-Q11

A-Q20: 為何需將舊論壇資料移轉至 CS？要注意什麼？
- A簡: 整合社群資產至單一平台，需留意對應與編碼。
- A詳: 將舊論壇（如 ChickenHouse Forum）資料移轉至 CS，可集中帳號、內容與媒體，統一維護與搜尋。關鍵在設計良好的 ETL：欄位映射、ID/使用者對應、附件轉存、分類與權限重建，以及編碼（避免亂碼）與網址轉向。漸進式驗證與回滾策略也不可少。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q13, B-Q14, D-Q9

### Q&A 類別 B: 技術原理類

B-Q1: CS 的 Provider 模式如何運作（以 TextEditorProvider 為例）？
- A簡: Provider 以介面抽象功能，設定載入實作，熱插拔替換。
- A詳: 技術原理說明：Provider 定義標準介面（如 CreateEditor、ConfigureToolbar），由設定檔指定具體型別。關鍵步驟或流程：1) 定義介面/基底類別；2) 撰寫自訂實作；3) 於設定檔註冊預設 Provider；4) Wrapper 於頁面生命週期呼叫。核心組件介紹：Provider 類別、Wrapper、設定（如 CommunityServer.config）、DI/工廠載入機制。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q3, C-Q1, B-Q18

B-Q2: TextEditorWrapper 改進的技術原理與流程？
- A簡: 透過 Wrapper 統一注入設定與資源，解鎖 FTB 功能。
- A詳: 技術原理說明：Wrapper 介於頁面與編輯器之間，負責設定工具列、載入腳本/樣式、事件綁定。關鍵步驟：1) 擴充 Wrapper 注入自訂 Provider；2) 設置 ToolbarLayout 啟用進階按鈕；3) 加載資源（icons、對話框）；4) 於 Blog/Forum 共用。核心組件：自訂 Provider、Wrapper、前端資源包與設定檔。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q4, C-Q1, D-Q1

B-Q3: 啟用 FTB Insert Image From Gallery 的機制？
- A簡: 透過對話框呼叫伺服器圖庫服務，回傳選圖插入。
- A詳: 技術原理說明：FTB 的「插入圖庫圖片」按鈕觸發對話框，與後端圖庫 API 互動取得圖片清單或上傳結果。關鍵步驟：1) 在 Toolbar 註冊按鈕；2) 配置對話框 URL 與權限；3) 取得選取結果並插入 IMG HTML。核心組件：FTB 對話框頁、圖庫服務端點、權限/路徑解析器。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q5, C-Q2, D-Q2

B-Q4: Emotion icons 工具列在 FTB 的載入機制？
- A簡: 工具列定義載入圖示資源與插入邏輯，前端處理事件。
- A詳: 技術原理說明：FTB 讀取 Toolbar 定義渲染按鈕，點擊觸發插入模板（IMG/短碼）。關鍵步驟：1) 設定工具列字串與按鈕映射；2) 確認資源路徑可取用；3) 前端 JS 對應事件與插入 API。核心組件：Toolbar 定義、icons 靜態資源、插入命令處理器與本地化字串。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q7, C-Q3, D-Q6

B-Q5: CS 相簿批次上傳的整體架構設計？
- A簡: 客戶端 CLI + 伺服器 Web Service + 相簿儲存層協作。
- A詳: 技術原理說明：採 C/S 架構，CLI 縮圖與分批傳送，伺服器驗證、建立 Group/Gallery、存檔與記錄。關鍵步驟：1) 認證；2) 檢查/建立結構；3) 上傳檔案與中繼資料；4) 產出縮圖與URL。核心組件：ASMX Web Service、檔案儲存（檔案系統/DB）、縮圖程式庫、交易/重試機制。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q8, A-Q9, C-Q4

B-Q6: 批次上傳 Web Service 的驗證與授權機制怎設計？
- A簡: 使用帳密/Token 驗證，角色授權控制建立與上傳。
- A詳: 技術原理說明：ASMX 可使用 Forms Auth/Cookie、Basic 或自訂 Token。關鍵步驟：1) 登入換取 Cookie/Token；2) 於每次呼叫驗證；3) 依角色核准建立 Group/Gallery 與上傳。核心組件：驗證端點、授權屬性/攔截器、稽核記錄，以防濫用與追蹤問題。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q9, C-Q4, D-Q4

B-Q7: 批次縮圖與上傳的執行流程？
- A簡: 先本地縮圖與命名，再分批上傳與回報結果。
- A詳: 技術原理說明：本地處理減少頻寬與伺服器負荷。關鍵步驟：1) 讀取來源目錄；2) 依規格縮圖、命名；3) 佇列任務分批上傳；4) 收到回應更新狀態與重試。核心組件：影像處理程式庫、佇列/重試邏輯、上傳 API、結果日誌與錯誤處理。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q10, C-Q5, D-Q10

B-Q8: 自動建立 Group/Gallery 的邏輯與資料模型？
- A簡: 檢查存在性，無則建立並回傳識別碼供上傳綁定。
- A詳: 技術原理說明：以名稱/Slug 唯一鍵查詢，避免重複。關鍵步驟：1) 解析本地資料夾映射；2) 查詢 Group；3) 不存在則新建並回傳 ID；4) 建立 Gallery 與權限。核心組件：資料存取層（Group/Gallery）、唯一鍵策略、權限關聯與交易保護。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q14, C-Q6, D-Q5

B-Q9: 首頁以 ASP.NET 控制項重構的架構設計？
- A簡: 各模組獨立 UserControl，資料與呈現分離，便於快取。
- A詳: 技術原理說明：以 UserControl/自訂伺服器控制項封裝 Blogs/Forums/Gallery 模組。關鍵步驟：1) 定義控制項 API；2) 服務層取數據；3) 綁定與樣板渲染；4) 加入輸出快取。核心組件：控制項、服務層、樣板與快取策略，支援獨立部署與測試。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q11, C-Q7, D-Q7

B-Q10: Blog 首頁列表化的資料取得與繫結流程？
- A簡: 服務層查詢與分頁，前端資料繫結與樣板化輸出。
- A詳: 技術原理說明：分離查詢與呈現。關鍵步驟：1) 定義查詢條件（排序、分頁）；2) 服務層取得資料；3) 綁定至 Repeater/Grid；4) 客製項目樣板（標題、摘要、連結）。核心組件：資料存取、分頁器、樣板控制項與快取。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q12, C-Q8, D-Q7

B-Q11: Blog Homepage 僅顯示標題的樣板機制？
- A簡: 調整 View/Template 僅輸出標題欄位與連結。
- A詳: 技術原理說明：透過樣板綁定控制項，只呈現 Title 與 URL。關鍵步驟：1) 修改頁面模板；2) 隱藏內容區塊；3) 改以摘要或懸浮提示補充。核心組件：樣板頁、資料模型（Title、Slug）、CSS/JS 輔助提示與 SEO 結構化資料。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q13, C-Q9, D-Q8

B-Q12: 圖片儲存、路徑與 URL 生成策略？
- A簡: 一致命名與目錄規劃，伺服器生成穩定可公用的 URL。
- A詳: 技術原理說明：檔案系統分層與規範命名，避免衝突。關鍵步驟：1) 依 Group/Gallery/日期建立路徑；2) 生成公開 URL；3) 維護原圖與縮圖對應。核心組件：檔案儲存服務、URL 產生器、CDN/快取頭設定，確保插圖與瀏覽一致性。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q6, A-Q17, D-Q3

B-Q13: 舊論壇資料移轉的 ETL 流程與關鍵步驟？
- A簡: 擷取、轉換、載入三步驟，逐批驗證與回滾保護。
- A詳: 技術原理說明：ETL 分三階段。關鍵步驟：1) 擷取來源資料（文章、回覆、附件、使用者）；2) 轉換欄位與編碼、重建關聯；3) 載入目標資料表與媒體儲存；4) 比對校驗與日誌；5) 支援回滾。核心組件：抽取腳本、轉換映射、載入器與驗證報表。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q20, C-Q10, D-Q9

B-Q14: 移轉期間使用者、文章、附件對應策略？
- A簡: 使用者映射、ID 保留/重建、附件重新掛載與簽名。
- A詳: 技術原理說明：確保參照完整性。關鍵步驟：1) 使用者以 Email/帳號映射；2) 文章與回覆保持階層；3) 附件轉存並更新連結；4) 權限與群組重建。核心組件：映射表、參照完整性驗證、附件服務與重導策略。
- 難度: 高級
- 學習階段: 進階
- 關聯概念: A-Q20, B-Q13, D-Q9

B-Q15: 啟用進階編輯功能的效能與載入成本？
- A簡: 工具列與對話框增多會加載資源，需快取與延遲載入。
- A詳: 技術原理說明：更多按鈕與對話框代表額外 JS/CSS/圖示與伺服器端查詢（如圖庫）。關鍵步驟：1) 啟用按需載入；2) 合併壓縮資源；3) 快取圖庫清單；4) 控制初始渲染成本。核心組件：資源打包、快取層、懶載入策略與測試監控。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: D-Q7, A-Q17, C-Q2

B-Q16: 上傳與插圖的安全風險與防護機制？
- A簡: 驗證授權、MIME/副檔名檢查、隔離與掃毒。
- A詳: 技術原理說明：檔案上傳易受惡意檔案、XSS 與存取濫用。關鍵步驟：1) 嚴格檢查檔型與大小；2) 存儲於非可執行目錄；3) 產生安全 URL；4) 權限控制與審計。核心組件：檔案掃描、白名單、簽名 URL 或防盜鏈、CSP 與輸入輸出過濾。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: D-Q3, B-Q12, C-Q4

B-Q17: FTB 3.0 與 CS 1.0 的相容性與版本議題？
- A簡: 預設相容但進階功能需調整資源路徑與設定。
- A詳: 技術原理說明：FTB 為外掛元件，CS 僅使用基本功能。啟用進階功能須對應 CS 目錄結構、權限與頁面框架。關鍵步驟：1) 確認 FTB 版本與 CS 相容清單；2) 調整對話框路徑與資源；3) 測試在 Blog/Forum 的整合。核心組件：版本檢查、相容設定與回退方案。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: D-Q1, C-Q1, C-Q2

B-Q18: 使用 Provider 封裝對可維護性的影響？
- A簡: 降耦合、可替換、便於測試與配置化演進。
- A詳: 技術原理說明：Provider 把變動點包成可替換單元，藉設定決定實作。關鍵步驟：1) 以介面抽象功能；2) 建立多實作並行測試；3) 以設定切換；4) 記錄版本。核心組件：介面/抽象類、設定管理、DI/工廠與監測，降低客製風險。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q1, C-Q1, D-Q1

B-Q19: 自製 Web Service 如何掛載並與 CS 整合？
- A簡: 於同站部署 ASMX，透過 CS 授權與相簿服務協作。
- A詳: 技術原理說明：ASMX 部署於 CS 應用之下，共享認證與設定。關鍵步驟：1) 建立 ASMX 並引用 CS 服務層；2) 配置驗證管線；3) 對外暴露上傳/建立 API；4) 權限/日誌與節流。核心組件：ASMX/Handler、CS 資料層、驗證授權與監控。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: C-Q4, A-Q9, D-Q4

B-Q20: 自訂頁面出問題的回滾與部署策略？
- A簡: 藉版本控管、Feature Flag 與備援模板快速回退。
- A詳: 技術原理說明：以配置控制新舊模板切換，減少停機風險。關鍵步驟：1) 版本化控制項與模板；2) 實作 Feature Flag；3) 部署前藍綠或逐步釋出；4) 保留備援模板與快取清除腳本。核心組件：版本庫、配置中心、釋出管線與監控告警。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q11, C-Q7, D-Q7

### Q&A 類別 C: 實作應用類

C-Q1: 如何在 CS 1.0 實作自訂 TextEditorProvider 啟用 FTB 進階功能？
- A簡: 撰寫 Provider 類、註冊設定、配置 Toolbar 解鎖功能。
- A詳: 具體實作步驟：1) 繼承 CS 的 TextEditorProvider；2) 建立 FTB 實例並設定 Toolbar；3) 註冊為預設 Provider。關鍵程式碼片段或設定：
  ```csharp
  public class CustomFtbProvider : TextEditorProvider {
    public override Control CreateEditor() {
      var ftb = new FreeTextBox { ToolbarLayout = "Bold,Italic,|,InsertImage,InsertFromGallery,|,Emoticons" };
      return ftb;
    }
  }
  ```
  設定：
  ```xml
  <textEditor defaultProvider="CustomFtbProvider">
    <providers><add name="CustomFtbProvider" type="MyNs.CustomFtbProvider, MyAsm"/></providers>
  </textEditor>
  ```
  注意事項與最佳實踐：確認資源路徑、權限、跨頁面一致性並加上回滾設定。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q1, B-Q2, D-Q1

C-Q2: 如何啟用 FTB 的 Insert Image From Gallery 對話框？
- A簡: 在工具列加入按鈕，配置對話框 URL 與權限即可。
- A詳: 具體實作步驟：1) 將 InsertFromGallery 按鈕加入 Toolbar；2) 設置對話框頁面與圖庫 API；3) 測試 Blog/Forum。關鍵程式碼片段或設定：
  ```csharp
  ftb.ToolbarLayout += ",|,InsertFromGallery";
  ftb.ImageGalleryUrl = "/gallery/dialogs/select.aspx";
  ```
  注意事項與最佳實踐：確保對話框頁面能讀取目前使用者權限、返回安全的圖片 URL，並處理空清單與錯誤提示。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q3, B-Q12, D-Q2

C-Q3: 如何在 FTB 顯示並配置 emotion icons 工具列？
- A簡: 加入 Emoticons 按鈕並配置圖示路徑與插入樣式。
- A詳: 具體實作步驟：1) Toolbar 加入 Emoticons；2) 設定 icons 目錄；3) 驗證插入結果。程式碼片段：
  ```csharp
  ftb.ToolbarLayout += ",|,Emoticons";
  ftb.EmoticonsLocation = "/content/emotions/";
  ```
  注意事項與最佳實踐：確保資源可公開取用、CDN 或快取頭設定妥當，避免在 HTTPS 下混合內容，並處理行內與換行插入。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q4, D-Q6, C-Q1

C-Q4: 如何建立 ASMX Web Service 支援批次上傳？
- A簡: 建立 ASMX 服務，實作驗證、建相簿與上傳方法。
- A詳: 具體實作步驟：1) 新增 UploadService.asmx；2) 實作 Login、EnsureGroupGallery、UploadPhoto。程式碼片段：
  ```csharp
  [WebMethod] public string Login(string u,string p){ /* return token */ }
  [WebMethod] public int EnsureGroup(string name){ /* return groupId */ }
  [WebMethod] public int EnsureGallery(int groupId,string name){ /* return galleryId */ }
  [WebMethod] public bool Upload(int galleryId, byte[] data, string name){ /* save */ }
  ```
  注意事項與最佳實踐：限制檔型/大小、驗證 Token、記錄日誌與節流，部署於 CS 同站共享認證。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q5, B-Q6, D-Q4

C-Q5: 如何撰寫命令列工具批次縮圖並上傳至 CS？
- A簡: 以 C# 讀取目錄縮圖，呼叫 ASMX API 分批上傳。
- A詳: 具體實作步驟：1) 解析目錄結構；2) 縮圖；3) 認證；4) 建立 Group/Gallery；5) 上傳。程式碼片段：
  ```csharp
  using var img = Image.FromFile(p); var bmp = Resize(img, 1600);
  var token = svc.Login(user, pass);
  var gid = svc.EnsureGroup(folder); var aid = svc.EnsureGallery(gid, album);
  svc.Upload(aid, File.ReadAllBytes(tmp), Path.GetFileName(p));
  ```
  注意事項與最佳實踐：控制並行度、重試策略、斷點續傳與紀錄失敗清單。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q7, B-Q8, D-Q10

C-Q6: 如何在上傳時自動建立 Group 與 Gallery？
- A簡: 先查詢是否存在，無則建立並傳回 ID 綁定上傳。
- A詳: 具體實作步驟：1) 以名稱或 Slug 查詢 Group；2) 不存在呼叫 EnsureGroup 建立；3) 再以 GroupID 建立或查詢 Gallery；4) 以 ID 上傳。程式碼片段：
  ```csharp
  int gid = svc.EnsureGroup("Travel");
  int aid = svc.EnsureGallery(gid, "2025_Japan");
  ```
  注意事項與最佳實踐：名稱規範與唯一鍵策略、處理並發與交易，避免重複建立。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q8, C-Q4, D-Q5

C-Q7: 如何以 ASP.NET 控制項重構 CS 首頁？
- A簡: 建立 Blogs/Forums/Gallery 控制項，首頁組裝與快取。
- A詳: 具體實作步驟：1) 為各模組建立 UserControl；2) 服務層取資料；3) 前端樣板渲染；4) 加入輸出快取。設定：
  ```aspx
  <%@ Register Src="~/Controls/Blogs.ascx" TagName="Blogs" TagPrefix="cs" %>
  <cs:Blogs runat="server" ID="BlogsList" />
  ```
  注意事項與最佳實踐：避免過大 ViewState、使用 Partial Caching、預留回滾老模板。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q9, D-Q7, B-Q20

C-Q8: 如何將 Blog 首頁改為部落格列表？
- A簡: 改模板為清單綁定，實作分頁與排序。
- A詳: 具體實作步驟：1) 調整資料來源為部落格清單；2) 綁定 Repeater/Grid；3) 加入分頁控制；4) 加入搜尋/排序。程式片段：
  ```aspx
  <asp:Repeater runat="server" ID="rBlogs">
    <ItemTemplate><a href='<%# Eval("Url") %>'><%# Eval("Title") %></a></ItemTemplate>
  </asp:Repeater>
  ```
  注意事項與最佳實踐：啟用快取、避免一次載入全部，確保 SEO 內鏈與麵包屑。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q10, A-Q12, D-Q7

C-Q9: 如何將 Blog Homepage 改為僅顯示標題？
- A簡: 調整樣板只輸出標題連結，內文搬至內頁。
- A詳: 具體實作步驟：1) 修改模板隱藏 Content；2) 只輸出 Title/Date/Tags；3) 於內頁完整渲染。程式片段：
  ```aspx
  <a href="<%# Eval("Url") %>"><%# Eval("Title") %></a>
  ```
  注意事項與最佳實踐：補強 SEO（結構化資料、meta 描述）、加上摘要/預覽圖於列表頁以平衡可發現性。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q11, A-Q13, D-Q8

C-Q10: 如何規劃 ChickenHouse Forum 資料移轉到 CS？
- A簡: 擬定 ETL 映射、分批驗證、處理附件與編碼。
- A詳: 具體實作步驟：1) 盤點來源 schema 與 CS 目標；2) 設計映射（使用者、板塊、文章、回覆、附件）；3) 寫抽取與載入腳本；4) 處理編碼與時區；5) 分批驗證與回滾。注意事項與最佳實踐：建置對照表、保持參照完整性、網址301 轉向避免 SEO 流失。
- 難度: 高級
- 學習階段: 進階
- 關聯概念: B-Q13, B-Q14, D-Q9

### Q&A 類別 D: 問題解決類

D-Q1: FTB 進階按鈕不見或不作用怎麼辦？
- A簡: 檢查 Provider 設定、Toolbar 定義與資源路徑。
- A詳: 問題症狀描述：工具列缺少按鈕或點擊無效。可能原因分析：未載入自訂 Provider、ToolbarLayout 未包含按鈕、腳本/圖示路徑錯誤。解決步驟：1) 驗證設定檔 defaultProvider；2) 檢查 Toolbar 定義字串；3) 觀察瀏覽器 Console 與網路請求。預防措施：版本控管設定、資源打包與自動化測試。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q1, B-Q17, B-Q18

D-Q2: Insert Image From Gallery 對話框開不起來怎麼處理？
- A簡: 確認對話框 URL、權限與跨來源資源存取。
- A詳: 問題症狀描述：按鈕無反應或彈出錯誤。可能原因：對話框頁路徑錯、未授權、JS 錯誤或被瀏覽器阻擋。解決步驟：1) 檢查 ImageGalleryUrl；2) 驗證使用者權限；3) 查看 JS 錯誤；4) 測試直接開啟對話框頁。預防措施：統一路徑設定、權限中介層測試、例外紀錄。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q2, B-Q3, B-Q12

D-Q3: 圖片上傳失敗或格式不支援如何排查？
- A簡: 檢查檔型/大小限制、MIME 驗證與存儲路徑權限。
- A詳: 問題症狀描述：上傳回錯或圖片不可見。可能原因：檔案過大、類型不允許、MIME 欺騙、目錄無寫入權。解決步驟：1) 檢視伺服器限制與白名單；2) 驗證 MIME/副檔名；3) 檢查目錄權限；4) 查看日誌。預防措施：清楚錯誤訊息、前端預檢、大小壓縮與容量監控。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q16, B-Q12, C-Q4

D-Q4: 批次上傳回報 401/403 權限錯誤如何解？
- A簡: 驗證登入流程、Token/ Cookie 傳遞與端點授權。
- A詳: 問題症狀描述：CLI 呼叫服務被拒。可能原因：未附帶驗證資訊、會話過期、端點未允許角色。解決步驟：1) 先呼叫 Login 取得 Token；2) 於每次請求附帶；3) 檢查服務端授權屬性；4) 確認跨域/SSL 設定。預防措施：重試與刷新 Token 機制、最小權限設計、審計日誌。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q6, B-Q19, C-Q4

D-Q5: 批次上傳成功但未自動建立相簿怎麼辦？
- A簡: 檢查 EnsureGroup/Gallery 邏輯與唯一鍵策略。
- A詳: 問題症狀描述：上傳成功但相簿未現。可能原因：建立 API 未被呼叫、名稱衝突或交易失敗。解決步驟：1) 查看 CLI 日誌確認呼叫順序；2) 檢查唯一鍵與大小寫敏感；3) 伺服器重試與交易設定；4) 手動比對資料表。預防措施：操作前先查詢、回傳 ID 紀錄、冪等化 API。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q8, C-Q6, B-Q5

D-Q6: 點選 emotion icons 無反應或插入錯誤怎麼處理？
- A簡: 確認資源路徑、前端事件與插入模板設定。
- A詳: 問題症狀描述：點擊無動作或插入錯誤連結。可能原因：icons 路徑錯、JS 綁定失敗、相對/絕對路徑誤用。解決步驟：1) 檢查資源 404；2) 驗證 Toolbar 定義；3) 測試在空白內容插入；4) 比對 HTML 模板。預防措施：使用絕對/根相對路徑、資源快取與部署檢查。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q3, B-Q4, B-Q12

D-Q7: 首頁改版後 ViewState 過大導致效能差？
- A簡: 減少伺服器控制項、啟用輸出快取與關閉 ViewState。
- A詳: 問題症狀描述：頁面龐大、回傳慢。可能原因：過多伺服器控制項、ViewState 膨脹。解決步驟：1) 改為輕量控制項/靜態輸出；2) 關閉不需 ViewState；3) 啟用輸出快取；4) 分頁/延遲載入。預防措施：頁重監測、控制項設計規範與壓測門檻。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q9, C-Q7, B-Q20

D-Q8: Blog 只顯示標題後 SEO 表現下滑如何改善？
- A簡: 加入摘要、結構化資料與內鏈，並提供站內搜尋。
- A詳: 問題症狀描述：曝光下降、點擊下滑。可能原因：內容稀薄、語義標記不足。解決步驟：1) 列表加入摘要與縮圖；2) 使用 schema.org Article；3) 強化內鏈與麵包屑；4) 維持穩定 URL 與 301。預防措施：A/B 測試與 Search Console 監控、站內搜尋最佳化。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q11, C-Q9, A-Q13

D-Q9: 舊論壇移轉後出現亂碼或搬錯欄位怎麼辦？
- A簡: 檢查編碼與欄位映射，回滾問題批次並修補映射。
- A詳: 問題症狀描述：文字亂碼、關聯錯位。可能原因：編碼轉換錯誤（Big5/UTF-8）、欄位映射或主鍵對應錯。解決步驟：1) 驗證來源/目標編碼；2) 比對映射表；3) 回滾出錯批次；4) 修補與重跑。預防措施：小批試遷、校驗報表、欄位與參照完整性檢查。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q13, B-Q14, C-Q10

D-Q10: 批次縮圖畫質差或變形如何優化？
- A簡: 採等比縮放、高品質重採樣與適當壓縮。
- A詳: 問題症狀描述：縮圖模糊、比例失真。可能原因：拉伸、低品質插值或壓縮過度。解決步驟：1) 等比縮放；2) 使用高品質插值（如 Bicubic）；3) 控制 JPEG 品質（80-90）；4) 銳化處理。預防措施：規範尺寸/比例、壓測不同品質與視覺檢核流程。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q7, C-Q5, A-Q8

### 學習路徑索引
- 初學者：建議先學習 15 題
    - A-Q1: 什麼是 Community Server (CS) 1.0？
    - A-Q2: 什麼是 FreeTextBox (FTB) 3.0？
    - A-Q4: 為什麼要啟用 FTB 3.0 的進階功能？
    - A-Q5: 什麼是 FTB 的 Insert Image From Gallery？
    - A-Q7: 什麼是 FTB 的 emotion icons 工具列？
    - A-Q8: 為什麼需要相簿批次上傳功能？
    - A-Q11: 什麼是 CS 頁面自訂？有哪些頁面被改造？
    - A-Q12: 為什麼將 Blog 首頁改為列表？
    - A-Q13: 為什麼 Blog Homepage 只顯示標題？
    - B-Q1: CS 的 Provider 模式如何運作（以 TextEditorProvider 為例）？
    - B-Q4: Emotion icons 工具列在 FTB 的載入機制？
    - B-Q10: Blog 首頁列表化的資料取得與繫結流程？
    - C-Q1: 如何在 CS 1.0 實作自訂 TextEditorProvider 啟用 FTB 進階功能？
    - C-Q3: 如何在 FTB 顯示並配置 emotion icons 工具列？
    - D-Q1: FTB 進階按鈕不見或不作用怎麼辦？

- 中級者：建議學習 20 題
    - A-Q3: 什麼是 CS 的 TextEditorProvider 與 TextEditorWrapper？
    - A-Q6: 為什麼在 CS 中啟用 Image Gallery 插圖？
    - A-Q9: 什麼是以 Web Service 實作的批次上傳？
    - A-Q10: 這個專案中的命令列工具扮演什麼角色？
    - A-Q15: 官方未提供批次上傳與自行擴充的差異？
    - A-Q16: CS 1.0 預設 FTB 設定與自訂 Provider 的差異？
    - B-Q2: TextEditorWrapper 改進的技術原理與流程？
    - B-Q3: 啟用 FTB Insert Image From Gallery 的機制？
    - B-Q5: CS 相簿批次上傳的整體架構設計？
    - B-Q6: 批次上傳 Web Service 的驗證與授權機制怎設計？
    - B-Q7: 批次縮圖與上傳的執行流程？
    - B-Q8: 自動建立 Group/Gallery 的邏輯與資料模型？
    - B-Q12: 圖片儲存、路徑與 URL 生成策略？
    - B-Q15: 啟用進階編輯功能的效能與載入成本？
    - B-Q18: 使用 Provider 封裝對可維護性的影響？
    - B-Q19: 自製 Web Service 如何掛載並與 CS 整合？
    - C-Q2: 如何啟用 FTB 的 Insert Image From Gallery 對話框？
    - C-Q4: 如何建立 ASMX Web Service 支援批次上傳？
    - C-Q5: 如何撰寫命令列工具批次縮圖並上傳至 CS？
    - D-Q4: 批次上傳回報 401/403 權限錯誤如何解？

- 高級者：建議關注 15 題
    - A-Q18: 以 ASP.NET Control 重做首頁的核心價值？
    - A-Q20: 為何需將舊論壇資料移轉至 CS？要注意什麼？
    - B-Q9: 首頁以 ASP.NET 控制項重構的架構設計？
    - B-Q11: Blog Homepage 僅顯示標題的樣板機制？
    - B-Q13: 舊論壇資料移轉的 ETL 流程與關鍵步驟？
    - B-Q14: 移轉期間使用者、文章、附件對應策略？
    - B-Q16: 上傳與插圖的安全風險與防護機制？
    - B-Q17: FTB 3.0 與 CS 1.0 的相容性與版本議題？
    - B-Q20: 自訂頁面出問題的回滾與部署策略？
    - C-Q6: 如何在上傳時自動建立 Group 與 Gallery？
    - C-Q7: 如何以 ASP.NET 控制項重構 CS 首頁？
    - C-Q8: 如何將 Blog 首頁改為部落格列表？
    - C-Q10: 如何規劃 ChickenHouse Forum 資料移轉到 CS？
    - D-Q7: 首頁改版後 ViewState 過大導致效能差？
    - D-Q9: 舊論壇移轉後出現亂碼或搬錯欄位怎麼辦？