# Network Bridge in Windows 2003...

## 摘要提示
- 硬體選擇信仰: 偏好大廠硬體與驅動，主因是穩定性與較少驅動程式問題。
- Intel 網卡經驗: 大量採用 Intel 82559 系列，穩定且效能佳，優於雜牌與內建網卡。
- 100Mbps 瓶頸: 大檔傳輸受限於 100Mbps，導致備份與燒錄流程冗長低效。
- 升級至 GBE: 啟用主機板內建 Marvell GBE，兩台設備直連以提升點對點速度。
- 網路架構考量: 原本 NAT、RRAS、VPN 等組合複雜，新增子網段會牽動 DHCP 與路由。
- 解法選擇: 採用 Windows Server 2003 內建軟體網路橋接，避免調整現有設定。
- 架構簡化: 透過橋接將 100Mbps 與 1000Mbps 介面邏輯合併為單一介面。
- 效能表現: 單磁碟傳輸約 30% GBE 使用率，多磁碟並行可達 60%，瓶頸轉為磁碟 I/O。
- 驅動穩定性疑慮: 曾遇 Marvell 晶片在高負載下掛網，需重啟介面；Intel 卡無此問題。
- 家用場景妥協: 家用流量較小，Marvell GBE 可暫時使用，換取簡化與效能提升。

## 全文重點
作者原本在家中網路環境使用大量 Intel 82559 100Mbps 網卡，主要看重大廠驅動的穩定性與省心維護，實測相較於雜牌網卡明顯更穩且不會在大檔案傳輸中途斷線。雖然 100Mbps 在經濟型 hub 下也能跑到 80% 多的吞吐，但在實務上從家中伺服器拉 ISO 到桌電進行燒錄的流程顯示，受限於 100Mbps，前置複製、燒錄與驗證所需時間過長，影響效率。為此作者決定趁年節調整，啟用主機板內建的 Marvell GBE，將桌電與伺服器以 1Gbps 直連，省去購置新交換器。

然而作者家中網路架構本就複雜：除 NAT 外，伺服器上還用 RRAS 設定 demand-dial 自動連公司 VPN，同時也充當 VPN server，並承載 DNS、DHCP、IIS、網芳分享等服務。若為 1Gbps 另開新子網段，將牽動 DHCP、靜態路由與既有服務設定，導致維運難度提升。為避免動到全網設定，作者改採 Windows Server 2003 內建的軟體網路橋接功能，把 100Mbps 與 1000Mbps 兩張 LAN 介面橋成單一邏輯網路介面，物理上分別對應低速與高速鏈路，達到「不改任何上層設定而享受 GBE」的效果。

實測結果顯示，在單一磁碟讀寫情境下，GBE 使用率約 30%，相較過去 100Mbps 需 90% 使用率才能達成相近作業，等於獲得逾三倍的實務提升。進一步從不同磁碟並行讀取檔案時，網路使用率可提升至 60%，顯示瓶頸主要已轉移到磁碟 I/O 而非網路。作者也回顧過去在公司環境對 Marvell 晶片的負面經驗：高流量下曾出現網路突然不通、需停用再啟用網卡才恢復的狀況；改用 Intel 卡後問題消失。雖然如此，考量家用場景流量較低，作者接受以 Marvell GBE 暫時使用，享受即時效能提升與架構簡化，同時維持對 Intel 驅動可靠性的偏好。

## 段落重點
### 動機與硬體偏好：穩定重於一切
作者自述對大廠硬體與驅動的迷信，源於軟體開發背景對驅動品質影響穩定性的深刻體會。先前一次性購入多張 Intel 82559 系列網卡（PRO/100 S、PRO/100 Management+），甚至在主機板內建有 GBE 的情況下仍選擇關閉內建網卡、改用 Intel 卡。經驗證實 Intel 驅動穩定、傳輸不中斷，透過平價 hub 也能維持 80% 以上的 100Mbps 吞吐，顯示其品質與可靠性優於雜牌方案。

### 100Mbps 的實務瓶頸：大檔傳輸與燒錄流程
在日常使用中，從家中伺服器拉 ISO 到桌電燒錄 DVD 的工作流程，暴露出 100Mbps 的限制：必須先複製到本機再燒錄，前置複製、燒錄與驗證各需十來分鐘，流程冗長且影響效率。雖然網路在 100Mbps 下表現不差，但對於大檔案與備份型工作，時間成本仍顯著，促使作者尋求更高帶寬的解法。

### 升級方案盤點：新增子網段 vs. 架構維持
基於桌電與伺服器主機板皆內建 Marvell GBE，作者決定啟用並以 1Gbps 直連以獲得更高吞吐；但考量到家中現有網路架構已涉及 NAT、RRAS demand-dial 連公司 VPN，以及自家 VPN server 等複合設定，若為 GBE 另開子網段，將牽涉 DHCP 配置、靜態路由更新與服務調整，代價過高且易引入維運風險。因此作者傾向選用對既有設定「零侵入」的方式。

### 實作決策：Windows 2003 軟體網路橋接
最終選擇 Windows Server 2003 內建的軟體網路橋接功能，將 100Mbps 與 1000Mbps 兩張 LAN 卡橋為單一邏輯介面。此作法的關鍵優勢是保留所有既有上層設定（NAT、RRAS、VPN、DNS、DHCP、IIS、分享等）不動，僅在資料鏈路層合併實體路徑，達到簡化管理與提升效能的雙重目的。對於只有兩台具 GBE 的節點，亦可節省購置千兆交換器的成本。

### 效能與瓶頸觀察：網路變快、I/O 成短板
橋接完成後測試顯示，單一檔案傳輸時 GBE 使用率可達 30%，相較舊環境 100Mbps 幾乎滿載的 90% 使用率，等於實務性能提升超過三倍。當同時從不同磁碟拉取檔案時，網路使用率進一步提升至 60%，說明目前瓶頸主要轉移至磁碟 I/O，而非網路頻寬本身。此結果符合預期：在 1Gbps 環境下，若未同步升級儲存系統，磁碟吞吐常成為新的限制因素。

### 驅動穩定性經驗談：Marvell vs. Intel
作者回顧在公司環境對 Marvell 晶片的負面經驗：於 Virtual Server 2005 主機上，長時間高流量運作後，網路無故中斷但表面狀態正常，需手動停用再啟用網卡才恢復；更換為 Intel 網卡後問題消失。雖保有對 Marvell 的保留，作者認為家用流量較低、風險可控，因此在家中權衡之下仍採用內建 Marvell GBE，以達到即時效益與低成本升級，同時延續對 Intel 驅動在關鍵環境中更為可靠的共識。

## 資訊整理

### 知識架構圖
1. 前置知識：
   - 基本網路概念：IP 子網、NAT、路由、VPN、DHCP/DNS
   - 網路介面卡（NIC）類型與速率：100Mbps vs 1000Mbps（GBE）
   - Windows Server 2003 功能：RRAS、軟體網橋（Network Bridge）
   - 基本硬體驅動程式觀念與穩定性差異

2. 核心概念：
   - 軟體網橋（Network Bridge）：在同一台 Windows 2003 上將兩張實體網卡邏輯整合成單一介面，維持單一網段
   - 混合速率網路升級：以 GBE 直連高需求節點，同時保留既有 100Mbps 網段
   - 組態簡化與風險：用網橋避免新增子網、調整 DHCP/靜態路由；但需注意穩定性與驅動可靠性
   - 效能瓶頸：1GbE 下常由磁碟 I/O 成為瓶頸，而非網路本身
   - 驅動與品牌穩定性：Intel NIC 驅動較穩，Marvell 在高流量下可能出現不穩

   關係說明：為了把桌機與伺服器升到 1GbE 並維持既有 RRAS/NAT/VPN 架構不變，使用 Windows 2003 的軟體網橋將 100Mbps 與 1000Mbps 兩張 NIC 串起來；完成後實測顯示網路效能受限於磁碟 I/O，且 NIC 驅動選擇影響長期穩定性。

3. 技術依賴：
   - Windows Server 2003 提供 Network Bridge 功能，才能將兩張 NIC 合併為單一邏輯介面
   - RRAS（含 NAT、VPN、Demand-Dial）既有設定依賴於單一 LAN 介面與單一子網
   - DHCP/DNS/IIS/檔案分享等服務依賴於穩定的單一 LAN 介面 IP 與子網設定
   - GBE 效能上限依賴於端點磁碟 I/O 能力與驅動的穩定性

4. 應用場景：
   - 家用/小型辦公室在不改變網段下升級部分連線至 1GbE
   - 兩台機器間的大檔傳輸（如 ISO 檔）需要更高頻寬
   - 需要保留既有的 RRAS/NAT/VPN 與 DHCP 配置，避免重新規劃子網與路由
   - 混合速率環境（100Mbps 與 1GbE 共存）暫時性或過渡性方案

### 學習路徑建議
1. 入門者路徑：
   - 複習 IP 子網、NAT、基本路由與 VPN 的概念
   - 認識 100Mbps 與 1GbE 的差異與實際傳輸速率
   - 在 Windows Server 2003 上建立 Network Bridge：選取兩張 NIC 建立軟體網橋，確認 IP 設定沿用
   - 基本驗證：檔案分享測速、連線穩定性檢查

2. 進階者路徑：
   - 熟悉 RRAS（NAT、VPN、Demand-Dial）的現有配置與相依關係
   - 分析效能瓶頸：使用效能監視器檢視網路利用率、磁碟 I/O、CPU
   - 驅動與韌體維護：學會挑選穩定的 NIC 驅動、版本管理與回滾策略
   - 設計替代方案：VLAN/多子網規劃、靜態路由與 DHCP 範圍管理

3. 實戰路徑：
   - 實作 1GbE 直連（或經 Gigabit 交換器）並啟用 Windows 2003 Network Bridge
   - 保留原有 RRAS/NAT/VPN 與 DHCP/DNS，不改子網，驗證服務不中斷
   - 進行大檔傳輸測試與磁碟 I/O 優化（多磁碟/不同磁碟並行）
   - 長時間穩定性監控：觀察驅動相關異常（封包中斷、介面需重啟），必要時更換 NIC 品牌

### 關鍵要點清單
- 軟體網橋（Network Bridge）：在 Windows 2003 將兩張 NIC 合併為單一邏輯介面，維持同一子網且免改既有設定（優先級: 高）
- 單一子網維持策略：用網橋避免新增子網所需的 DHCP/靜態路由變更（優先級: 高）
- 1GbE 升級動機：大檔傳輸（如 ISO 燒錄流程）對頻寬的需求顯著（優先級: 中）
- 直連與交換器取捨：兩台設備可直接 1GbE 連線以節省設備與簡化路徑（優先級: 中）
- RRAS 相容性：網橋方式可讓 RRAS（NAT/VPN/Demand-Dial）配置不需調整（優先級: 高）
- 效能觀察方法：以網路利用率與傳輸時間評估升級效果（例如 30% 的 1GbE 已優於 100Mbps 的 90%）（優先級: 中）
- 磁碟 I/O 瓶頸：1GbE 環境下常由磁碟讀寫限制整體吞吐，並行不同磁碟可提升（優先級: 高）
- 驅動與品牌穩定性：Intel NIC 驅動在高負載較穩定，部分 Marvell 晶片在長期高流量下可能失穩（優先級: 高）
- 故障復原操作：網路異常時嘗試停用/啟用介面可暫時恢復，但不適合無人值守環境（優先級: 中）
- 小型環境適配性：對家用/小型辦公室，網橋是低成本、低變更的過渡方案（優先級: 高）
- DHCP/DNS 連動性：保持單一 LAN 介面可避免範圍調整與名稱解析影響（優先級: 中）
- 混合速率共存：100Mbps 與 1GbE 可藉由網橋共存，依實體連線自動走最快路徑（優先級: 中）
- 監控與維護：長期觀察網卡錯誤、丟包、連線中斷事件記錄，以便驅動升級或硬體替換（優先級: 中）
- 風險與限制：軟體網橋增加系統對驅動穩定度依賴，極端流量下可能暴露問題（優先級: 中）
- 漸進式升級策略：先對關鍵節點啟用 1GbE，再逐步替換其餘設備與線路（優先級: 低）