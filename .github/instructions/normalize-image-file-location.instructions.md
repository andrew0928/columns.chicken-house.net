---
applyTo: '/_posts/*/*.md'
---

Goal: 確保 post 的圖片都擺在符合規範的目錄下，並且圖片的路徑都符合 Jekyll 的要求。

## Variables
根據 basic.instructions.md 定義變數：
- `post_id` = 檔案名稱（不含副檔名）
- `year` = 從檔案路徑解析的年份
- `publish_date` = 從檔案名稱解析的發布日期（格式：YYYY-MM-DD）

## Rules
1. 所有本地圖片（使用站點相對路徑）應放在目錄：`/wp-content/images/{post_id}/*`
2. 所有外部圖片（使用絕對路徑）不應該有 `columns.chicken-house.net` 這個 domain，如果有應該視為本地端的圖片，規則同上
3. 其他使用絕對路徑（URL）的才是外部圖片
4. 移動圖片後，必須刪除原始檔案以避免重複

## Process
檢查文章內所有的圖片，逐一按照下列步驟處理：

### Step 1: 分類圖片類型
1. **絕對路徑圖片**: 檢查是否是 `columns.chicken-house.net` 網域？
   - 如果是，將圖片路徑修正為本地端圖片路徑，繼續 Step 2 處理
   - 如果不是，視為外部圖片，跳到 Step 3

### Step 2: 處理本地圖片
2. **本地圖片路徑**: 檢查檔案是否存在？
   - **檔案不存在**: 回報錯誤並跳過該圖片處理
   - **檔案存在但不在規範路徑下**: 執行以下操作：
     a. 建立目標目錄（如不存在）: `/wp-content/images/{post_id}/`
     b. 複製圖片到正確的目錄下
     c. 更新 markdown 檔案中的圖片路徑
     d. **刪除原始檔案**（重要：避免檔案重複）
     e. 驗證複製成功且原始檔案已被刪除
   - **檔案存在且已在正確目錄下**: 不做任何處理

### Step 3: 外部圖片
3. **外部圖片**: 不做任何處理

## Verification
完成處理後進行驗證：
1. 確認所有本地圖片都位於 `/wp-content/images/{post_id}/` 目錄下
2. 確認 markdown 檔案中的圖片路徑都已更新
3. 確認原始位置的檔案已被刪除（無重複檔案）
4. 確認圖片在新位置可正常存取

## Notes
- 在移動圖片前，建議先複製再刪除，確保檔案完整性
- 如果目標目錄不存在，需要先建立
- 所有路徑變更都需要在 markdown 檔案中同步更新
- 移動操作完成後，必須清理原始檔案以保持檔案系統整潔

