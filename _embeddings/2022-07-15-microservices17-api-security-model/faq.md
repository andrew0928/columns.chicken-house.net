# 微服務架構 - API 的安全管控模型

# 問答集 (FAQ, frequently asked questions and answers)

## Q: 為什麼在微服務架構下，API 的安全機制不能只交給 Infrastructure 團隊處理？
API 的安全需求不僅涉及網路層面的阻擋或防禦，還牽涉到「功能、資料、指令」等商業規則以及「誰能呼叫、誰來授權」等營運層面的考量。基礎建設人員通常難以掌握這些業務語境，因此必須在系統設計階段由開發與產品團隊一起定義安全模型，才能滿足現代系統的整合彈性與精細授權需求。

## Q: 設計 API 授權時，常見必須同時考量的三個維度是什麼？
1. 要管控「什麼」：是功能、資料還是指令？是否需要到 method 級／資料範圍級？  
2. 要管控「誰」：內部服務、公司團隊、外部合作廠商、最終客戶，甚至客戶的合作廠商。  
3. 由「誰」來管理授權：RD、PM/PO、客服人員，或提供自助化入口讓客戶自行管理。

## Q: 在高流量或多服務情境下，如何將 API 的安全機制 Offloading 出去以減輕服務負擔？
可利用 API Gateway 或 Reverse Proxy 於進入服務前先完成驗證與授權，例如：
• 雲端方案：Azure API Management 搭配 Azure Functions。  
• 自建方案：在 Ocelot、YARP 等可控程式碼的 Reverse Proxy 中外掛驗證邏輯。  
這類做法能把流量阻擋、Rate-Limit、Token 驗證等通用邏輯前移，讓後端微服務專注於商業邏輯。

## Q: 為什麼要先挑對「安全模型」再選擇具體框架或服務？
安全模型決定了授權邊界與商業規則，若模型選錯，後續再好的工具也難以覆蓋需求；反之，模型明確後就能自由在「應用框架中的 Middleware」或「API Gateway 方案」之間切換，隨服務規模演進，而不必重寫核心邏輯。

## Q: 文章中舉例的 MemberService 可能面臨哪些授權風險？
1. 使用者 A 若能呼叫 API 讀取到使用者 B 的個人資料，將造成個資外洩。  
2. 廠商 X 的伺服器若能跨租戶存取到廠商 Y 的資料，會導致商業機密暴露。  
3. 若廠商 X 將 API Key 交給外包團隊 Z，而沒有額外限制範圍或次數，Z 可能大量複製或外洩資料。  

## Q: 為了應對上述風險，API 管理還需要哪些額外限制條件？
除功能與資料層級的授權之外，常見額外限制有：  
• 請求來源 IP 白名單／黑名單  
• 存取時間區段限制  
• 流量或次數（Rate Limit）  
這些條件能進一步縮小攻擊面或誤用範圍，降低資安與營運風險。