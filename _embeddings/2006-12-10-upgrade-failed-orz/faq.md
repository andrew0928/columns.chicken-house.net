# 升級失敗... Orz

## 問題與答案 (FAQ)

### Q&A 類別 A: 概念理解類

A-Q1: 什麼是 Community Server（CS）2.x？
- A簡: Community Server 是基於 ASP.NET 的社群平台，提供部落格、論壇、檔案分享等功能。2.x 指主版本 2 的系列版本。
- A詳: Community Server（CS）是 Telligent 早期推出的 ASP.NET 社群平台，整合部落格、論壇、相簿與使用者管理。2.x 表示主版本為 2 的系列（如 2.0、2.1、2.1 SP2），通常包含功能增強與修正。本文情境為從 2.0 RTM 升級至 2.1 SP2，涉及網站檔案更新與資料庫結構升級。了解其架構與版本意涵，有助於掌握升級時的相依關係、配置變更與回滾策略。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q2, A-Q3, B-Q1

A-Q2: RTM 與 Service Pack（SP）有何差異？
- A簡: RTM 是正式出貨版本；SP 是累積修正與增強的更新包，改善穩定性與相容性。
- A詳: RTM（Release to Manufacturing）是產品首次正式釋出的穩定版本。Service Pack（SP）則是官方累積修補、相容性改善與部分功能提升的更新集合，通常不改變主要架構，但會調整組件版本、設定需求與資料庫結構。升級至 SP2 能降低已知缺陷風險，但也可能引入相依性變更，因此需在測試環境演練並備妥回滾策略。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q3, B-Q1, C-Q2

A-Q3: 什麼是 CS 2.1 SP2？
- A簡: CS 2.1 SP2 是 2.1 版本的第二個服務包，重點在修正與穩定性提升。
- A詳: CS 2.1 SP2 屬於 2.1 分支的累積更新，通常包含安全修補、效能改善與相容性調整。相較 2.0 RTM，2.1 SP2 可能更新組件、調整 web.config 樣板、引入資料庫結構變更。升級需同步處理「檔案與資料庫」兩端，確保版本一致，並驗證自訂外掛、主題與設定在新版本仍可運作。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q2, B-Q2, B-Q3

A-Q4: 什麼是「2.x → 2.1 升級 SQL 腳本」？
- A簡: 這是將資料庫結構與資料轉換至 2.1 版所需的遷移腳本。
- A詳: 升級 SQL 腳本是官方提供的資料庫遷移檔，用於將既有的 2.x 資料庫升級到 2.1 所需的結構與資料狀態。內容通常包含新增欄位、調整索引、更新預設資料與版本標記。執行順序、資料庫備份與權限設定相當重要，避免中斷造成半套狀態。執行後需搭配新版本程式檔案，保持應用與資料庫版本一致。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q3, C-Q3, D-Q4

A-Q5: 什麼是 Shadow Copy（陰影複製）？
- A簡: Shadow Copy 是作業系統層級的快照，能快速備份與回復檔案狀態。
- A詳: Shadow Copy（Volume Shadow Copy Service, VSS）是在特定時間點對磁碟卷建立一致性快照，讓系統可在不中斷服務下進行備份或快速回復。升級前建立快照可在失敗時迅速回滾檔案，降低停機與風險。但要注意資料庫是否納入同一快照；若檔案已回滾而資料庫未回滾，會造成版本不一致，導致應用無法啟動。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q6, B-Q6, D-Q3

A-Q6: 為什麼升級前要做 Shadow Copy 或備份？
- A簡: 備份可在升級失敗時快速回復，避免長時間中斷與資料損失。
- A詳: 升級牽涉檔案與資料庫雙方改動。一旦失敗，若缺乏可用備援，將難以迅速恢復服務。Shadow Copy 或完整備份可在短時間內回復至既知良好狀態。最佳做法是同時備份網站檔案與資料庫，確保版本一致回復，並在測試環境演練還原流程，縮短復原時間與風險。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q1, C-Q6, D-Q3

A-Q7: 為什麼 CS 會隱藏詳細錯誤訊息？
- A簡: 為降低安全風險與避免洩漏細節，預設用簡訊息遮蔽堆疊資訊。
- A詳: 多數 Web 應用在生產環境預設隱藏詳細例外（如堆疊、連線字串）以避免洩漏內部資訊。CS 也常透過自訂錯誤頁與回報機制收攏詳細內容。診斷時應暫時關閉 customErrors、開啟 debug 或 tracing，並在受控環境下抓取詳細錯誤與日誌，完成後再恢復保護性設定，兼顧安全與可維運性。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q4, B-Q4, D-Q2

A-Q8: 升級失敗的常見風險有哪些？
- A簡: 版本不相容、檔案與資料庫不同步、權限不足、設定衝突、外掛不相容。
- A詳: 升級風險主要包括：組件版本衝突（DLL 未同步）、web.config 變更未合併、升級腳本部分失敗造成資料庫半套狀態、檔案/資料庫回滾不同步、自訂主題或外掛與新版本不相容、IIS/應用集區 .NET 版本不符、檔案/資料夾權限不足、連線字串誤改。預防需完整備份、演練、比對設定差異與驗證外掛相容性。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q8, D-Q1, D-Q5

A-Q9: 檔案升級與資料庫升級有何差異？
- A簡: 檔案升級更新程式與設定；資料庫升級調整結構與資料，需版本一致。
- A詳: 檔案升級包含替換應用程式 DLL、前端資源與 web.config 模板合併。資料庫升級則透過 SQL 腳本變更表結構、索引與系統資料。兩者需同步操作並驗證版本表（或設定）一致。單側成功會導致啟動時出現不相容錯誤，如缺欄位、未載入正確 Provider 或序列化格式不符。升級流程應定義明確順序與檢查點。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q3, C-Q3, D-Q3

A-Q10: 什麼是回滾（Rollback）？為何重要？
- A簡: 回滾是在故障時將系統恢復至先前狀態，確保服務快速復原。
- A詳: 回滾是變更管理的關鍵機制，當升級或部署失敗時，迅速恢復到已知可用版本，降低停機。有效回滾要求「可驗證的備份」、明確步驟、檔案與資料庫一致性策略（同時回復），並有完整復原測試。若僅回滾檔案未回滾資料庫，將造成版本不相容問題，反而延長故障時間。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q7, D-Q3, B-Q14

A-Q11: 生產環境與測試環境升級策略有何差異？
- A簡: 測試環境先演練驗證；生產環境強調風險控管、備份與回滾速度。
- A詳: 測試/預備環境用於完整演練升級步驟、驗證相容性、量測效能與找出隱藏依賴。生產環境則要最小化中斷：安排維護時段、公告、凍結變更、完整備份、執行前檢查清單與回滾方案。兩環境資料與設定愈接近，演練結果越可信，能有效避免「到生產才出問題」的情況。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q2, C-Q9, B-Q10

A-Q12: 為什麼要依說明更新檔案並執行 SQL？
- A簡: 因為新版本同時更動程式與資料庫，需同步升級才能正常運作。
- A詳: 官方升級指引會指定檔案替換、web.config 合併與資料庫遷移步驟。應用程式與資料庫存在版本耦合，缺一即可能啟動失敗或功能異常。依文件順序操作，可避免遺漏關鍵步驟（如清理舊檔、更新權限、跑資料修補），並在每個檢查點驗證健康狀態，降低風險。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q1, B-Q3, C-Q3

A-Q13: 「開不起來」在 IIS/ASP.NET 中是什麼症狀？
- A簡: 常見表現為 500 錯誤、空白頁、應用集區反覆回收或 CS 顯示通用錯誤。
- A詳: 在 IIS/ASP.NET，啟動失敗可能呈現 HTTP 500、500.19（組態無效）、403.x（權限）、或僅顯示通用錯誤頁。背後原因包含 web.config 語法錯、組件版本衝突、連線字串無法連線、資料庫遷移不完整、應用集區 .NET 版本不符、路徑或檔案權限不足。需配合事件檢視器、IIS 日誌與應用程式日誌診斷。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: D-Q1, D-Q9, C-Q5

A-Q14: 為何要關閉自訂錯誤以觀察詳細錯誤？
- A簡: 關閉 customErrors 與開啟 debug/trace 能顯示堆疊資訊，利於精準定位。
- A詳: 生產環境預設隱藏細節，利安全但阻礙除錯。於受控情境暫時將 web.config 中 customErrors 設為 Off、compilation debug 為 true，並可啟用 tracing/health monitoring，即可在瀏覽器或追蹤檔看到具體例外、路徑、設定載入資訊。完成排查後須立即恢復，以免暴露敏感資訊。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q4, D-Q2, B-Q4

A-Q15: 什麼是維護時段（Maintenance Window）？
- A簡: 預先公告的系統變更與停機時段，用於安全執行升級與回滾。
- A詳: 維護時段是計畫性變更的時間窗口，讓團隊可在低峰期執行升級、備份、資料遷移與驗證，並保留足夠回滾緩衝。包含對外公告、服務降載或暫停、變更凍結、監控加強、聯絡窗口與決策標準。良好安排可降低對使用者影響並提升成功率。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q9, B-Q10, D-Q10

A-Q16: 什麼是版本相容性與相依性管理？
- A簡: 確保應用、組件、配置與資料庫版本彼此匹配並能正常運作。
- A詳: 版本相容性涉及應用程式 DLL、外掛、主題、web.config 結構、.NET Framework 與資料庫 Schema。升級時必須檢查相依性（如 Provider 名稱、設定鍵、API 變更），並比對變更紀錄。可透過版本表、檢查清單與自動化比對，避免「檔案升級但資料庫未升級」或外掛使用已移除 API 的狀況。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q8, D-Q5, C-Q8

---

### Q&A 類別 B: 技術原理類

B-Q1: CS 的整體升級流程如何運作？
- A簡: 按官方步驟同步更新檔案與資料庫，逐步驗證、記錄與可回滾。
- A詳: 升級流程一般包含：準備（備份/快照、凍結變更）、檔案更新（替換 DLL/內容、合併 web.config）、資料庫遷移（依腳本順序執行、驗證版本表）、清理快取/重啟 IIS、驗證關鍵功能、監控與回滾預案。過程中應設置檢查點與記錄，確保任何一步失敗可快速回退，不留半套狀態。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q12, C-Q1, C-Q3

B-Q2: 2.0 → 2.1 SP2 的檔案替換機制如何設計？
- A簡: 以新版本覆蓋舊檔並合併設定，確保組件與配置一致。
- A詳: 檔案替換包含部署新版二進位（bin 下 DLL、網站資源）、引入新版 web.config 模板變更（新增/調整 keys、handlers、modules），並移除已廢棄檔案。需避免殘留舊 DLL 造成組件衝突，且合併配置時保留站台特有設定（連線字串、郵件、檔案儲存）。完成後清除暫存與快取，重啟應用集區以載入正確組件。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q3, B-Q8, C-Q8

B-Q3: 升級 SQL 腳本背後做了哪些事？
- A簡: 變更資料表結構、索引與系統資料，並標記新的 Schema 版本。
- A詳: 腳本會新增/移除/修改欄位與索引、遷移或修補資料、更新預設設定與權限，最後更新版本表（或屬性）以標記資料庫 Schema。部分步驟需鎖表或短暫停機。嚴格的順序與事務控制可防止半套狀態；失敗時需回復資料庫備份，避免與檔案版本不匹配造成啟動失敗。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q4, C-Q3, D-Q4

B-Q4: CS 自訂錯誤回報的機制是什麼？
- A簡: 藉由自訂錯誤頁與記錄，對外隱藏詳細堆疊，內部保留診斷。
- A詳: 典型做法是啟用 customErrors 與自訂錯誤頁，攔截未處理例外，向使用者顯示簡訊息，同時寫入伺服器端日誌或寄出通知。在開發/診斷時，可關閉 customErrors、開啟 tracing 與 debug，以顯示完整堆疊與請求脈絡。完成後恢復保護設定，避免敏感資訊外泄。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q7, A-Q14, C-Q4

B-Q5: IIS/ASP.NET 啟動流程與「開不起來」的關係？
- A簡: 應用載入組件與配置，若配置錯誤或相依失敗會拋例外導致 500。
- A詳: ASP.NET 啟動時會解析 web.config、載入 assemblies、初始化 HttpModules/Handlers、建立依賴與連線。任一步驟出錯（組件版本不符、配置節誤、權限不足、資料庫連線失敗），IIS 會回傳 500/500.19 或顯示應用自訂錯誤頁。透過事件檢視器、Failed Request Tracing 與應用日誌可定位失敗點。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q13, D-Q1, D-Q9

B-Q6: Shadow Copy（VSS）如何運作？
- A簡: 以快照技術凍結檔案系統狀態，支援一致性備份與快速回復。
- A詳: VSS 透過協調寫入者與提供者，在快照瞬間凍結磁碟卷狀態，建立時間點一致的副本。應用可持續運作，備份工具從快照讀取資料，不影響線上負載。回復時將檔案還原至快照狀態。若資料庫支援 VSS，能與檔案同步一致；否則需另行備份資料庫以避免版本漂移。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q5, C-Q6, D-Q3

B-Q7: 回復 Shadow Copy 的關鍵步驟是什麼？
- A簡: 停止服務、選擇快照、還原檔案、驗證一致性、重啟並檢查。
- A詳: 回復流程包含：1) 宣告維護、阻擋新流量；2) 停止 IIS 應用集區；3) 選擇目標快照；4) 還原網站檔案與設定；5) 視需要回復資料庫或驗證版本表一致性；6) 清除快取/temp；7) 重啟 IIS；8) 進行冒煙測試。若資料庫未回復，需確定應用版本與 Schema 相容，否則應同步回復資料庫。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: C-Q7, D-Q3, B-Q6

B-Q8: 版本相依性檢查應包含哪些面向？
- A簡: 檢查組件版本、web.config 差異、資料庫 Schema、外掛與環境版本。
- A詳: 相依性檢查需確認：bin 資料夾 DLL 版本與簽章、web.config 新增/變更節點（handlers、modules、設定鍵）、資料庫版本表與現有欄位/索引、外掛 API 相容性、主題資源路徑、IIS/Framework 版本、檔案/資料夾權限。可用自動化 diff 與檢查清單降低遺漏風險。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q16, C-Q8, D-Q5

B-Q9: 日誌與追蹤如何幫助定位升級問題？
- A簡: 蒐集 IIS/FREB、應用日誌、事件檢視器與資料庫日誌，交叉比對。
- A詳: IIS 日誌提供請求層級狀態碼，Failed Request Tracing（FREB）可截取 500 詳情。事件檢視器顯示應用集區與 .NET 例外。應用層日誌或 tracing 可捕捉堆疊與設定值。資料庫日誌可協助定位連線與查詢錯誤。建立統一時間線，快速縮小失敗環節與根因。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: C-Q5, D-Q1, D-Q9

B-Q10: 維運與變更管理流程如何設計？
- A簡: 設置審核、演練、備份、實施、驗證、回滾與事後檢討的閉環。
- A詳: 變更流程包含：需求審核與風險評估、測試環境演練、建立備份/快照、維護時段實施、分階段驗證（健康檢查/關鍵路徑）、若失敗則回滾；成功則監控觀察期與事後檢討（Postmortem）。配合自動化與標準化文件，可提升升級成功率與可追溯性。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q11, A-Q15, C-Q10

B-Q11: Schema 版本與應用版本如何綁定？
- A簡: 以版本表或設定值記錄 Schema 版號，啟動時校驗匹配。
- A詳: 多數系統在資料庫放置版本表（如 VersionInfo）記錄 Schema 版號；應用啟動時檢查是否與應用程式期望版本一致。不一致時可拒絕啟動或進行遷移。此設計避免誤用錯誤版本而導致資料異常，並提供升級/回滾的自動核對點。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q9, D-Q3, C-Q3

B-Q12: 為何生產環境預設隱藏詳細錯誤屬必要機制？
- A簡: 避免洩漏系統內部資訊造成安全風險與被攻擊面擴大。
- A詳: 詳細錯誤常包含堆疊、路徑、連線、版本等敏感資訊，攻擊者可據此利用。生產環境以自訂錯誤頁提供一致用戶體驗並保護細節，內部則以日誌存證供診斷。在安全與可維運之間取平衡：需要時短暫開啟詳細錯誤於受控環境，不對外暴露。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q7, A-Q14, D-Q2

B-Q13: 相依服務（SQL、檔案系統、郵件）如何影響啟動？
- A簡: 任一關鍵相依不可用或配置錯誤，啟動階段即可能失敗。
- A詳: CS 啟動會檢查資料庫連線與必要資源（檔案儲存路徑、快取、郵件設定）。若連線字串錯誤、無法授權、路徑不存在/無權限、必要服務未啟動，初始化將拋例外。升級後尤其須驗證設定是否正確合併與權限是否完整承接。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: D-Q1, D-Q6, C-Q8

B-Q14: 如何設計可復原的升級（藍綠/影子部署）？
- A簡: 準備平行環境完成升級驗證，再切換流量；失敗即刻回切。
- A詳: 藍綠部署透過兩套相同環境（藍/綠），在新環境完成升級與驗證後切流。影子部署則將新版本於隱藏路徑運行，鏡射流量驗證。優點是快速回切降風險，但需資料同步策略（讀寫分離、停寫窗口或雙寫）與切換計畫。對重大升級尤為關鍵。
- 難度: 高級
- 學習階段: 進階
- 關聯概念: A-Q10, C-Q2, C-Q10

---

### Q&A 類別 C: 實作應用類（10題）

C-Q1: 升級前如何做好完整備份（檔案與資料庫）？
- A簡: 停止變更，備份網站檔案與資料庫，驗證可還原性並記錄校驗值。
- A詳: 步驟：1) 宣告凍結變更；2) 複製網站目錄與 bin；3) 以 VSS 建立快照；4) 對資料庫做完整備份（含交易記錄）；5) 驗證備份可還原（測試還原到暫存 DB）；6) 記錄備份時間、版本與校驗值；7) 存放於獨立儲存。注意：檔案與資料庫需同時點一致，避免回滾不一致。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q6, B-Q6, C-Q7

C-Q2: 如何在測試環境演練 2.0 → 2.1 升級？
- A簡: 複製生產資料與設定，完整跑升級步驟與驗證，記錄問題與解法。
- A詳: 步驟：1) 建立與生產相近環境（IIS/.NET/SQL 版本）；2) 匯入近期資料備份；3) 依官方文件更新檔案與執行 SQL 腳本；4) 合併 web.config 差異；5) 驗證登入、貼文、上傳、通知等關鍵流程；6) 壓力測試與日誌檢查；7) 紀錄時間與風險，形成生產變更計畫。注意脫敏資料與禁寄出站郵件。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q1, A-Q11, C-Q10

C-Q3: 如何正確執行 2.x → 2.1 升級 SQL 腳本？
- A簡: 以具權限帳號在目標資料庫依序執行，備份、開交易、驗證版本。
- A詳: 步驟：1) 備份資料庫；2) 使用 dbo 權限連線；3) 按文件順序執行腳本（避免跳步）；4) 觀察錯誤並逐段驗證變更（欄位/索引/版本表）；5) 完成後重建統計資訊；6) 與應用檔案同步更新；7) 驗證功能。注意：避免在高交易時段執行；若失敗，立即還原備份，勿留下半套狀態。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q4, B-Q3, D-Q4

C-Q4: 如何設定 web.config 顯示詳細錯誤以便排查？
- A簡: 暫時設 customErrors="Off"、compilation debug="true"，並啟用 tracing。
- A詳: 實作：在 web.config 加入或調整：
  <customErrors mode="Off"/>
  <compilation debug="true"/>
  <trace enabled="true" requestLimit="40"/>
  同時限制來源 IP 或僅在測試環境啟用。重啟 IIS 後重現問題，記錄堆疊與配置資訊。完成診斷即恢復設定避免洩密。最佳實踐：搭配伺服器事件檢視器與 IIS FREB。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q14, B-Q4, D-Q2

C-Q5: 如何系統化收集 CS 啟動失敗診斷資訊？
- A簡: 蒐集瀏覽器錯誤、IIS/FREB、事件檢視器、應用日誌與 SQL 狀態。
- A詳: 步驟：1) 記錄錯誤頁與時間；2) 啟用 IIS Failed Request Tracing 捕捉 500；3) 檢查 Windows 事件檢視器（應用/系統）；4) 開啟 web.config trace 或應用日誌；5) 測試資料庫連線與錯誤碼；6) 彙整時間線與關鍵堆疊；7) 交叉比對最近變更（檔案/設定/權限）。注意掩蔽敏感資訊分享於團隊。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q9, D-Q1, D-Q9

C-Q6: 如何使用 Shadow Copy 建立與復原快照？
- A簡: 於目標卷啟用 VSS，建立快照；失敗時選擇快照復原並驗證。
- A詳: 建立：透過系統保護或備份工具在網站與設定所在卷啟用 VSS，建立快照點並標註版本。復原：進維護模式，停止 IIS，選取快照還原檔案；如資料庫不在同卷，需以資料庫備份同步回復。完成後清快取、重啟、驗證功能。注意：確保磁碟空間與快照保留策略。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q5, B-Q6, B-Q7

C-Q7: 如何安全地回滾升級，保持檔案與資料庫一致？
- A簡: 同步回復網站檔案與資料庫備份至同一時間點，驗證版本表。
- A詳: 步驟：1) 宣告回滾；2) 停用流量與應用集區；3) 還原網站檔案（快照/備份）；4) 還原資料庫至對應時間點；5) 檢查資料庫版本表與應用版本一致；6) 重啟與驗證關鍵路徑；7) 監控。注意：避免只回檔不回庫，或相反；必要時啟用唯讀模式避免資料漂移。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q10, B-Q11, D-Q3

C-Q8: 如何比對升級前後的組態差異？
- A簡: 使用差異工具比對 web.config、DLL 清單與權限，建立變更報告。
- A詳: 實作：1) 對 web.config 進行結構化比對（handlers/modules/appSettings）；2) 列出 bin DLL 與版本簽章差異；3) 檢查檔案/資料夾 ACL 權限；4) 驗證連線字串與外部服務端點；5) 建立自動化腳本輸出差異報告。注意：保留站台客製設定，避免被模板覆蓋。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q2, B-Q8, D-Q5

C-Q9: 如何規劃與執行維護時段與對外公告？
- A簡: 選低峰期、公告時間與影響、提供聯絡窗與回滾時程。
- A詳: 步驟：1) 選擇低流量時段；2) 對外公告內容含：時間、預期影響、聯絡資訊；3) 內部凍結變更與排班；4) 預先健康檢查與備份；5) 執行升級、分階段驗證；6) 若失敗依計畫回滾；7) 完成後公告恢復。最佳實踐：預留緩衝、設關鍵決策點、全程監控。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q15, B-Q10, D-Q10

C-Q10: 如何建立自動化升級腳本與檢查清單？
- A簡: 腳本化備份、部署、遷移與驗證，清單化步驟與回滾條件。
- A詳: 內容：1) 備份與快照腳本；2) 部署檔案（複製/停站/清快取）；3) 執行 SQL 遷移與版本檢查；4) 合併配置與差異比對；5) 冒煙測試腳本（登入/發文/上傳）；6) 監控與日誌收集；7) 回滾腳本。附檢查清單列明前置條件、步驟、驗證點與中止/回滾判準，降低人為失誤。
- 難度: 高級
- 學習階段: 進階
- 關聯概念: B-Q10, B-Q14, C-Q2

---

### Q&A 類別 D: 問題解決類（10題）

D-Q1: 升級後網站「開不起來」怎麼辦？
- A簡: 先收集詳細錯誤與日誌，確認檔案/資料庫版本一致，再逐步排查。
- A詳: 症狀：500/空白頁/通用錯誤。原因：組件衝突、配置錯誤、資料庫遷移不完整、權限或相依服務問題。解法：1) 暫時關閉 customErrors、開 tracing；2) 檢查事件檢視器與 FREB；3) 比對 web.config 與 DLL；4) 驗證資料庫版本與連線；5) 若不可控，依計畫回滾。預防：完整演練、檢查清單與自動化驗證。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q13, B-Q5, C-Q5

D-Q2: 只看到「Error」無詳細訊息如何處理？
- A簡: 暫時開啟詳細錯誤與追蹤，並檢查伺服器端日誌與事件記錄。
- A詳: 症狀：頁面只顯示通用錯誤。可能是自訂錯誤頁遮蔽細節。解法：1) web.config 設 customErrors Off、debug true；2) 啟用 tracing；3) 查看應用日誌與事件檢視器；4) 有需要時在測試環境重現以確保安全。預防：建置標準化診斷流程，確保生產隱藏、測試可見的環境切換。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q7, A-Q14, C-Q4

D-Q3: 檔案已回滾但資料庫已升級，怎麼救？
- A簡: 屬版本不一致狀態，需同步回復資料庫或重新升級檔案。
- A詳: 症狀：2.0 檔案對 2.1 資料庫，啟動報缺欄位/不相容。原因：只回檔未回庫。解法：1) 還原資料庫至回滾同時間點；或 2) 重新部署 2.1 檔案並完成升級；3) 驗證版本表一致。預防：規劃同步回滾、建立時間點一致備份、在演練中驗證回復流程。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q9, B-Q7, C-Q7

D-Q4: 升級 SQL 腳本執行失敗如何排查？
- A簡: 確認權限、順序與前置條件，回復備份後重試並分段驗證。
- A詳: 症狀：腳本中斷、部分表更新失敗。原因：權限不足、已有物件/缺物件、鎖定或相依缺失。解法：1) 立刻還原備份避免半套；2) 於測試環境逐段執行找出失敗語句；3) 修正相依/順序；4) 確保帳號權限；5) 重試。預防：演練、事務包裹與版本檢查、維護時段執行。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q3, C-Q3, B-Q11

D-Q5: 組件版本衝突與相依性問題如何解決？
- A簡: 清理舊 DLL、比對版本、合併配置並移除廢棄項目。
- A詳: 症狀：TypeLoadException、MissingMethodException。原因：舊 DLL 殘留、API 變更、配置不符。解法：1) 清空 bin 後部署新 DLL；2) 以差異工具比對 web.config；3) 移除不再支援的 handlers/modules；4) 驗證外掛相容性。預防：嚴格版控、發行套件化與自動化差異檢查。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q2, B-Q8, C-Q8

D-Q6: 權限或路徑問題導致啟動失敗怎麼辦？
- A簡: 檢查網站目錄與上傳路徑 ACL、應用集區身分與連線權限。
- A詳: 症狀：403/500.19、存取被拒或路徑找不到。原因：部署後權限未承接、路徑改變、App Pool 帳號不足。解法：1) 驗證目錄/檔案 ACL（讀/寫/修改）；2) 確認 App Pool 身分；3) 檢查 web.config 指向的實體路徑；4) 測試資料庫權限。預防：權限檢查清單與部署腳本自動授權。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q13, C-Q8, D-Q9

D-Q7: 自訂外掛/主題與 2.1 不相容如何處理？
- A簡: 停用問題外掛、重建相容版本或替代，完成測試後再啟用。
- A詳: 症狀：啟動或特定頁面出錯。原因：API/模板變更。解法：1) 先在測試環境停用所有外掛與客製主題；2) 逐一啟用定位問題；3) 依新 API 修正編譯；4) 或尋找相容替代方案。預防：升級前做相容性盤點與演練，維護外掛清單與版本相依表。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q8, C-Q2, C-Q8

D-Q8: 升級造成資料遺失或錯亂怎麼辦？
- A簡: 立即停止寫入，從備份還原或以修補腳本更正，驗證後再開放。
- A詳: 症狀：缺欄位/資料不一致。原因：遷移中斷、腳本錯誤或舊資料不相容。解法：1) 關閉寫入與公告維護；2) 從備份還原至一致狀態；3) 在測試環境驗證修補腳本；4) 套用於生產並做驗證。預防：事務性腳本、完整備份、演練與驗證報表。
- 難度: 高級
- 學習階段: 進階
- 關聯概念: C-Q1, C-Q3, B-Q11

D-Q9: 如何診斷 IIS 層級的 500/500.19 錯誤？
- A簡: 啟用 FREB，檢查 web.config 語法/重複節點與模組對應。
- A詳: 500.19 多因 web.config 無效（重複定義、節點不支援）、模組缺乏或處理常式映射錯誤。解法：1) 啟用 Failed Request Tracing；2) 檢查 web.config 與 machine.config 差異；3) 確認對應 DLL 存在且相容；4) 驗證應用集區 .NET 版本。預防：配置合併流程、差異檢查與自動驗證。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q13, C-Q4, C-Q8

D-Q10: 如何預防再次發生升級失敗？
- A簡: 完整演練、雙重備援、標準化腳本與檢查清單、藍綠切換。
- A詳: 策略：1) 在預備環境完整演練並記錄時序；2) 準備檔案+資料庫一致性備份；3) 腳本化部署/遷移/驗證/回滾；4) 維護時段並建立決策點；5) 優先採用藍綠或影子部署快速回切；6) 事後檢討與改進。持續化改良可大幅降低升級風險。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q14, C-Q10, A-Q15

---

### 學習路徑索引
- 初學者：建議先學習哪 15 題
    - A-Q1: 什麼是 Community Server（CS）2.x？
    - A-Q2: RTM 與 Service Pack（SP）有何差異？
    - A-Q3: 什麼是 CS 2.1 SP2？
    - A-Q4: 什麼是「2.x → 2.1 升級 SQL 腳本」？
    - A-Q5: 什麼是 Shadow Copy（陰影複製）？
    - A-Q6: 為什麼升級前要做 Shadow Copy 或備份？
    - A-Q7: 為什麼 CS 會隱藏詳細錯誤訊息？
    - A-Q12: 為什麼要依說明更新檔案並執行 SQL？
    - A-Q14: 為何要關閉自訂錯誤以觀察詳細錯誤？
    - A-Q15: 什麼是維護時段（Maintenance Window）？
    - B-Q1: CS 的整體升級流程如何運作？
    - C-Q1: 升級前如何做好完整備份（檔案與資料庫）？
    - C-Q4: 如何設定 web.config 顯示詳細錯誤以便排查？
    - D-Q2: 只看到「Error」無詳細訊息如何處理？
    - D-Q10: 如何預防再次發生升級失敗？

- 中級者：建議學習哪 20 題
    - A-Q8: 升級失敗的常見風險有哪些？
    - A-Q9: 檔案升級與資料庫升級有何差異？
    - A-Q11: 生產環境與測試環境升級策略有何差異？
    - A-Q13: 「開不起來」在 IIS/ASP.NET 中是什麼症狀？
    - A-Q16: 什麼是版本相容性與相依性管理？
    - B-Q2: 2.0 → 2.1 SP2 的檔案替換機制如何設計？
    - B-Q3: 升級 SQL 腳本背後做了哪些事？
    - B-Q4: CS 自訂錯誤回報的機制是什麼？
    - B-Q5: IIS/ASP.NET 啟動流程與「開不起來」的關係？
    - B-Q6: Shadow Copy（VSS）如何運作？
    - B-Q7: 回復 Shadow Copy 的關鍵步驟是什麼？
    - B-Q8: 版本相依性檢查應包含哪些面向？
    - B-Q9: 日誌與追蹤如何幫助定位升級問題？
    - B-Q11: Schema 版本與應用版本如何綁定？
    - B-Q13: 相依服務（SQL、檔案系統、郵件）如何影響啟動？
    - C-Q2: 如何在測試環境演練 2.0 → 2.1 升級？
    - C-Q3: 如何正確執行 2.x → 2.1 升級 SQL 腳本？
    - C-Q5: 如何系統化收集 CS 啟動失敗診斷資訊？
    - C-Q6: 如何使用 Shadow Copy 建立與復原快照？
    - C-Q8: 如何比對升級前後的組態差異？

- 高級者：建議關注哪 15 題
    - B-Q10: 維運與變更管理流程如何設計？
    - B-Q14: 如何設計可復原的升級（藍綠/影子部署）？
    - C-Q7: 如何安全地回滾升級，保持檔案與資料庫一致？
    - C-Q9: 如何規劃與執行維護時段與對外公告？
    - C-Q10: 如何建立自動化升級腳本與檢查清單？
    - D-Q1: 升級後網站「開不起來」怎麼辦？
    - D-Q3: 檔案已回滾但資料庫已升級，怎麼救？
    - D-Q4: 升級 SQL 腳本執行失敗如何排查？
    - D-Q5: 組件版本衝突與相依性問題如何解決？
    - D-Q6: 權限或路徑問題導致啟動失敗怎麼辦？
    - D-Q7: 自訂外掛/主題與 2.1 不相容如何處理？
    - D-Q8: 升級造成資料遺失或錯亂怎麼辦？
    - D-Q9: 如何診斷 IIS 層級的 500/500.19 錯誤？
    - A-Q8: 升級失敗的常見風險有哪些？
    - A-Q16: 什麼是版本相容性與相依性管理？