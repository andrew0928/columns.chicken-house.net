# 網路搶票小幫手 - 遠端網站時鐘, WebServerClock v1.0

## 摘要提示
- 目的: 解決本機時鐘與售票網站時鐘不同步，提升「按秒下單」的成功率。  
- 核心思路: 透過 HTTP Response Header 的 Date 欄位推算伺服器時間差。  
- 精確度: 以單次封包往返時間／2 為最大可能誤差值。  
- 技術實作: C# + HttpClient，程式碼不足百行即可完成。  
- 假設條件: 網站必定回傳 Date Header，且使用者只需偶爾同步一次。  
- NTP 比較: 無法保證目標網站開放 NTP，故改取 HTTP Date。  
- 使用方式: 輸入網址 ➜ 按「同步」➜ GUI 立即顯示校正後的伺服器時間。  
- 開源授權: GitHub 專案 WebServerClock，歡迎 clone、PR、Issue。  
- 適用場景: 線上訂票、秒殺搶購、任何需與伺服器同秒點擊的情境。  
- 限制: 未實作防呆，URL 格式錯誤或無 Date Header 需自行處理。  

## 全文重點
作者因經常搶火車票而發現：若電腦時間與售票網站時間不同步，即使「準點」點擊也會錯過購票時機。正式的網路對時應使用 NTP，但多數售票或秒殺網站既沒有公開 NTP 伺服器，也不一定開啟 NTP Client，因此作者改用所有 HTTP/1.1 伺服器幾乎必回傳的 Date Response Header 來推算時差。  
執行流程為：用 HttpClient 送出 HEAD 要求並記錄 T0 時間；收到回應後立刻記錄 T3 時間；將 Response Header 的 Date 值視為伺服器在 T1’ 時間點回傳；假設整趟往返延遲平均，可用 (T3-T0)/2 作為估計，把 T0 + (T3-T0)/2 當作本機感知的「伺服器計時點」。兩時間相減即可得出 Offset。接著 GUI 以本地系統時間 + Offset 即時顯示「模擬伺服器時間」，並每 30 毫秒更新一次，方便使用者掐秒按鈕。  
作者提醒，此方法最大誤差即 (T3-T0)/2，足以應付大多秒殺場景但不保證毫秒級精度；且程式僅在按下「同步」時與伺服器通訊一次，不會造成流量或被封 IP。專案不足百行程式碼，已於 GitHub 開源，歡迎自行編譯或提交改進。  

## 段落重點
### 前言與動機
作者常為訂花東火車票煩惱，發現本機與伺服器時鐘差距會影響搶票成功率。文中強調本工具不是自動搶票機器人，而是一個幫助使用者更精準按下購票按鈕的輔助程式。  

### 運作原理
1. 標準對時應靠 NTP，但大多售票網站無 NTP 服務，故退而求其次使用 HTTP/1.1 規範必帶的 Date Header。  
2. RFC2616 說明 Server 在大部分情況必須送出 Date；即便精度不如 NTP，仍是唯一可靠資訊來源。  
3. 設計假設：Date Header 時間點落在傳輸過程的中段，故以封包往返耗時一半作為估計偏差。  

### 程式碼說明
使用 C# WinForms 實作：  
- 建立 HttpClient，對使用者輸入的 URL 發送 HEAD。  
- 記錄送出與收到回應的時間 (T0、T3)。  
- 解析 Response Header 的 Date 為 T1’。  
- Offset ＝ T1’ − (T0 + (T3 − T0)/2)。  
- 將 Offset 套用在本機時鐘，每 30ms 刷新畫面。GUI 也顯示 Offset 及最大誤差值以供參考。  

### Release Notes 與開源
作者於實戰搶票中驗證效果良好，但程式只為自用，尚未加入網址格式檢查、Date Header 缺失處理等防呆機制。故直接將原始碼以 WebServerClock 專案釋出，邀請社群自行編譯、回報問題或提交 Pull Request。  

