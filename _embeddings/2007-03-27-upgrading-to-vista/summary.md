# 升級 Vista ...

## 摘要提示
- 升級動機: 家用伺服器負載極低，決定改裝成桌機並升級至 Vista。
- 角色整合: 同一台 PC 需同時擔任網路服務、檔案伺服器、MCE、批次工作與桌機。
- 核心衝突: 網路服務 (RRAS/IIS 等) 與 MCE 無法共存於同一作業系統。
- 虛擬化解法: 將網路服務移至 Virtual PC 的 guest OS，其餘留在主機端。
- 主機系統選擇: 採用 Vista Ultimate，為減少折騰直接購買正版。
- 效能觀察: 原本 E6300+3GB 的服務，移到 VPC 只給 256MB 仍無體感變慢。
- VPC 限制: 不支援 SMP，CPU 只吃到半顆核心，但仍足以承載輕負載服務。
- 資料保護: 延續 RAID-1 與 Volume Shadow Copy 以保護重要檔案與影音。
- 使用情境: MCE 觀影錄影、每週備份與轉檔、一般上網與遊戲。
- 後續規劃: 先在 VPC 試玩 Vista（含 32/64 位元），正式換裝另擇時機。

## 全文重點
作者將家中的 Windows Server 2003 x64 主機（原作為網站與檔案伺服器）改裝為桌上型電腦並升級到 Vista。由於該機器長期負載僅約 5%，硬體資源明顯過剩，決定重新定位並整合多種角色：網路基礎服務（RRAS、IIS、Media Service、SQL Express、DNS、DHCP、SMTP）、檔案伺服器（延續軟體 RAID-1 與 Volume Shadow Copy 來保護照片、DV 影片與個人文件）、MCE 媒體中心（看電視、錄影、節目表）、批次工作（每週備份與影音轉檔）、以及一般桌機用途（上網與遊戲）。

推進計畫時遇到的最大技術難點在於網路服務與 MCE 幾乎互斥，無法穩定共存於同一套作業系統。為化解衝突，作者採取虛擬化：將所有網路基礎服務（第1類）搬到 Virtual PC 的 guest OS 上執行，其餘需求（第2至第5類）留在 Host OS 上，由 Vista Ultimate 承擔。儘管 Virtual PC 不支援多核心（SMP），導致只用到半顆核心，且初期僅配置 256MB 記憶體，實測與使用者回饋都顯示服務體感沒有變慢，驗證原先以 E6300 + 3GB RAM 跑這些服務屬於資源過度配置。後續作者將 VPC 記憶體增至 512MB 以求更穩定。

在作業系統選擇上，作者基於過去被 MCE 網路啟動問題折騰的經驗，這次直接購買 Vista Ultimate 正版以節省時間與降低相容性風險。儘管 Vista 安裝包同時提供 32 與 64 位元版本，正式更換主機系統仍是一項大工程，因此決定先在 VPC 環境中安裝並試用，待驗證穩定性與相容性後再安排正式切換。整體而言，藉由虛擬化分工與主機採用 Vista，作者兼顧了家庭媒體娛樂、資料安全、網路服務與日常桌機需求，同時更有效率地使用現有硬體資源。

## 段落重點
### 升級背景與動機
作者原使用 Windows 2003 x64 作為家用網站與檔案伺服器，但實際負載不到 5%，硬體資源閒置嚴重。基於提升資源使用效率與整合家庭應用的考量，決定將同一台 PC 轉型為桌機並升級至 Vista，讓單機同時扮演伺服器與娛樂/日常使用的多重角色。

### 功能需求與範疇
規劃中，電腦需處理五大項目：1) 網路核心服務（RRAS、IIS、Media Service、SQL Express、DNS、DHCP、SMTP）；2) 檔案伺服器功能，沿用 Windows 的軟體 RAID-1 與 Volume Shadow Copy，以保護照片、DV 影片和個人檔案；3) 媒體中心 MCE，包含看電視、錄影、節目表；4) 批次任務如每週備份與影音轉檔；5) 一般桌機用途如上網與遊戲。這些需求需在單一硬體上協同運作，且兼顧穩定與效能。

### 衝突與技術取捨
最大難點在於網路服務與 MCE 幾乎互斥，難以同 OS 穩定共存。為避免衝突又兼顧可用性，作者採虛擬化策略：將第1類網路服務獨立到 Virtual PC 的 guest OS，其餘第2至第5類則留在 Host OS。此分層讓娛樂與桌機需求不受伺服器組件牽制，同時維持網路服務的連續性。作者也因先前受 MCE 上網啟動問題困擾，這次改以購買 Vista Ultimate 正版，降低折騰與相容性風險。

### 實作經驗與效能觀察
搬遷網路服務到 VPC 花了不少時間，但結果理想。原本在 E6300 + 3GB RAM 上運作的服務，被移入 VPC 後初期只分配 256MB 記憶體，且 VPC 不支援 SMP 僅能使用半顆核心，仍未被使用者感知到變慢，顯示過去資源配置過度。之後將 VPC 調整為 512MB 以求穩定。此實證顯示：對於輕量網路服務，虛擬化環境在資源受限下仍足以負荷，也驗證分工架構的可行性。

### 後續計畫與風險控管
作者已取得含 32/64 位元的 Vista 安裝媒體，但認知到正式換裝為另一項大工程，故採取先在 VPC 中安裝試玩、確認驅動與相容性後再行切換的策略。主機端將承載 MCE、檔案伺服器、批次任務與桌機需求；虛擬機則專職網路服務。透過分階段導入與虛擬化隔離，達到穩定度、可維護性與使用體驗的平衡。

## 資訊整理

### 知識架構圖
1. 前置知識：
   - 基本 Windows 作業系統與版本差異（Vista、Windows Server、x86/x64）
   - 虛擬化基礎（Host/Guest、資源分配、SMP 支援）
   - 家用/小型伺服器常見服務（RRAS、IIS、DNS、DHCP、SMTP、Media Service、SQL Express）
   - 檔案保護與備援（RAID-1、Volume Shadow Copy）
   - HTPC/MCE 概念（看電視、錄影、節目表）

2. 核心概念：
   - 服務分離：將互斥或衝突的服務（網路服務 vs MCE）分置於 Host 與 Guest
   - Host/Guest 角色定位：Host 承擔桌機/多媒體與檔案服務，Guest 承擔網路基礎服務
   - 資源配置：在有限硬體（E6300 + 3GB RAM）下對 VM 記憶體與 CPU 的分配與取捨
   - 相容性與功能取捨：MCE 與網路角色（RRAS 等）難以在同 OS 滿足，改以虛擬化解
   - 風險控管與遷移策略：先於 VPC 測試（32/64 位元）、再正式換裝減少停機與回溯成本

3. 技術依賴：
   - MCE 功能依賴 Vista（Ultimate 版含 MCE）、對驅動與多媒體編碼有需求
   - RRAS/DNS/DHCP/SMTP 等網路服務偏向伺服器版本，置於 Guest（Windows Server）更合適
   - VPC 限制：不支援 SMP，Guest 只能用單核心；需合理分配記憶體（256MB→512MB）
   - 檔案安全依賴 Windows 內建 RAID-1 與 Volume Shadow Copy
   - 自動化任務（備份、轉檔）仰賴排程與編碼工具，需考量 Host 的 I/O 與 CPU 資源

4. 應用場景：
   - 家用一機多用：HTPC + 檔案伺服器 + 基礎網路服務
   - 小型辦公室/家庭實驗室：以一台桌機承載多角色服務
   - 舊機升級與資源再利用：以虛擬化降低硬體成本與整合度
   - 服務遷移與測試：先在 VM 中演練、測試 32/64 位元相容性後再上線

### 學習路徑建議
1. 入門者路徑：
   - 了解 Host/Guest 概念與虛擬機基本操作（安裝、快照、資源分配）
   - 認識 MCE/HTPC 基本需求與驅動安裝
   - 建立簡易檔案分享與啟用 Volume Shadow Copy
   - 在 VM 內安裝一兩項基礎服務（如 DNS 或 IIS）做功能驗證

2. 進階者路徑：
   - 規劃完整服務分層：Host（多媒體/檔案/批次任務） vs Guest（RRAS、DNS、DHCP、SMTP、IIS、SQL Express）
   - 針對 VM 調校：記憶體/CPU/磁碟 I/O 配置、開機順序、服務依賴
   - 評估 32/64 位元的驅動、編解碼器與服務相容性
   - 建立備援與回復機制：RAID-1、VSS、設定與資料的備份/還原流程

3. 實戰路徑：
   - 在 Host 安裝 Vista Ultimate，完成顯示卡、電視卡與音訊驅動，設定 MCE
   - 建立 VM（VPC 或其他虛擬化），安裝伺服器 OS，配置 RRAS、DNS、DHCP、IIS、SMTP、SQL Express
   - 移轉既有服務與資料到 VM，進行壓力與可用性測試（先 256MB，再調整到 512MB）
   - 設定批次任務：每週備份與影片轉檔，觀察效能與對 MCE 錄影的影響
   - 以快照/映像檔建立回復點，逐步切換正式運作

### 關鍵要點清單
- 服務分離策略: 將互斥服務分散於 Host/Guest 以避免衝突並提升穩定性 (優先級: 高)
- Host/Guest 角色規劃: Host 承載 MCE/檔案/批次，Guest 承載網路基礎服務 (優先級: 高)
- 虛擬化限制（SMP）: VPC 不支援 SMP，Guest 只能用單核心，影響效能規劃 (優先級: 高)
- 記憶體配置實務: VM 由 256MB 調至 512MB 提升服務穩定性與回應 (優先級: 中)
- 檔案保護機制: 善用 RAID-1 與 Volume Shadow Copy 保護照片/影片/文件 (優先級: 高)
- MCE/HTPC 需求: 媒體中心功能需正確驅動與合適的 Vista 版本（Ultimate） (優先級: 中)
- 服務相容性: RRAS/DNS/DHCP/SMTP 等較適合放在伺服器版 OS（於 VM 內） (優先級: 高)
- 遷移風險控管: 先在 VM 測試與演練（含 32/64 位元）再正式換裝 (優先級: 高)
- 硬體資源現況: E6300 + 3GB RAM 足以同時承載 Host 多媒體與 Guest 基礎服務 (優先級: 中)
- 效能觀察與回饋: 實測顯示移到 VM 後無明顯變慢，驗證規劃可行 (優先級: 中)
- 批次任務安排: 每週備份與影片轉檔安排於 Host，注意與 MCE 錄影時段錯開 (優先級: 中)
- 授權與版本選擇: 選購合適版本（Vista Ultimate）以減少安裝/相容性時間成本 (優先級: 低)
- 快照與備援: 使用 VM 快照與系統映像以快速回復與回滾 (優先級: 中)
- 網路服務可用性: 將關鍵服務集中在 VM 便於備份、移轉與獨立重啟 (優先級: 中)
- 漸進式部署: 先把關鍵服務移轉 VM，再完成 Host 正式換裝，降低停機 (優先級: 高)