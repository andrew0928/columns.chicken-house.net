# 微服務架構設計 ─ 資料庫的選擇：RDBMS or NoSQL?

## 摘要提示
- 技術選型觀念: 與其二選一，應先釐清商業問題並從架構層面思考整合方案。  
- 水平擴展: 微服務要求水平擴展，傳統 RDBMS 天生較難，大量導入 NoSQL 可補其不足。  
- 技術特色: RDBMS 抽象化資料結構與交易，NoSQL 抽象化資料模型與物件狀態。  
- 交易一致性: 微服務拆分資料後必須面對分散式交易與一致性機制（Saga、2PC）。  
- 舊資料封存: 歷史資料、歸檔策略與冷熱分層常需結合兩種資料庫。  
- 版本與快照: 變更追蹤、Copy-on-Write、Event Sourcing 等都是常見治理手法。  
- Cache 平衡: NoSQL 的 K/V 存取效率與不可變資料設計有助提升快取命中率。  
- 能力門檻: 切割 DB 需先具備資料結構、API 設計與分散式系統基礎。  
- OOP 對映: NoSQL 與 OOP 物件天生契合，配合 CQRS、Domain API 可降低 ORM 耦合。  
- 架構師角色: 真正難的是策略與取捨，關鍵在於整合多種技術並保持治理能力。

## 全文重點
作者以多年從企業系統到雲端服務的實戰經驗，說明在微服務架構下選用 RDBMS 或 NoSQL 並非單純技術優劣比較，而是商業驅動與架構整體取捨的結果。RDBMS 擅長表格化資料、複雜查詢與 ACID 交易，但難以水平擴展；NoSQL 以文件或鍵值模型處理大量物件狀態，易於分片與高併發，卻在正規化、查詢彈性及交易支援上較弱。微服務拆分資料庫後，舊有 JOIN 會消失，資料一致性得靠 Saga、CQRS、事件溯源等模式補足。對應典型難題—交易一致性、歷史歸檔、多版本快照與快取策略—往往需要 RDBMS 與 NoSQL 共同協作，例如熱資料放 NoSQL、歸檔進 RDBMS 或冷存；或利用不可變鍵值讓快取命中率最大化。作者提醒，技術決策要落實在服務邊界、API 設計與團隊能力上，否則只會暴露每種技術的缺點。最終，架構師需以商業需求為核心，運用多元技術組合達到成本、效能與可維運的平衡。

## 段落重點
### 前言：我用什麼樣的經歷來談這議題?
作者回顧自身從電機、資工到 CTO、架構師的跨域歷程，強調完整的基礎學科、OOP 與 DBMS 研究、XML/NoSQL 實作及大型電商雲服務經驗，讓他能以商業、開發、基礎建設三方觀點評估技術選型；同時提醒讀者解題關鍵在於持續累積多面向能力，而非僅依賴單一技術。

### RDBMS / NoSQL 的技術特色
RDBMS 將表格式資料的索引與查詢抽象化，正規化設計與 SQL JOIN 讓資料一致性易於維護，交易控制具備天然優勢；NoSQL 則把資料模式抽象化，支援 JSON/XML 文件或 K/V 儲存，O(1) 的鍵值存取與分片特性適合高併發與大規模水平擴展。兩者並非對立，而是各有優勢與限制，應依資料性質與需求場景取捨或混搭。

### 難題 1: 資料一致性與交易處理
微服務拆庫後同一商務流程常跨多服務與存儲，傳統單庫 ACID 無法覆蓋，需要 2PC、Saga、事件驅動等分散式交易模式來確保最終一致性；選型時須衡量效能、複雜度與失敗補償成本。

### 難題 2: 舊資料封存
當資料量暴增，舊資料需冷熱分層或歸檔。常見做法是以高效 NoSQL 儲存熱資料，將歷史資料搬到 RDBMS 或低成本儲存，再配合批次 ETL、分區表或分庫策略，兼顧查詢效能與儲存成本。

### 難題 3: 異動紀錄與快照管理
多版本需求可透過 Copy-on-Write、引用計數或類 Git 結構保存快照；Event Sourcing 與 CQRS 亦能重建狀態並支援審計追蹤。資料庫選型須配合不可變事件流或版本表設計，避免寫入衝突。

### 難題 4: Cache 的命中率與資料正確性平衡
NoSQL 的不可變鍵值特性讓 cache 失效問題大幅降低；若鍵可變則需搭配版本號或 TTL 控制。設計時應區分讀寫路徑，透過事件通知或雙寫機制保持快取與來源資料一致。

### NoSQL 適用的場景
高併發寫入、物件/文件導向資料、需要水平擴展或低延遲查詢、Schema 變動頻繁、不可變事件流等情境皆適合 NoSQL；但若需求以複雜 JOIN、嚴格 ACID 為主則仍建議 RDBMS。

### 為何雲端／微服務化環境偏好 NoSQL
微服務天生切割資料庫、透過 API 而非 JOIN 取得資料；分散式交易及動態擴容需求讓 NoSQL 的分片特性更符合雲端特質。當服務獨占資料時，RDBMS 與 NoSQL 的差異縮小，也促使架構師更易接受 NoSQL。

### 使用 NoSQL 你必須具備的能力
團隊需熟悉資料結構選型、API 精準設計、CQRS/事件驅動整合、分散式交易補償、反正規化與複寫同步，以及監控與備援機制，才能避免只看到 NoSQL 的缺點。

### 物件導向的應用：抽象化介面
OOP 將介面與狀態分離；微服務可透過 API 暴露介面、以專屬資料庫保存狀態。良好的 Domain API 搭配 NoSQL，可減少 ORM 阻抗不匹配，並透過事件流與快取層確保效能與一致性。