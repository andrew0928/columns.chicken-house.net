---
source_file: "docs/_posts/2020/2020-07-01-microservice14-database.md"
generated_date: "2025-01-08 15:30:00 +0800"
version: "1.1"
tools:
  - github_copilot
  - claude_sonnet_3_5
model: "claude-3-5-sonnet-20241022"
---

# 微服務架構設計 - 資料庫的選擇, RDBMS or NOSQL? - 生成內容

## Metadata

### 原始 Metadata

```yaml
layout: post
title: "微服務架構設計 - 資料庫的選擇, RDBMS or NOSQL?"
categories:
- "系列文章: .NET + Windows Container, 微服務架構設計"
- "系列文章: 架構師觀點"
tags: ["microservice", "系列文章", "架構師"]
published: false
comments: true
redirect_from:
logo: 
```

### 自動識別關鍵字

keywords:
  primary:
    - 微服務架構
    - 資料庫選擇
    - RDBMS vs NoSQL
    - 分散式交易
    - 資料治理
  secondary:
    - 水平擴展
    - 資料結構設計
    - 交易處理
    - 資料一致性
    - 架構決策

### 技術堆疊分析

tech_stack:
  languages:
    - SQL
    - JSON
    - XML
  frameworks:
    - RDBMS
    - NoSQL
    - ORM
    - CQRS
    - Event Driven
  tools:
    - 索引系統
    - 交易控制
    - 查詢引擎
    - 資料庫管理系統
  platforms:
    - Cloud Native
    - Container Orchestration
    - 微服務平台
    - 分散式系統

### 參考資源

references:
  internal_links:
    - /series/microservice-architecture/
    - /series/architect-perspective/
    - https://columns.chicken-house.net/2016/10/03/microservice2/
    - https://columns.chicken-house.net/2017/04/15/microservice8-case-study/
    - https://columns.chicken-house.net/2017/07/11/microservice8-case-study-p3/
  external_links:
    - https://www.facebook.com/watch/?v=545139382528011
  mentioned_tools:
    - GraphQL
    - BigQuery
    - 2PC
    - Saga
    - Tamino XML Database

### 內容特性

content_metrics:
  word_count: 8000
  reading_time: "45 分鐘"
  difficulty_level: "進階"
  content_type: "架構分析"

## 摘要 (Summaries)

### 文章摘要 (Article Summary)

作者從微服務架構轉型的實務觀察出發，深入探討在微服務環境下資料庫技術選擇的核心議題。作者指出現代微服務轉型的挑戰已經從開發工具門檻轉移到資料處理和治理能力上，特別是當業務規模增長導致既有架構無法負荷時。文章釐清了RDBMS與NoSQL的本質差異，認為RDBMS是將表格式資料抽象化到極致的產品，而NoSQL則是為處理大量物件資料狀態而生的儲存服務。作者強調技術選擇不應該是簡單的二選一問題，而是需要透過架構規劃來整合不同技術的優勢。文章涵蓋了從作者的學術背景到實務經驗的完整技術歷程，包括電機背景、資工研究所的OODBMS研究、XML資料庫實務經驗，以及從企業系統到雲端服務的領域轉移。作者提出的核心觀點是面對複雜需求時應該考慮技術整合而非單純選擇，並且強調架構師需要具備跨領域的技術理解能力來做出正確的技術決策。

### 關鍵要點 (Key Points)

- 微服務轉型的挑戰已從開發工具轉移到資料處理與治理能力
- RDBMS擅長表格式資料的抽象化處理，NoSQL專精於物件狀態的儲存服務
- 技術選擇應基於問題本質而非技術比較，需要透過架構規劃來決策
- 大規模系統需要整合多種技術發揮互補優勢，而非單純的技術選擇
- 分散式交易處理是從RDBMS轉向微服務架構時的關鍵挑戰

### 段落摘要 (Section Summaries)

1. **問題背景與技術選擇困境**：作者觀察到微服務架構轉型的團隊在開發工具門檻降低後，開始面臨資料處理門檻的挑戰。作者指出大多數微服務轉型都是由商業驅動而非技術驅動，當既有架構無法負荷成長的流量時，資料治理能力成為關鍵瓶頸。作者強調單純的RDBMS vs NoSQL技術比較是錯誤的思維方式，真正的問題在於缺乏架構規劃層面的思考。文章明確表達不會進行技術優劣比較，而是要探討微服務架構下資料庫選擇的考量因素，幫助讀者理解如何根據問題本質來做出技術決策。

2. **作者技術背景與經驗積累**：作者詳細分享從電機系到資工所的學習歷程，包括在研究所期間對OODBMS和分散式系統的深入研究，這些基礎知識為現在的雲端服務和微服務架構奠定了理論基礎。作者特別提到重新造輪的經驗，包括XML資料庫和XML ORM的設計開發，這些經驗讓作者深刻理解RDBMS和NoSQL的本質差異。從企業系統轉向電子商務和雲端服務的領域轉移，以及從CTO管理職轉向架構師技術職的角色變化，都為作者提供了多角度的技術視野和實務經驗，形成了跨領域的技術判斷能力。

3. **RDBMS技術特色與架構本質**：作者將RDBMS定義為將表格式資料抽象化到極致的產品，類比為具有強大索引和查詢能力的巨大Excel系統。作者詳細說明SQL查詢語言的設計目的是封裝搜尋和排序演算法，讓開發者專注於查詢邏輯而非底層實作細節。正規化設計成為RDBMS的核心概念，透過關聯性維持資料一致性，並依賴JOIN操作重組資料。作者指出RDBMS的抽象化設計帶來彈性但也造成限制，當資料規模達到一定程度時，必須在應用層面進行優化，這時RDBMS的抽象層反而成為障礙，導致交易處理等問題開始浮現。

4. **NoSQL的演進歷程與核心概念**：作者從歷史角度追溯NoSQL的發展，從OOP興起時期RDBMS無法有效處理物件資料的困境開始說起。作者詳細說明XML標準化如何推動OODBMS商業化，並分享使用Tamino XML資料庫的實務經驗。作者強調NoSQL本質上是為處理大量物件資料狀態而設計的儲存服務，更像是具有查詢能力的storage而非傳統資料庫。NoSQL透過降低schema約束力來提高application彈性，以物件導向概念處理資料，並透過key-value結構實現O(1)層級的效能表現，這是RDBMS難以達到的優勢。

5. **技術整合策略與架構能力要求**：作者提出核心觀點，認為RDBMS和NoSQL屬於完全不同的技術世界，不應該進行簡單的優劣比較。作者提供明確的技術選擇原則：首先要認清問題本質，從最困難的問題來決定儲存技術；其次是在大規模複雜需求下，需要整合多種技術發揮互補優勢而非單純選擇。作者強調這需要架構師具備足夠的技術能力，能夠組合不同性質的技術展現優點而非缺點。文章最後提出技術能力升級的重要性，當面臨看似無解的問題時，解決方案往往是提升自身能力或在問題變成問題之前就預防解決。

## 問答集 (Q&A Pairs)

### Q1: 為什麼微服務轉型後資料處理變成主要挑戰？
Q: 微服務架構轉型過程中，為什麼資料處理門檻變得比開發工具門檻更重要？
A: 隨著雲端平台和容器編排環境的成熟，開發工具門檻已經大幅降低，但微服務架構帶來的資料分散和治理問題卻更加複雜。當系統從單體架構轉向微服務時，原本由單一資料庫處理的資料開始分散到多個服務，需要面對分散式交易、資料同步、跨服務查詢等全新挑戰。

### Q2: RDBMS和NoSQL的本質差異是什麼？
Q: 如何理解RDBMS和NoSQL在設計理念上的根本不同？
A: RDBMS是將表格式資料抽象化到極致的產品，專注於透過SQL語言和正規化設計來處理結構化資料。NoSQL則是為處理大量物件資料狀態而設計的儲存服務，更像是具有查詢能力的storage，透過降低schema約束來提供更大的應用彈性，並以key-value結構實現O(1)層級的效能表現。

### Q3: 如何避免落入技術選擇的二選一陷阱？
Q: 在面對RDBMS vs NoSQL選擇時，應該採用什麼樣的思考方式？
A: 不應該將其視為二選一的問題，而是要先釐清要解決的問題本質。從最困難的問題來決定主要的儲存技術，其他次要問題用別的技巧彌補。如果規模夠大且需求互相衝突，應該考慮整合多種技術發揮互補優勢，這需要架構師具備足夠的技術能力來正確組合不同技術。

### Q4: 微服務架構下如何處理分散式交易問題？
Q: 當資料分散到多個微服務時，如何確保交易的一致性？
A: 可以採用多種策略：2PC (Two-Phase Commit) 適合強一致性需求但效能較差；Saga模式透過補償機制處理長時間運行的分散式交易；CQRS結合Event Driven架構可以實現最終一致性；或者重新設計業務流程，將複雜交易拆解為多個獨立的業務操作來降低分散式交易的複雜度。

### Q5: 什麼情況下應該選擇NoSQL而非RDBMS？
Q: 在微服務架構中，NoSQL特別適合哪些應用場景？
A: NoSQL特別適合需要水平擴展、處理大量非結構化資料、需要高效能key-value存取、或者資料模型經常變化的場景。當微服務已經切割獨立資料庫、無法使用JOIN操作、必須透過API存取資料時，NoSQL的優勢就會明顯展現，因為此時RDBMS的主要優勢（如複雜查詢、JOIN操作）已經無法發揮。

### Q6: 如何設計API來替代SQL查詢功能？
Q: 從SQL降級為API時，需要具備什麼樣的設計能力？
A: 需要深度理解資料結構，能夠設計精準的API操作而不依賴schema和查詢語言。API設計應該以state machine為主而非CRUD，針對單一物件的狀態改變來設計。複雜的查詢需求應該另外開發專門的查詢服務，報表類需求則從資料分析角度處理，例如使用BigQuery等專門的分析工具。

### Q7: 如何處理資料庫切割後的資料同步問題？
Q: 微服務架構中多個資料庫之間如何保持資料同步？
A: 可以採用CQRS (Command Query Responsibility Segregation) 模式分離讀寫操作，結合Event Driven架構和PUB/SUB機制實現資料同步。當資料同時存在多個地方時，可以使用CQRS搭配Replay機制來確保資料一致性。關鍵是要接受最終一致性的概念，而非追求強一致性。

### Q8: 微服務轉移策略應該如何規劃？
Q: 從單體架構轉向微服務時，資料庫遷移應該採用什麼策略？
A: 應該採用漸進式遷移策略：先架設新的微服務架構，然後逐步轉移功能和資料。不要嘗試一次性的大規模遷移，而是透過Strangler Fig模式慢慢替換舊系統。在遷移過程中可能需要維持新舊系統並存，透過資料同步機制確保一致性，最終完全切換到新架構。

## 解決方案 (Solutions)

### P1: 微服務資料庫選擇困境
Problem: 團隊在微服務轉型過程中面臨RDBMS vs NoSQL的技術選擇困境，不知道如何根據實際需求做出正確決策。
Root Cause: 缺乏對不同資料庫技術本質差異的理解，將技術選擇視為簡單的二選一問題，沒有從架構規劃角度分析需求特性。
Solution: 建立問題導向的技術選擇方法論。首先深入分析業務場景，識別最核心的技術挑戰，從最困難的問題來決定主要技術方向。了解RDBMS擅長表格式資料抽象化，NoSQL適合物件狀態儲存，根據資料特性和存取模式選擇合適技術。對於複雜需求考慮技術整合而非單純選擇。
Example: 
```
決策流程:
1. 分析資料特性 → 結構化 vs 物件化
2. 評估存取模式 → 複雜查詢 vs Key-Value存取  
3. 考慮擴展需求 → 垂直擴展 vs 水平擴展
4. 整合技術優勢 → RDBMS + NoSQL + Cache
```

### P2: 分散式交易處理複雜度
Problem: 微服務架構下單一業務邏輯跨越多個資料庫，傳統的ACID交易無法直接應用，造成資料一致性難以保證。
Root Cause: 將單體架構的交易模型直接套用到分散式環境，沒有理解分散式系統中一致性的本質差異和可用的解決方案。
Solution: 根據業務需求選擇適當的分散式交易模式。強一致性需求使用2PC但需承擔效能成本；業務流程使用Saga模式透過補償機制處理；讀寫分離場景採用CQRS模式；事件驱動架構搭配最終一致性概念重新設計業務流程。
Example: 
```
Saga模式範例:
訂單處理 → 庫存扣減 → 付款處理 → 物流安排
每步驟設計補償操作:
取消訂單 ← 恢復庫存 ← 退款處理 ← 取消配送
```

### P3: SQL到API的查詢能力轉換
Problem: 從RDBMS轉向微服務時，失去了SQL的靈活查詢能力，需要透過API設計來提供相同的資料存取功能。
Root Cause: 過度依賴SQL的查詢彈性，沒有深入理解資料結構和存取模式，缺乏精準的API設計能力。
Solution: 建立以資料結構為基礎的API設計方法論。深入分析業務的資料存取模式，設計針對性的API而非通用CRUD。採用State Machine概念設計狀態轉換API，複雜查詢需求獨立設計查詢服務，報表需求使用專門的分析工具處理。
Example: 
```
狀態機API設計:
訂單狀態: 已建立 → 已付款 → 已出貨 → 已完成
API: createOrder() → payOrder() → shipOrder() → completeOrder()
而非: updateOrder(status)
```

### P4: 多資料庫資料同步挑戰
Problem: 微服務架構中資料分散存儲在多個資料庫，需要確保相關資料在不同服務間保持同步和一致性。
Root Cause: 沒有建立適當的資料同步機制，仍然期望達到單體架構下的強一致性，缺乏對最終一致性的理解和接受。
Solution: 建立基於事件驅動的資料同步架構。使用CQRS模式分離讀寫操作，透過Domain Events和Message Queue實現服務間通訊。設計補償機制處理同步失敗情況，建立資料對帳和修復機制，接受最終一致性的業務模式。
Example: 
```
事件驅動同步:
用戶服務 → UserUpdated事件 → 訂單服務更新用戶資料
       → MessageQueue → 推薦服務更新偏好資料
       → Event Store → 審計服務記錄變更
```

### P5: 舊系統向微服務遷移風險
Problem: 大型單體系統向微服務架構遷移時，資料庫切割和系統重構風險巨大，容易造成業務中斷和資料不一致。
Root Cause: 採用大爆炸式遷移策略，沒有規劃漸進式轉移路徑，缺乏新舊系統並存期間的資料管理機制。
Solution: 採用Strangler Fig模式進行漸進式遷移。先建立新的微服務架構，逐步將功能從舊系統遷移到新系統。在過渡期間維持資料同步機制，確保新舊系統資料一致性。建立完整的測試和回滾機制，每個遷移步驟都要可逆和可驗證。
Example: 
```
遷移策略:
階段1: 新建用戶微服務，與舊系統雙寫
階段2: 逐步將讀取流量導向新服務
階段3: 驗證資料一致性後停止雙寫
階段4: 重複此模式遷移其他服務
```

## 版本異動紀錄

### v1.1 (2025-01-08)
- 按照最新的embedding-structure.instructions.md規範重新生成
- 更新front matter格式，加入source_file、generated_date等欄位
- 調整摘要格式，改用第三人稱敘述
- 重新設計Q&A和解決方案，聚焦於微服務資料庫選擇主題

### v1.0 (2020-07-01)
- 初始版本
