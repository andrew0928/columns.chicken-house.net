# Tips: 踢掉遠端桌面連線的使用者

## 摘要提示
- 問題場景: 伺服器遠端桌面連線人數已滿，管理者無法登入處理
- Console 連線: 透過 /console 參數連到本機主控台 Session，避開兩個 RDP 名額限制
- 使用者管理: 進入工作管理員的使用者頁籤可查看與中斷特定 Session
- 90% 解法: 多數情況用 console 連線與工作管理員即可解決
- TSDISCON 工具: 使用 TSDISCON.exe 可遠端中斷指定終端機 Session
- 指令條件: 需要目標伺服器管理者權限與未封鎖 NETBIOS
- 基本步驟: 先用 NET USE 驗證登入，再用 TSDISCON 指令踢除
- Session ID 概念: 0 為 console，1、2 為預設 RDP 連線名額
- 授權限制: 未購買額外授權時，Windows 內建僅允許兩個同時 RDP 管理連線
- 搶得先機: 踢除成功後需立即登入以占據名額

## 全文重點
本文針對當遠端桌面連線數已滿，管理者無法登入伺服器時的處置技巧進行整理。首先，作者回顧自 Windows 2000 起便可使用 RDP，且早年常用的一個實用手法是透過 /console 參數連線至主控台 Session。此連線不佔用一般的兩個 RDP 名額，因此能在常見的「名額已滿」情境下仍然登入。登入後，打開工作管理員，切到使用者頁籤，即可看到目前有哪些使用者連線與其 Session ID，管理者可以選擇需要中斷的連線來釋放名額。這個方法能解決約九成的問題。

若連 console 連線也無法使用，或整體仍被占用，則可使用 TSDISCON.exe 這個系統工具來中斷指定的終端機 Session。TSDISCON 全名為「Disconnects a terminal session」，能直接斷開指定 Session 的連線。使用前提是你擁有目標伺服器的系統管理權限，且目標環境未封鎖 NETBIOS。操作步驟為先用 NET USE 指令登入遠端伺服器帳號進行驗證，接著以 TSDISCON [SessionID] /SERVER:[ServerName] 來中斷特定 Session。Session ID 的判讀可透過工作管理員或系統工具取得—一般而言，ID 0 是 console，其他為 RDP 連線；若僅使用預設授權，通常 1 與 2 即為兩個可用的 RDP 名額，必要時選其一中斷。

在授權方面，若未購買額外的遠端桌面服務授權，Windows 伺服器預設僅允許兩個同時的管理員遠端連線。因而當連線滿載時，管理者需透過上述技巧騰出名額。完成 TSDISCON 中斷後，建議管理者立即嘗試登入，以避免被其他使用者搶先佔位。整體而言，本文提供了兩層解法：優先使用 /console 連線與工作管理員管理使用者；若不可行，則以 TSDISCON 精準中斷指定 Session，迅速恢復管理介入能力。

## 段落重點
### 背景與問題描述
作者遇到同事無法登入伺服器的情況，原因是遠端桌面連線人數已滿，且現場無法直接操作主機。此為常見的運維窘境：人人會連但不知如何「砍人」。文章旨在分享從 Windows 2000 時代沿用至今的簡單有效解法，協助管理者在名額被占滿時仍能進入系統並釋放連線。

### 使用 /console 連到主控台 Session
第一層解法是使用遠端桌面連線參數 /console（歷史上可用於連至主控台 Session），能避開一般 RDP 的兩個連線名額限制。成功登入後，管理者可不與其他使用者爭奪連線資源，直接進入系統執行管理操作。此法對大多數「連線已滿」的情境相當有效。

### 以工作管理員檢視與中斷使用者
登入後，打開工作管理員，切換到「使用者」頁籤，即可查看所有連線中的使用者與 Session 資訊。選擇不需要的使用者即可中斷其 Session，釋放名額。此流程直觀、風險低，通常能解決約 90% 的連線占用問題。

### 進階手段：TSDISCON 指令
若連 console 連線也被占用或不可行，可使用 TSDISCON.exe 指令強制中斷指定的終端機 Session。該工具的用途即為斷線終端機連線，適合在圖形介面無法登入時使用。需要具備伺服器管理權限，且遠端環境未封鎖 NETBIOS 通訊，方能順利執行。

### 操作步驟與範例
執行流程為兩步：1) 使用 NET USE \\MYSERVER /user:MYACCOUNT * 先行驗證登入遠端伺服器；2) 以 TSDISCON 1 /SERVER:MYSERVER 中斷指定 Session。Session ID 可從工作管理員的 ID 欄位判讀，ID 0 為 console，其他為 RDP 連線。若未購入額外授權，通常只會看到 1 與 2 兩個 RDP 名額，實務上挑選其一中斷即可。

### 授權限制與實務建議
在未購買遠端桌面服務授權情況下，Windows 伺服器僅提供兩個同時管理員連線名額。因此，名額被占滿是常態風險。建議優先嘗試 /console 連線與工作管理員中斷使用者；若失敗，再以 TSDISCON 斷線。成功中斷後，應迅速登入以占據釋出的名額，避免被他人搶先重連，確保管理操作得以順利展開。

## 資訊整理

### 知識架構圖
1. 前置知識： 
   - 知道 Windows 遠端桌面（RDP）與終端機工作階段的基本概念
   - 具備遠端伺服器的系統管理者帳密
   - 能使用工作管理員查看使用者與工作階段資訊
   - 目標伺服器允許遠端連線並具備必要的網路通訊（如未關閉 NETBIOS）
2. 核心概念：
   - RDP 連線與工作階段：Windows 允許同時多個 RDP 工作階段，Console 為本機主控台（ID=0）
   - Console 連線參數：使用 /console 參數可連到主控台工作階段，避開一般兩個 RDP 名額
   - 工作階段 ID 管理：透過工作管理員「使用者」頁籤辨識 Session ID（常見為 1、2）
   - TSDISCON 工具：以命令列中斷指定伺服器上的特定工作階段
   - 授權限制：未購買額外 CAL 時，預設僅有兩個 RDP 管理連線
3. 技術依賴：
   - RDP/終端機服務（提供多工作階段）
   - 工作管理員（檢視與辨識 Session ID）
   - TSDISCON.exe（中斷工作階段的命令列工具）
   - NET USE（預先驗證遠端伺服器的憑證）
   - 網路層條件（如 NETBIOS 未被防火牆阻擋）
4. 應用場景：
   - 伺服器 RDP 名額已滿，管理者無法登入進行維護
   - 需要強制中斷特定使用者的遠端工作階段
   - 緊急搶回管理連線名額以處理故障或部署

### 學習路徑建議
1. 入門者路徑：
   - 認識 RDP 與 Console 工作階段差異
   - 練習透過工作管理員檢視使用者與 Session ID
   - 嘗試使用 /console 參數登入並觀察差異
2. 進階者路徑：
   - 熟悉 TSDISCON 的語法與參數，能在本機或遠端指定伺服器與 Session ID
   - 使用 NET USE 完成遠端憑證驗證與連線前置
   - 理解授權限制與常見錯誤（名額已滿、權限不足、連線被防火牆阻擋）
3. 實戰路徑：
   - 在測試環境重現名額已滿情境，依序嘗試 /console → TSDISCON 的解法
   - 建立快速操作步驟與常用指令清單（NET USE、TSDISCON）
   - 制定斷線通知與營運流程（避免誤斷關鍵工作階段）

### 關鍵要點清單
- RDP 名額限制：未加購授權通常只有兩個遠端管理連線名額 (優先級: 高)
- Console 工作階段：Console 為本機主控台，通常 Session ID=0，可避開一般 RDP 名額 (優先級: 高)
- /console 參數：連線時加上 /console 可直接進入 Console Session（不與一般名額競爭）(優先級: 高)
- 工作管理員使用者頁籤：可查看目前連線使用者與工作階段 ID (優先級: 高)
- Session ID 辨識：常見遠端工作階段為 1、2，可據此決定要中斷對象 (優先級: 高)
- TSDISCON.exe 功能：命令列中斷指定工作階段（Disconnects a terminal session）(優先級: 高)
- TSDISCON 基本用法：TSDISCON <SessionID> /SERVER:<ServerName> (優先級: 高)
- NET USE 預先驗證：NET USE \\伺服器 /user:帳號 * 先完成身份驗證再執行遠端指令 (優先級: 中)
- 權限需求：需具備目標伺服器系統管理者權限才能中斷他人工作階段 (優先級: 高)
- 防火牆與網路前提：需確保未封鎖必要通訊（例如 NETBIOS）以便遠端執行 (優先級: 中)
- 操作順序建議：先嘗試 /console 登入→工作管理員辨識→必要時用 TSDISCON (優先級: 高)
- 風險控管：中斷工作階段可能造成未儲存作業遺失，需審慎選擇對象 (優先級: 中)
- 快速回補連線：中斷後應立即登入以占用釋出的名額 (優先級: 中)
- 授權與擴充：若常遇名額不足，評估購買額外授權或改用正式的遠端桌面服務 (優先級: 中)
- 問題排查：若 TSDISCON 失敗，檢查權限、主機名/網路可達性、防火牆設定 (優先級: 中)