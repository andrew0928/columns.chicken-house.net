# Tips: 踢掉遠端桌面連線的使用者

## 問題與答案 (FAQ)

### Q&A 類別 A: 概念理解類

Q1: 什麼是遠端桌面連線（RDP）？
- A簡: RDP 是微軟協定，支援遠端圖形化登入、桌面操作與工作階段管理。
- A詳: 遠端桌面連線（Remote Desktop Protocol, RDP）是微軟的遠端顯示與輸入協定，讓使用者透過網路登入 Windows 主機，看到圖形化桌面並操作應用程式。RDP 在伺服器端建立「工作階段」，每位連線者各有獨立環境。常見用途包含伺服器維運、遠端支援與應用發布。本文涉及的「踢人」即是針對 RDP 工作階段進行管理。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q2, A-Q11, B-Q1

Q2: 什麼是終端工作階段（Terminal Session）？
- A簡: 工作階段是伺服器為每位遠端使用者建立的獨立登入環境。
- A詳: 終端工作階段是 Windows 遠端桌面服務為每位連線者建立的獨立使用者空間，包含桌面、程序、記憶體與使用者態資源。每個工作階段有唯一 Session ID，可處於 Active、Disconnected、Idle 等狀態。管理者可依 ID 對特定連線進行斷線、登出或重設，以釋放名額或維護資源秩序。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q6, A-Q22, B-Q7

Q3: 什麼是 Console Session？
- A簡: Console 是伺服器主控台的本機工作階段，通常不占用一般 RDP 名額。
- A詳: Console Session 指主機本機主控台（實體螢幕/鍵盤）對應的工作階段。早期以 /console 參數遠端連入可避免與兩個一般 RDP 管理連線衝突。新版本改用 /admin 取得類似效果。Console 往往承載系統關鍵作業，誤斷開風險較高，需謹慎識別對應的 Session。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q4, A-Q20, B-Q3

Q4: 為什麼需要用 /console 或 /admin 連線？
- A簡: 因兩個管理連線已滿，/console 或 /admin 可避開名額限制登入。
- A詳: 伺服器未部署 RDS 授權時，預設僅允許兩個同時的管理連線。當名額被占滿，管理員仍可能需緊急登入處置，可嘗試透過 /console（舊版）或 /admin（新版）參數連入類主控台的管理通道，通常不與一般兩個 RDP 名額衝突，便於進入系統踢人或排除異常。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q8, A-Q20, C-Q1

Q5: 什麼是 TSDISCON 指令？
- A簡: TSDISCON 是用於中斷（斷線）指定終端工作階段的命令工具。
- A詳: TSDISCON.exe 為內建命令列工具，用途是「Disconnects a terminal session」，即把指定 Session 轉為 Disconnected 狀態，使用者程序仍在伺服器上運行但連線中斷。管理者可搭配 /SERVER 指定目標主機與 Session ID 實施精準「踢人」，以快速釋放遠端管理名額。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q7, B-Q4, C-Q3

Q6: Session ID 是什麼？0 代表什麼？
- A簡: Session ID 是每個工作階段的識別碼；早期 0 常代表 Console。
- A詳: 每個 RDP 工作階段在伺服器上都有唯一 Session ID。於 Windows Server 2003 等舊版，ID 0 常對應 Console；但自 Vista/2008 起引入 Session 0 隔離，Console 不一定是 0，實際 ID 需以工具查詢。正確辨識 ID 是使用 TSDISCON 的關鍵，以免誤斷要害工作階段。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q3, B-Q12, C-Q5

Q7: 斷線（Disconnect）與登出（Logoff）的差異是什麼？
- A簡: 斷線保留程序與狀態；登出結束程序並釋放資源與鎖定。
- A詳: 斷線是切斷用戶端連線，伺服器仍維持該使用者程序與記憶體狀態；登出則結束使用者會話，關閉應用、釋放鎖定與資源。若只需空出名額且避免資料遺失，先用斷線較安全；若防止對方馬上再連回，或需清除資源，則採登出或重設會話較妥。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q13, C-Q2, D-Q7

Q8: 為什麼會出現「連線人數已滿」？
- A簡: 因伺服器僅允許兩個同時管理連線，名額被占滿所致。
- A詳: 未部署 Remote Desktop Services 授權且處於管理模式時，Windows Server 預設只允許兩個同時的 RDP 管理連線。當第三人嘗試登入，會得到名額已滿的提示。此時可改用 /admin 進入、或使用 TSDISCON 斷開既有連線釋出名額，再正常登入進行維運。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q4, A-Q9, D-Q1

Q9: 內建兩個同時連線限制的由來是什麼？
- A簡: 這是遠端管理用途的限制；大量同時用戶需另行部署 RDS 授權。
- A詳: Windows Server 的預設遠端管理模式僅提供兩個同時管理連線，設計目的是提供系統維運與緊急處理，而非多使用者應用交付。若要支援多名終端使用者同時使用應用程式，需安裝 Remote Desktop Services 角色並啟用 RD Licensing 正式授權。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q21, B-Q8, D-Q1

Q10: 使用 TSDISCON 的前置條件有哪些？
- A簡: 需具管理權限，能認證到遠端，且防火牆未阻斷必要通道。
- A詳: 要使用 TSDISCON 斷開遠端工作階段，通常需具系統管理員身分或具備斷線權限；需能以認證存取目標主機（例如先用 NET USE 建立憑證）；且網路與防火牆不可阻擋相關通訊（文中提及 NetBIOS/SMB 被封會影響 NET USE）。符合條件後即可針對特定 Session ID 操作。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q10, C-Q4, D-Q2

Q11: Task Manager 的「使用者」分頁有何作用？
- A簡: 可列出目前掛載的使用者、狀態與會話 ID，便於選擇踢誰。
- A詳: 在伺服器上打開工作管理員（Task Manager），「使用者」分頁會顯示登入者清單、狀態（活動/斷線）、會話 ID 與所佔資源。管理者可在此執行斷線或登出，也能讀取正確的 Session ID，搭配 TSDISCON 精準處理特定連線，避免誤踢。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q6, C-Q2, C-Q5

Q12: 什麼是 NetBIOS？與本文技巧有何關聯？
- A簡: NetBIOS 提供名稱服務與會談；防火牆封鎖會影響 NET USE 認證。
- A詳: NetBIOS 是舊式區域網路名稱與會談服務，Windows 檔案/列印共用常透過 SMB 與 NetBIOS/名稱解析協作。文中示範先用 NET USE 與伺服器建立認證會話，若防火牆封鎖相關通道，NET USE 可能失敗，進而影響後續以 TSDISCON 針對遠端主機操作的流程。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q13, B-Q9, D-Q6

Q13: NET USE 指令的用途是什麼？
- A簡: 用於與遠端主機建立認證/連線，便於後續遠端作業。
- A詳: NET USE 可建立至遠端伺服器的網路連線與認證會話，例如 NET USE \\Server /user:帳號，可在目前命令列環境記住憑證。這常作為後續遠端管理命令的前置步驟，確保有權限對目標主機執行 TSDISCON 等工作階段管理動作。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q4, D-Q4, B-Q10

Q14: 何時應該選擇「踢人」而非等待？
- A簡: 當兩連線占滿且需立即維運處置時，應立即斷線釋名額。
- A詳: 若伺服器管理名額被占滿，且有故障排除或維運需求，等待可能延誤處理。此時應先以 /admin 連入或使用 TSDISCON 斷線佔用者，快速釋放名額。斷線優先於登出，可降低資料遺失風險；除非必要，才考慮登出或重設會話。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q7, D-Q1, D-Q7

Q15: 砍人（斷線/登出）會不會造成資料遺失？
- A簡: 斷線不會關程式但未存資料仍有風險；登出會關閉程式。
- A詳: 斷線只中斷連線，應用仍運作；但若應用未自動儲存，使用者回來前可能有風險。登出則關閉應用與工作階段，未存檔內容會遺失。若主要目的是釋名額，建議先斷線；需避免快速回連或釋放資源，才選登出或重設。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q7, D-Q9, B-Q13

Q16: TSDISCON、LOGOFF 與 RESET SESSION（rwinsta）有何差異？
- A簡: TSDISCON 斷線保留狀態；LOGOFF 結束會話；RESET 強制重設會話。
- A詳: TSDISCON 將會話標記為 Disconnected，程序仍在；LOGOFF 正常結束使用者會話與程式；RESET SESSION（rwinsta）等同強制重設，直接中止會話與程序，較為激烈。選擇時依需求與風險取捨，通常先斷線，再考慮登出或重設。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q15, C-Q3, D-Q7

Q17: 為何「先登入再踢人」能成功？
- A簡: 先建立管理憑證與會話，取得對目標主機的管理操作權限。
- A詳: 遠端執行 TSDISCON 需具備在目標主機的適當權限。先用 NET USE 與管理帳號建立認證關係，讓後續命令列在該主機的安全內容中執行。此流程避免權限不足或匿名被拒，確保能正確針對指定 Session ID 進行斷線操作。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q10, A-Q13, C-Q4

Q18: 連進 Console 後如何查看誰在線？
- A簡: 開啟工作管理員使用者分頁，查看使用者、狀態與 Session ID。
- A詳: 透過 /admin 成功連入伺服器後，按 Ctrl+Shift+Esc 開啟 Task Manager，切換至「使用者」分頁，可見目前登入的帳號、工作階段狀態（Active/Disc）與 ID。據此判斷誰占名額，並決定對象與方式（斷線或登出）進行清理。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q11, C-Q2, C-Q5

Q19: 何謂「秘密連線」與其風險？
- A簡: 指用 /console 或 /admin 連入的管理通道；誤操作恐影響系統。
- A詳: 文章稱的「秘密連線」即利用 /console（舊）或 /admin（新）進入不占一般名額的管理通道。雖可在名額滿時登入，但該會話常更接近主控台層級，可能涉及關鍵服務或操作。誤踢或誤變更設定，風險較高，需嚴謹識別對象與步驟。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q3, A-Q20, D-Q9

Q20: Windows 版本差異：/console 與 /admin 有何不同？
- A簡: /console 為舊參數；自 Vista/2008 起改用 /admin 取得管理會話。
- A詳: 早期 MSTSC 可用 /console 直連主控台會話。自 Windows Vista/Server 2008 起，MSTSC 不再接受 /console，改以 /admin 取得管理員會話，不會啟用遠端桌面授權，也通常不占一般兩席名額。故依版本選對參數，才可在名額滿時成功登入。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q1, D-Q5, B-Q19

Q21: 什麼是 Remote Desktop Services（RDS）授權？
- A簡: RDS 授權允許多使用者同時連線並合法使用遠端桌面服務。
- A詳: 若伺服器需提供多名終端用戶使用應用服務，必須部署 RDS 角色並啟用 RD Licensing，為每位使用者/裝置配置 CAL。這與預設兩席「管理連線」不同。沒有 RDS 授權時，不該用兩席管理連線承載一般用戶日常作業。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q8, A-Q9, B-Q8

Q22: 什麼是工作階段狀態 Active、Disconnected 與 Idle？
- A簡: Active 正在使用；Disconnected 已斷線仍執行；Idle 閒置未操作。
- A詳: Active 表示使用者正連線並操作；Disconnected 是網路連線中斷，但會話與程式仍在伺服器執行；Idle 則多指長時間無操作但仍連線中。理解狀態有助判斷應採斷線、登出或等待，以兼顧風險與效率。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q4, B-Q16, C-Q8

Q23: 為什麼 TSDISCON 常能解決 90% 的名額問題？
- A簡: 快速斷開佔用會話，保留狀態，能立即釋出登入名額。
- A詳: 多數情況下，只要釋出一席即可登入處理問題。TSDISCON 不結束程序，只切斷連線，對對方影響較小，且立即空出名額，管理員便可登入排除故障。故在名額滿的維運實務中，TSDISCON 是高效率、低風險的首選。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q7, C-Q3, D-Q1

Q24: 什麼情況需要改用 GUI 而非命令列？
- A簡: 不熟命令列或需視覺化核對對象時，優先用 Task Manager。
- A詳: 若管理者較不熟命令列或需視覺交叉核對使用者、狀態與工作階段 ID，使用 Task Manager 的「使用者」分頁可降低誤操作風險。當需要批次、自動化或遠端腳本化處理時，再採命令列工具如 TSDISCON、LOGOFF 或 PowerShell。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q11, C-Q2, C-Q7

Q25: 何謂最佳實務的「佔名額」策略？
- A簡: 先斷線釋出一席，立即登入處理；避免長時間佔用與誤登出。
- A詳: 實務上建議：1) 觀察會話狀態，優先斷線閒置或不活躍者；2) 斷線後立即以 /admin 或一般 RDP 登入處理；3) 非必要不登出，降低資料遺失風險；4) 完成後釋出自身連線；5) 檢視並設定閒置自動斷線政策，減少下次名額爭奪。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: D-Q7, C-Q9, B-Q16


### Q&A 類別 B: 技術原理類

Q1: 遠端桌面服務（RDS）的運作架構為何？
- A簡: 伺服器上的接聽端建立工作階段，客戶端透過 RDP 傳輸畫面與輸入。
- A詳: 原理說明：RDP 接聽端接受連線，驗證後為每位用戶建立獨立 Session。關鍵流程：握手、驗證、建立會話與桌面，之後以 RDP 壓縮與位圖傳輸畫面、裝置重導。核心組件：TermService、RDP-Tcp 連線、Session Manager。管理者可對特定 Session 進行斷線或登出操作。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q1, A-Q2, B-Q4

Q2: RDP 連線建立的執行流程是什麼？
- A簡: 連線握手、驗證授權、建立工作階段、載入使用者環境。
- A詳: 原理說明：客戶端與伺服器完成協定握手與安全交涉後，送交憑證驗證。關鍵步驟：通過授權檢查（管理模式或 RDS 授權）、建立 Session、載入使用者設定檔與桌面。核心組件：MSTSC、Credential Provider、Session Manager、Shell。之後才進入正常操作階段。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q8, A-Q21, B-Q1

Q3: Console/Admin 連線如何避免佔用一般名額？
- A簡: 它以管理通道登入，不計入兩席一般 RDP 管理連線配額。
- A詳: 原理說明：/console（舊）或 /admin（新）指示 MSTSC 以管理模式連線，不建立一般終端使用會話資源。關鍵步驟：客戶端帶參數、伺服器辨識為管理連線、跳過一般名額計數。核心組件：MSTSC 參數解析、TermService 管理模式路徑、授權檢核差異。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q3, A-Q4, A-Q20

Q4: TSDISCON 的工作原理與狀態轉換？
- A簡: 透過終端服務 API 將指定會話轉為 Disconnected 狀態。
- A詳: 原理說明：TSDISCON 呼叫終端服務管理 API，變更目標 Session 的狀態。關鍵步驟：解析參數（ID/名稱、/SERVER）、驗權、發出斷線指令、狀態改為 Disc。核心組件：TSDISCON、TermService、伺服器端 Session State。程式不被終止，使用者可再連回恢復。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q5, A-Q7, C-Q3

Q5: 使用 TSDISCON 踢遠端使用者的技術流程？
- A簡: 建立認證、確認目標 ID、對目標伺服器執行 TSDISCON 斷線。
- A詳: 原理說明：先確保對目標主機有管理權限。關鍵步驟：1) NET USE 建立認證；2) 以 Task Manager 或查詢指令取得 Session ID；3) 執行 TSDISCON <ID> /SERVER:<主機>；4) 驗結果，名額釋出。核心組件：NET USE、Task Manager/查詢工具、TSDISCON、TermService。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q10, C-Q4, C-Q5

Q6: Task Manager 如何列舉工作階段與使用者？
- A簡: 透過終端服務 API 讀取會話清單、狀態與資源占用資訊。
- A詳: 原理說明：Task Manager 呼叫系統 API 取得使用者、會話 ID、狀態與資源統計。關鍵步驟：更新清單、支援管理動作（斷線/登出）。核心組件：Task Manager、WTS API/TermService。管理者據此做出精準踢人決策，避免誤操作。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q11, C-Q2, B-Q7

Q7: Session ID 如何被指派與比對？
- A簡: 系統為新會話分配唯一 ID；藉由工具比對 ID 與使用者。
- A詳: 原理說明：每建立一個會話，Session Manager 指派唯一 ID。關鍵步驟：登入時產生或重用 ID、狀態變遷記錄。核心組件：Session Manager、WTS API。比對時以 Task Manager 或查詢指令列表 ID 與使用者名稱，確保 TSDISCON 指向正確會話。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q6, C-Q5, D-Q3

Q8: 兩個管理連線限制如何被技術上強制？
- A簡: 伺服器在授權檢查階段限制一般管理連線的同時數。
- A詳: 原理說明：連線建立時，TermService 進行授權/模式檢查。關鍵步驟：辨識是否為管理連線、計算目前一般管理連線數、達上限則拒絕新連線。核心組件：TermService、授權檢核邏輯、連線配額計數。/admin 走不同檢核路徑而不受此限。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q8, A-Q20, B-Q3

Q9: 防火牆與通訊對此技巧的影響為何？
- A簡: 防火牆若封鎖 NetBIOS/SMB 或相關遠端管理通道將導致失敗。
- A詳: 原理說明：遠端斷線常仰賴先建立認證（如 NET USE），需要 SMB/名稱解析通道可用。關鍵步驟：開放必要通道、允許管理流量。核心組件：作業系統防火牆、SMB/名稱解析。若受阻，可改以 /admin 本機 GUI 踢人或採替代遠端通路（如 WinRM）。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q10, A-Q12, D-Q6

Q10: NET USE 建立認證會話的機制是什麼？
- A簡: 透過 SMB 與認證流程建立可重用的憑證內容與會談。
- A詳: 原理說明：NET USE 與伺服器協商並通過認證，建立 SMB 會談並在本地快取憑證上下文。關鍵步驟：連線、認證、建立會談、憑證快取。核心組件：SMB 用戶端、LSA、認證提供者。之後執行針對該主機的管理命令即可沿用憑證。
- 難度: 高級
- 學習階段: 進階
- 關聯概念: A-Q13, C-Q4, D-Q4

Q11: 為何砍掉 Console 風險較高？
- A簡: Console 常承載關鍵工作與本機互動，誤斷恐影響服務。
- A詳: 原理說明：Console 多與系統層級作業或本機互動綁定，斷線或登出可能中止關鍵程序。關鍵步驟：辨識是否為 Console、避免對其採取激烈動作。核心組件：Console Session、系統服務/維運作業。故應優先處理一般會話，避免動到 Console。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q3, D-Q9, C-Q2

Q12: 什麼是 Session 0 隔離？與本文說法如何對應？
- A簡: 新版將服務隔離於 Session 0，互動登入使用其他 ID。
- A詳: 原理說明：自 Vista 起，系統服務在 Session 0，互動使用者在其他 Session，提升安全。關鍵步驟：登入時分派非 0 ID。核心組件：Session 0 Isolation、Session Manager。本文提及「0 代表 Console」僅適用舊版；新版需以工具查詢實際 ID。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q6, A-Q20, C-Q5

Q13: 斷線與登出的資源回收差異？
- A簡: 斷線保留資源與鎖；登出釋放資源、關閉程序與文件。
- A詳: 原理說明：斷線只改變連線狀態，記憶體、鎖定與程序仍屬該會話。登出則關閉使用者行程、釋放鎖與資源。關鍵步驟：斷線—狀態轉 Disc；登出—結束程序、卸載設定檔。核心組件：WTS API、Lsass、Session Manager。運維上先斷線，再權衡登出。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q7, D-Q7, C-Q2

Q14: TSDISCON 的 GUI 等效操作為何？
- A簡: 透過 Task Manager 使用者分頁或伺服器管理工具執行斷線/登出。
- A詳: 原理說明：GUI 亦是呼叫相同的終端服務 API。關鍵步驟：列出會話、選擇目標、執行斷線或登出。核心組件：Task Manager、伺服器管理工具（如舊版 Terminal Services Manager）。對不熟命令列者更直覺、安全。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q11, C-Q2, A-Q24

Q15: QWINSTA/RWINSTA 與 TSDISCON 的關係？
- A簡: QWINSTA 查詢會話；RWINSTA 重設會話；TSDISCON 僅斷線。
- A詳: 原理說明：QWINSTA（或 QUERY SESSION）用於列出會話；RWINSTA（或 RESET SESSION）強制重設會話；TSDISCON 將會話設為 Disconnected。關鍵步驟：先查詢，後選擇採取斷線、登出或重設。核心組件：終端服務命令組合使用以精準管理。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q16, C-Q5, C-Q3

Q16: 「自動斷開閒置」策略原理是什麼？
- A簡: 透過會話逾時策略，將長時間閒置或斷線會話自動處理。
- A詳: 原理說明：終端服務政策可設定閒置逾時與斷線/登出行為。關鍵步驟：達閒置門檻時自動斷線或登出，避免名額被長佔。核心組件：本機/群組原則、RDS 設定。能降低手動踢人的需求，改善資源使用效率。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: C-Q9, D-Q7, A-Q25

Q17: 權限模型：誰能斷線誰？
- A簡: 預設僅系統管理員或被授予終端服務權限者可斷線他人。
- A詳: 原理說明：終端服務權限控制包括連線、斷線、登出、重設等動作。關鍵步驟：驗證呼叫者是否具管理員或被授予對該主機/集合的管理權。核心組件：ACL、終端服務權限。若權限不足，TSDISCON 會回傳存取被拒錯誤。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: D-Q2, C-Q4, A-Q10

Q18: 名稱解析與 NET USE 的依賴關係？
- A簡: 需能解析伺服器名稱（DNS/NetBIOS），否則 NET USE 會失敗。
- A詳: 原理說明：NET USE 使用主機名稱建立連線，若 DNS 或 NetBIOS 名稱解析失敗，將無法建立認證會話。關鍵步驟：確認名稱解析、嘗試以 FQDN 或 IP。核心組件：DNS、NetBIOS、SMB。解析成功是後續遠端 TSDISCON 運作前提。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: D-Q4, D-Q6, C-Q4

Q19: 當 /console 失效時實際發生什麼？
- A簡: 新版 MSTSC 已移除 /console，需以 /admin 取代。
- A詳: 原理說明：自 Vista/2008 起，MSTSC 不再處理 /console 參數，改用 /admin 取得管理員會話。關鍵步驟：使用新參數重試。核心組件：MSTSC 參數解析更新、TermService 管理模式一致性。誤用舊參數會導致連線被拒或不生效。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q20, D-Q5, C-Q1

Q20: 被踢使用者端會看到什麼行為？
- A簡: 會話變為斷線，連線中斷；稍後可再連回原狀態。
- A詳: 原理說明：TSDISCON 使會話轉 Disc，客戶端立即斷線。關鍵步驟：客戶端顯示中斷訊息、使用者可重新連線。核心組件：會話狀態維護、客戶端重連。若管理者改用登出或重設，則使用者程式會結束，無法恢復至先前狀態。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q7, D-Q7, C-Q3


### Q&A 類別 C: 實作應用類（10題）

Q1: 如何用 MSTSC 連到 Console/Admin 會話？
- A簡: 用 /admin 參數連線，如 mstsc /admin /v:SERVER，可避名額限制。
- A詳: 具體步驟：1) 本機按 Win+R；2) 輸入命令 mstsc /admin /v:伺服器;3) 以管理帳號登入。關鍵程式碼片段或設定：mstsc /admin /v:SERVERNAME。注意事項：新版使用 /admin 取代 /console；登入後立即檢查 Users 分頁，避免誤踢 Console。最佳實踐：登入前先知會團隊，減少干擾。
- 難度: 初級
- 學習階段: 基礎
- 関聯概念: A-Q4, A-Q20, D-Q5

Q2: 如何用 Task Manager 斷線特定使用者？
- A簡: 進入「使用者」分頁，右鍵目標使用者，選擇中斷或登出。
- A詳: 具體步驟：1) 以 /admin 登入伺服器；2) 開啟 Task Manager；3) 切到「使用者」頁；4) 右鍵選擇「中斷連線」或「登出」。關鍵操作點：比對帳號與 Session ID。注意：先斷線再評估是否登出；避免處理 Console 會話。最佳實踐：記錄被處理對象與時間。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q11, A-Q7, D-Q9

Q3: 如何用 TSDISCON 在本機踢掉某工作階段？
- A簡: 本機命令 tsdiscon <ID>，將指定會話轉為 Disconnected。
- A詳: 具體步驟：1) 以管理權限開啟命令提示字元；2) 先以 Task Manager 或 query session 取得 Session ID；3) 執行 tsdiscon 1。關鍵程式碼：tsdiscon 1。注意：請勿對 Console 動手；斷線不會關閉程式。最佳實踐：先確認目標使用者身分與狀態。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q5, A-Q6, B-Q4

Q4: 如何在遠端執行 TSDISCON 踢人？
- A簡: 先 NET USE 建立認證，再 tsdiscon <ID> /server:<主機> 斷線。
- A詳: 具體步驟：1) net use \\SERVER /user:DOMAIN\ADMIN *；2) 依圖台或指令取得 ID；3) tsdiscon 1 /server:SERVER。關鍵程式碼：NET USE \\MYSERVER /user:MYACCOUNT *；tsdiscon 1 /server:MYSERVER。注意：防火牆勿封 NetBIOS/SMB；權限不足會失敗。最佳實踐：事先測試認證。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q10, A-Q13, D-Q6

Q5: 如何快速查到 Session ID？
- A簡: 用 Task Manager「使用者」頁，或命令 query session /server:主機。
- A詳: 具體步驟：1) GUI：Task Manager→使用者→看 ID 欄；2) 命令：query session /server:SERVER 或 qwinsta /server:SERVER。關鍵程式碼：query session；qwinsta。注意：新版 Console ID 不一定為 0。最佳實踐：雙重確認帳號與 ID 再執行斷線。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q6, B-Q7, C-Q3

Q6: 如何在斷線後立刻「佔名額」登入？
- A簡: 開兩個視窗準備；斷線指令送出後立即以 RDP 連入。
- A詳: 具體步驟：1) 預先開啟 MSTSC 輸入伺服器；2) 另開命令視窗定位 tsdiscon 命令；3) 先按 Enter 執行 tsdiscon，再立刻切回 MSTSC 按連線。關鍵動作：縮短對方重連時間差。注意：僅限必要時使用。最佳實踐：先用斷線而非登出。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q23, D-Q7, A-Q25

Q7: 如何寫批次檔自動踢出 ID 1 或 2？
- A簡: 批次用 tsdiscon 1 與 tsdiscon 2，偵錯輸出確認結果。
- A詳: 具體步驟：建立 kick.bat，內容例如：tsdiscon 1 || echo 1失敗 & tsdiscon 2 || echo 2失敗。關鍵程式碼：tsdiscon 1 & tsdiscon 2。注意：不保證 ID 一定是佔用者，仍建議先查詢；避免誤踢 Console。最佳實踐：加入 query session 過濾使用者後再執行。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q7, C-Q5, D-Q3

Q8: 如何用 PowerShell 踢出閒置最久的會話？
- A簡: 以 query session 解析輸出，找出最久閒置的 ID 後 tsdiscon。
- A詳: 具體步驟：1) 使用 PowerShell 執行 query session 並以正則分析；2) 依 Idle 時間排序取第一；3) 執行 tsdiscon <ID>。關鍵程式碼片段：powershell 解析 qwinsta 輸出並呼叫 tsdiscon。注意：解析格式因語系不同需調整。最佳實踐：排除 Console 與服務帳號。
- 難度: 高級
- 學習階段: 進階
- 關聯概念: B-Q15, B-Q16, A-Q25

Q9: 如何設定群組原則自動斷開閒置連線？
- A簡: 設定遠端工作階段時間限制政策，對閒置自動斷線或登出。
- A詳: 具體步驟：1) 開啟 gpedit.msc 或 GPMC；2) 導航：電腦設定→系統管理範本→Windows 元件→遠端桌面服務→遠端桌面工作階段主機→工作階段時間限制；3) 設定閒置時間與動作。注意：先以斷線為主。最佳實踐：根据業務時段差異設不同策略。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q16, D-Q7, A-Q25

Q10: 防火牆限制下如何仍能踢人？
- A簡: 改以 /admin 先本機登入 GUI 斷線，或用已開放的管理通道。
- A詳: 具體步驟：1) 若遠端命令失敗，改用 mstsc /admin 嘗試登入；2) 登入後以 Task Manager 斷線；3) 或使用既有允許的管理通道（如 WinRM/PowerShell Remoting）在目標上執行 tsdiscon。注意：遵循資安規範。最佳實踐：事前開通標準維運通道。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q9, D-Q6, C-Q1


### Q&A 類別 D: 問題解決類（10題）

Q1: 連線人數已滿無法登入怎麼辦？
- A簡: 先用 /admin 嘗試登入；不行則以 TSDISCON 斷線釋出名額。
- A詳: 症狀：MSTSC 顯示超過允許連線數。可能原因：僅兩席管理連線且已滿。解決步驟：1) mstsc /admin 連入；2) Task Manager 斷線一人；或 3) 先 NET USE，再 tsdiscon <ID> /server:<主機>。預防：設定閒置自動斷線、建立維運通道與告警。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q4, A-Q23, C-Q4

Q2: TSDISCON 顯示 Access is denied 如何處理？
- A簡: 以具權限帳號重試，先建立 NET USE 認證，確認終端服務權限。
- A詳: 症狀：存取被拒。可能原因：非管理員、缺少斷線權限或憑證未建立。解決步驟：1) 使用 DOMAIN\Admin；2) 先 NET USE 建立認證；3) 檢查是否被群組原則限制。預防：將維運帳號納入 Administrators，定期驗證遠端管理權限。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q10, A-Q17, B-Q17

Q3: TSDISCON 提示無效的工作階段 ID？
- A簡: 重新查詢正確 ID；注意新版 Console ID 不一定是 0。
- A詳: 症狀：找不到 ID。原因：誤判使用者與 ID 對應、版本差異、會話已變更。解決步驟：1) 用 Task Manager 或 query session 重新確認；2) 避免硬編碼 1/2；3) 再次執行 tsdiscon。預防：操作前總是查詢比對帳號與狀態。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q6, C-Q5, C-Q7

Q4: NET USE 無法連線或認證失敗怎麼辦？
- A簡: 檢查帳密、名稱解析與網路通道；改用 FQDN 或 IP 測試。
- A詳: 症狀：NET USE 回報登入失敗或找不到路徑。原因：帳密錯、DNS/NetBIOS 解析失敗、防火牆阻擋。解決步驟：1) 驗證帳密與網域；2) 用 \\FQDN 或 \\IP 測試；3) 檢查防火牆與時間同步。預防：維運清單中備註 FQDN/IP 與替代通道。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q10, B-Q18, C-Q4

Q5: /console 無效或 MSTSC 拒絕參數怎麼辦？
- A簡: 新版請改用 /admin 參數；更新客戶端並重試。
- A詳: 症狀：/console 無效或報錯。原因：Vista/2008 起移除 /console。解決步驟：1) 使用 mstsc /admin；2) 確認客戶端版本；3) 仍無法則改用 TSDISCON 或 GUI 踢人。預防：在文件與腳本統一改為 /admin，避免歷史參數混用。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q20, C-Q1, B-Q19

Q6: 防火牆封鎖導致遠端 TSDISCON 失敗？
- A簡: 開放必要通道或改走已允許通道；或先 /admin 本機登入處理。
- A詳: 症狀：NET USE 或 tsdiscon /server 逾時/失敗。原因：防火牆阻擋 NetBIOS/SMB 或管理流量。解決步驟：1) 暫時開放必要通道；2) 改用 WinRM/PowerShell；3) 直接 mstsc /admin 登入 GUI 斷線。預防：標準化維運通道與白名單。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q9, C-Q10, A-Q12

Q7: 踢人後對方立刻搶回名額怎麼辦？
- A簡: 先斷線後迅速登入；必要時改用登出或設定自動斷線策略。
- A詳: 症狀：剛釋出名額又被占。原因：對方自動重連或馬上重登。解決步驟：1) 準備好 MSTSC，斷線後立刻登入；2) 若需避免回連，改登出；3) 設定閒置自動斷線。預防：與團隊溝通維護時段，減少重連衝突。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q6, A-Q7, C-Q9

Q8: 看不到 Users 頁籤或找不到 ID 欄位怎麼辦？
- A簡: 在新版 Task Manager 至「使用者」分頁；或用 query session 查詢。
- A詳: 症狀：UI 中無法定位使用者清單或 ID。原因：版本 UI 差異或權限不足。解決步驟：1) 以系統管理員開啟 Task Manager；2) 切到「使用者」頁；3) 改用命令 query session /server:主機。預防：將查詢命令納入標準操作流程。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: C-Q2, C-Q5, B-Q6

Q9: 誤踢錯人導致服務受影響如何補救？
- A簡: 立即通知、協助重連或復原；檢討流程並加強雙重確認。
- A詳: 症狀：斷線關鍵使用者或 Console。原因：ID/帳號辨識錯誤。解決步驟：1) 立即與受影響者溝通；2) 協助重連或改登出/重設；3) 若影響服務，依災復程序處理。預防：雙重確認帳號與 ID、先斷線後再評估登出、避動 Console。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q11, B-Q11, C-Q5

Q10: 無法使用任何方式連線主機（含 /admin）怎麼辦？
- A簡: 透過主機外帶外管道（KVM/IPMI）或實體入場排障。
- A詳: 症狀：RDP 與遠端命令皆失敗。原因：網路中斷、RDP 停用或系統卡死。解決步驟：1) 使用機房外管如 iLO/iDRAC/KVM；2) 請現場協助；3) 檢查事件記錄與服務狀態；4) 恢復後再檢討 RDP 政策與監控。預防：建置帶外管理與健康檢查。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: C-Q10, B-Q1, D-Q6


### 學習路徑索引
- 初學者：建議先學習哪 15 題
    - A-Q1: 什麼是遠端桌面連線（RDP）？
    - A-Q2: 什麼是終端工作階段（Terminal Session）？
    - A-Q3: 什麼是 Console Session？
    - A-Q4: 為什麼需要用 /console 或 /admin 連線？
    - A-Q5: 什麼是 TSDISCON 指令？
    - A-Q7: 斷線（Disconnect）與登出（Logoff）的差異是什麼？
    - A-Q8: 為什麼會出現「連線人數已滿」？
    - A-Q11: Task Manager 的「使用者」分頁有何作用？
    - A-Q20: Windows 版本差異：/console 與 /admin 有何不同？
    - C-Q1: 如何用 MSTSC 連到 Console/Admin 會話？
    - C-Q2: 如何用 Task Manager 斷線特定使用者？
    - C-Q3: 如何用 TSDISCON 在本機踢掉某工作階段？
    - D-Q1: 連線人數已滿無法登入怎麼辦？
    - D-Q5: /console 無效或 MSTSC 拒絕參數怎麼辦？
    - D-Q8: 看不到 Users 頁籤或找不到 ID 欄位怎麼辦？

- 中級者：建議學習哪 20 題
    - A-Q6: Session ID 是什麼？0 代表什麼？
    - A-Q10: 使用 TSDISCON 的前置條件有哪些？
    - A-Q12: 什麼是 NetBIOS？與本文技巧有何關聯？
    - A-Q13: NET USE 指令的用途是什麼？
    - A-Q15: 砍人（斷線/登出）會不會造成資料遺失？
    - A-Q16: TSDISCON、LOGOFF 與 RESET SESSION 有何差異？
    - A-Q18: 連進 Console 後如何查看誰在線？
    - A-Q25: 何謂最佳實務的「佔名額」策略？
    - B-Q3: Console/Admin 連線如何避免佔用一般名額？
    - B-Q4: TSDISCON 的工作原理與狀態轉換？
    - B-Q5: 使用 TSDISCON 踢遠端使用者的技術流程？
    - B-Q7: Session ID 如何被指派與比對？
    - B-Q9: 防火牆與通訊對此技巧的影響為何？
    - C-Q4: 如何在遠端執行 TSDISCON 踢人？
    - C-Q5: 如何快速查到 Session ID？
    - C-Q6: 如何在斷線後立刻「佔名額」登入？
    - C-Q9: 如何設定群組原則自動斷開閒置連線？
    - D-Q2: TSDISCON 顯示 Access is denied 如何處理？
    - D-Q3: TSDISCON 提示無效的工作階段 ID？
    - D-Q6: 防火牆封鎖導致遠端 TSDISCON 失敗？

- 高級者：建議關注哪 15 題
    - A-Q9: 內建兩個同時連線限制的由來是什麼？
    - A-Q21: 什麼是 Remote Desktop Services（RDS）授權？
    - B-Q1: 遠端桌面服務（RDS）的運作架構為何？
    - B-Q2: RDP 連線建立的執行流程是什麼？
    - B-Q8: 兩個管理連線限制如何被技術上強制？
    - B-Q10: NET USE 建立認證會話的機制是什麼？
    - B-Q12: 什麼是 Session 0 隔離？與本文說法如何對應？
    - B-Q13: 斷線與登出的資源回收差異？
    - B-Q15: QWINSTA/RWINSTA 與 TSDISCON 的關係？
    - B-Q16: 「自動斷開閒置」策略原理是什麼？
    - B-Q17: 權限模型：誰能斷線誰？
    - B-Q18: 名稱解析與 NET USE 的依賴關係？
    - B-Q19: 當 /console 失效時實際發生什麼？
    - C-Q8: 如何用 PowerShell 踢出閒置最久的會話？
    - D-Q10: 無法使用任何方式連線主機（含 /admin）怎麼辦？