# 微服務架構設計 - Event Sourcing

# 問答集 (FAQ, frequently asked questions and answers)

## Q: 什麼是 Event Sourcing？
Event Sourcing 是一種資料持久化策略：系統儲存的不是「最新狀態」，而是「導致狀態改變的事件序列」。只要完整保留事件，就能在任意時間點重播事件以還原當時的資料狀態。

## Q: Event Sourcing 帶來哪些系統層面的特性？
1. 資料只會「新增」(Append-Only)，基本操作從 CRUD 簡化成 CR，刪除僅限封存（archive）。  
2. 為確保事件順序與一致性，常與 CQRS 搭配：Command 流經序列化後入庫，Query 透過獨立的讀模型取得結果。  
3. 若要快速取得聚合結果，需額外以 Streaming/CQRS 方式同步更新 Read Model，否則直接由事件計算將非常低效。

## Q: 為何金融／交易系統特別適合採用 Event Sourcing？
交易系統常需要：
• 完整保存每筆異動的「順序」與「過程」做稽核。  
• 事後能根據更正邏輯重新計算餘額（例如利息算錯再補差額）。  
事件本身就是「來源資料」可直接重播；傳統只存最後餘額外加 log，log 難以回灌重新運算。

## Q: 採用 Event Sourcing 的主要缺點是什麼？
需要付出額外成本：  
• 儲存空間持續成長。  
• 撈取最終結果必須重播或維護額外 Read Model，計算資源消耗大。  
• 開發、維運人員需具備更高的分散式與一致性設計能力。

## Q: 在 Cloud Native 架構下，為何硬體備援已不足以保證可用性？
當伺服器規模達到「成千上萬」時，再低的單機故障率乘上極大量節點，失效率仍不可忽視。Google 的做法是軟體層面 (如 BigTable) 直接容忍與自動修復節點故障，而非依賴昂貴的硬體 RAID/HA。

## Q: MapReduce 如何解決 PB 級資料查詢的 I/O 瓶頸？
MapReduce 以「資料為中心」：把運算（Query）程式片段送到資料所在節點「就地」執行，再收集結果，避免大量資料在網路中搬移，因而同時改善 I/O 與可擴充性。

## Q: 為何說 Event Sourcing 只是 Cloud Native 思維下的其中一個常用 Pattern？
Cloud Native 強調「先處理、再寫入、犧牲強一致換取最終一致」，Event Sourcing 只是其中一種落實方式。通常它會與 CQRS、Message Queue、Streaming Processing、NoSQL 等其他技術一起使用，而不會單獨存在。

## Q: 資料收集延遲與即時報表衝突時應如何設計系統？
1. 區分「事件發生時間」與「系統收到時間」。  
2. 以 Event Sourcing 順序儲存所有事件。  
3. 透過 CQRS 建立多組 Read Model，例如：  
   • 即時資訊（線上即到即算）  
   • 歷史日報（隔日批次匯總）  
   • 修正通知（延遲事件回補及警示）  
4. 訂定可容忍的最大延遲（如 72 小時），超過即走例外流程或關帳機制。

## Q: 什麼情境下應該認真考慮使用 Event Sourcing？
當系統需同時滿足以下條件時：
• 必須完整保存每筆異動歷程，且歷程本身就是最重要的事實。  
• 需要隨時可重播事件以重建狀態或追溯錯誤。  
• 資料規模、並行量或可靠性要求已跨過傳統單體／關聯式資料庫的可伸縮極限。