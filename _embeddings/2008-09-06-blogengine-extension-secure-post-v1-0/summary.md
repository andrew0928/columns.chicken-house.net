# BlogEngine Extension: Secure Post v1.0

## 摘要提示
- 需求來源: 作者為了讓家人能簡單以「輸入密碼」方式閱讀特定文章，決定自行撰寫 BlogEngine.NET 擴充功能。
- 開發目標: 不需帳號、角色與登入機制，只要一組密碼即可保護指定文章。
- 核心技術: 利用 BlogEngine 的 Post.Serving 事件攔截並替換文章內容。
- 判斷條件: 文章開頭出現 `[password]` 字串才啟用保護機制。
- 驗證流程: 伺服器端檢查 QueryString `?pwd=` 是否等於預設密碼；若正確則顯示原文。
- 使用者介面: 提示訊息＋密碼輸入框，點擊 GO 重新導向同一篇文章並附帶密碼。
- 安全考量: 僅滿足基本需求，未實作雜湊或加密，密碼以明碼傳送。
- Extension 設定: 透過 Extension Manager 提供「顯示訊息、密碼提示、實際密碼」三項可調參數。
- 程式篇幅: 整體程式碼不足百行，容易安裝與維護。
- 散布方式: 允許自由使用與分享，惟希望引用原文連結。

## 全文重點
作者因家人要求「特定文章須輸入密碼才能閱讀」而撰寫了 BlogEngine.NET 擴充套件 Secure Post v1.0。此擴充透過訂閱 Post.Serving 事件，在文章輸出階段先判斷是否為受保護文章（以 `[password]` 做為旗標），若來自未登入訪客且 QueryString 中 `pwd` 值與設定密碼不符，即將文章內容替換為自訂提示與密碼輸入表單；使用者輸入正確密碼後重新導向同網址並帶入 `?pwd=xxx`，伺服器再度比對成功便放行原文。整體實作僅數十行 C#，並利用 ExtensionSettings 提供三個可調參數，使管理者可於後台 Extension Manager 直接設定提示訊息、密碼提示及真正密碼。作者強調此方案只追求「夠用就好」的保護，未處理雜湊、SSL 或進階權限管理，但已足以滿足家庭使用場景。最後附上完整程式碼與安裝說明，鼓勵讀者自由取用並引用本文鏈結。

## 段落重點
### 1. 需求與動機
作者家人願意將部落格系統從 CommunityServer 轉到 BlogEngine，但前提是必須支援「單篇文章密碼保護」功能。市面上現有擴充多仰賴帳號或角色權限，使用流程繁複，不符家人「輸入暗號即看文」的簡單需求，因此決定自行開發。

### 2. 初步實作與事件攔截
BlogEngine 允許透過 Extension 機制攔截文章輸出。作者於 Static Constructor 中註冊 `Post.Serving` 事件，於事件處理函式先行替換 `e.Body` 內容為提示訊息和密碼輸入表單。此階段重點在於證明概念 (POC)，確定可於伺服端動態更換文章 HTML。

### 3. 密碼驗證邏輯
進一步在相同事件處理器加入兩行關鍵程式：  
1) 若使用者已登入或 QueryString `pwd` 等於預設密碼則直接回傳原文；  
2) 若文章首行非 `[password]` 亦不啟用保護。  
如此即可以最少代碼完成伺服端驗證並避免在用戶端洩露原文。

### 4. Extension 設定介面
為方便非技術使用者更改訊息與密碼，作者利用 `ExtensionSettings` 建立三個可編輯參數（SecurePostMessage、PasswordHint、PasswordValue），並設定 `IsScalar = true` 使之呈現單筆設定。匯入後即可於 BE 後台 Extension Manager 點擊「編輯」並透過表單修改數值，達到免改程式碼即可調整的目的。

### 5. 完整程式碼與安裝方式
最終 SecurePost.cs 約百行，引用 System.Web 與 BlogEngine.Core，即可完成攔截、驗證、介面呈現與設定存取。安裝僅需將檔案放入 `~/App_Code/Extension/`，登入後台啟用並調整參數。作者開放自由下載使用，但請引用原文連結並歡迎留言、推文或贊助。