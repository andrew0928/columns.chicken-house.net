# [設計案例]「授權碼」如何實作？#1 需求與問題

## 摘要提示
- 授權碼: 在離線環境中以一段字串判定功能啟用與否，避免未授權開啟。  
- API KEY: 服務之間僅憑 API KEY 驗證並決定可呼叫的功能集合。  
- 離線運作: 即使無法連上外網，授權仍須可驗證、到期並強制中止。  
- 安全強度: 透過對稱／非對稱加解密與數位簽章，讓熟悉程式碼的工程師也難以破解。  
- 可擴充性: 架構必須能輕鬆加入新服務或新授權項目，維持長期演進能力。  
- DX: 將 Developer Experience 視為 UX 延伸，API 不只要能用，還要讓開發者用得順手。  
- 架構思考: 先問「Why」再決定「How」，以業界標準技術對應真實商務痛點。  
- 系統情境: 同套程式碼分散裝在多個客戶機房，授權由雲端服務個別控管。  
- Security 缺口: 工程師常忽略資安導致麵條碼與事件風險，本系列示範如何在程式結構上補強。  
- 系列規劃: 後續文章將談序列化、數位簽章與金鑰保護等實作細節。

## 全文重點
作者以實際商用系統為例，闡述在「Install Based」佈署模式下的授權與 API KEY 管理問題。系統程式碼相同，卻必須依客戶、功能、合約期間開啟差異化授權；同時服務彼此呼叫時僅能透過 API KEY 決定存取範圍。由於客戶端資料中心可能完全離線，任何授權判斷都必須在封閉網路內獨立完成，而且到期後立即失效，待取得新授權方能恢復。  
技術層面看似只要加密或雜湊即可，真正困難在於選對對稱或非對稱演算法、掌握加密與數位簽章各自解決的問題，並以良好封裝提供易於維護、易於擴充且 DX 友善的程式介面。作者指出許多工程師因缺乏資安素養，常把安全機制硬塞進既有程式碼，結果成義大利麵式架構；而當資安事件爆發時才發現修補成本高昂。  
本篇首先定義五大需求：網站授權、API KEY、授權期限、安全強度與擴充機制，並以故事敘述方式具體化。接著導入 DX 概念，強調「好用」與「能用」的差異；唯有讓開發者願意使用並正確使用，安全機制才真正落地。文章最後預告後續章節將深入序列化、數位簽章與金鑰保護的實作細節，提供從架構思考到程式寫法的完整範例。

## 段落重點
### 本文開始
作者以三台服務 (Cloud Service #A、客戶端 Service #B、Service #C) 的部署情境切入，說明相同程式碼安裝於不同客戶資料中心，卻需各自啟用不同功能。由於環境可能無對外網路，授權碼必須脫機運作並涵蓋功能列表與到期日。隨後提出五點需求：1) 功能授權必須透過設定檔且能阻擋系統整合商私自開啟；2) API KEY 單一驗證即可決定功能；3) 離線到期管控；4) 必要的安全強度；5) 易於擴充的新服務授權。作者強調，理解對稱／非對稱加解密與簽章原理即可解決半數技術難題，剩下的關鍵則在於以 OOP 封裝並兼顧 DX，讓開發者能快速、安全地引用。

### 參考文章
文末列出多篇 DX 相關讀物，並引用 Nordic APIs 對「Developer Experience」的定義，說明 DX 是 UX 的延伸，使用者變成了開發者。良好的 DX 能讓 API 更易被採納並正確使用，間接提升安全與維護品質。作者藉此呼籲讀者在設計安全機制時，別忽略開發者感受，否則再堅固的演算法也可能因錯誤或複雜的介面而被繞過。最後預告下一篇將探討「授權碼序列化」，從資料格式與封裝方式開始落實整體設計。