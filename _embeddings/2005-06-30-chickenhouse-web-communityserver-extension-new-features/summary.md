# ChickenHouse.Web.CommunityServiceExtension 新增功能

## 摘要提示
- 使用動機: 選用 Community Server 的主要原因之一是其內建 Photo Gallery 方便好用。
- 痛點來源: 讀者常要求一次抓取相簿所有照片，導致作者反覆手動打包 zip。
- 自動化解法: 新增功能可一鍵下載整個相簿，免去手動壓縮流程。
- 介面位置: 在每個相簿右上角新增一個下載連結。
- 輸出格式: 點擊連結可直接取得包含相簿內所有檔案的 zip 檔。
- 使用體驗: 以最少步驟完成批次下載，改善瀏覽分享效率。
- 開發背景: 作者因實際需求驅動，花時間實作擴充功能。
- 便利性提升: 解決多次重複打包的麻煩，提升維護與分享效率。
- 平台範疇: 功能屬於 Community Server 的擴充（Extension）。
- 語氣風格: 以輕鬆幽默的口吻分享實作成果與好用程度。

## 全文重點
作者使用 Community Server 的主要原因之一是其方便的相簿（Photo Gallery）功能，但在實際使用中經常遇到讀者想一次下載整個相簿的需求。過去作者只能手動幫忙壓縮相簿成 zip 檔供下載，做多了變成負擔。為解決這個重複性工作，作者開發了擴充功能：在每個相簿的右上角新增一個下載連結，使用者只要點擊即可直接取得包含該相簿所有檔案的 zip 檔。此功能大幅簡化從瀏覽到分享的流程，將原本需要作者介入的步驟自動化，提升使用者體驗與效率。文章以輕鬆幽默的語氣介紹此改進，並以截圖示意下載入口位置，讓讀者容易理解操作方式與帶來的便利。

## 段落重點
### 使用動機與痛點
作者選擇 Community Server 的重要理由之一是其相簿功能齊全、上手容易，適合作為影像分享平台。然而在實務上，當作者把照片整理並上傳供人瀏覽後，常會被要求提供「一次抓完所有圖片」的方式。由於平台原生不支援整本相簿的批次下載，作者只好反覆幫忙手動打包 zip 檔並提供連結。這樣的操作雖然可行，卻隨著次數增加變得相當繁瑣，也浪費維護者時間。痛點清楚：需求普遍、操作冗長、且重複性高，因此非常適合透過功能擴充來自動化解決。

### 新功能與使用方式
為根本解決批次下載的需求，作者為 Community Server 相簿開發了擴充功能：在每個相簿頁面的右上角新增一個明顯的下載連結。使用者只需點擊該連結，即可直接下載一個包含該相簿所有影像檔案的 zip 檔，免去逐一下載或向站方索取壓縮包的步驟。此設計將批次下載整合為單一步驟，簡潔直觀，並最大化減少維護者的人工介入。文章以截圖展示連結位置，並以幽默口吻強調功能的便利性，突顯此擴充帶來的體驗提升與效率改善。

## 資訊整理

### 知識架構圖
1. 前置知識：
   - 了解 Community Server 的相簿（Photo Gallery）功能與模組結構
   - 基本 .NET/C# 網站開發與伺服端檔案處理
   - ZIP 壓縮與串流下載的概念
   - 基本網站授權/驗證與檔案權限

2. 核心概念：
   - 批次下載需求：使用者希望一次取得整個相簿所有照片
   - 相簿整包下載：於相簿頁面提供一鍵下載 ZIP 檔
   - 伺服端動態壓縮：將相簿內所有檔案打包為 ZIP 後提供下載
   - 介面整合：在每個相簿右上角新增下載連結
   - 使用體驗提升：減少管理者手動打包與反覆傳送的成本

3. 技術依賴：
   - Community Server 平台與其相簿資料結構（相片儲存位置/中介層 API）
   - .NET Framework（檔案 I/O、HTTP 回應串流）
   - ZIP 壓縮程式庫（如 SharpZipLib、System.IO.Compression）
   - 驗證與授權（僅允許可存取該相簿之用戶下載）

4. 應用場景：
   - 活動/旅遊相片分享時，使用者一次下載整包相片
   - 需離線瀏覽或備份整個相簿
   - 降低站方為個別使用者重複打包的維運成本
   - 教學或專案交付需提供原始相片檔案集

### 學習路徑建議
1. 入門者路徑：
   - 認識 Community Server 相簿基本操作與檔案存放
   - 熟悉 C# 伺服端建立下載端點（Handler/Controller）與回應檔案串流
   - 使用內建或第三方 ZIP 函式庫完成小量檔案的動態打包
   - 在相簿頁面新增一個下載連結並串接後端端點

2. 進階者路徑：
   - 大量檔案/大檔案的串流壓縮（邊讀邊壓邊傳）與記憶體控管
   - 權限控制、下載速率限制、錯誤處理與重試機制
   - 快取策略（預先產生 ZIP、檔案變更失效、檔名版本化）
   - 觀測性（記錄下載次數、耗時、失敗率）與最佳化（I/O、CPU）

3. 實戰路徑：
   - 步驟1：分析相簿資料來源（DB/檔案系統），列出相片清單
   - 步驟2：實作 ZIP 打包服務（支援串流，避免一次載入全部）
   - 步驟3：建立下載端點，處理授權、檔名與 MIME type 設定
   - 步驟4：在相簿頁面右上角加入「下載整個相簿」按鈕/連結
   - 步驟5：加入快取與錯誤處理，壓力測試並監控上線表現

### 關鍵要點清單
- 批次下載需求痛點: 使用者想一次取得所有相片，避免逐張下載與站方反覆手動打包 (優先級: 高)
- 一鍵相簿打包下載: 在相簿頁面提供直接下載整個相簿的 ZIP 檔 (優先級: 高)
- 介面位置與可發現性: 下載連結置於相簿右上角，提升可見度與易用性 (優先級: 中)
- 伺服端動態壓縮: 即時將相片打包成 ZIP，降低存儲預算與維護成本 (優先級: 高)
- 串流傳輸與記憶體控管: 大相簿需邊讀邊壓邊傳，避免高記憶體占用 (優先級: 高)
- 權限與安全: 僅授權使用者可下載對應相簿，避免未授權存取 (優先級: 高)
- 檔名與國際化處理: ZIP 檔名與相片檔名的編碼與可讀性 (優先級: 中)
- 錯誤處理與逾時: 檔案遺失、I/O 失敗、逾時與用戶提示 (優先級: 中)
- 快取與再利用: 熱門相簿可預先產生 ZIP，並在內容更新時失效 (優先級: 中)
- 效能與資源限制: CPU/磁碟 I/O、同時下載數、頻寬控管 (優先級: 高)
- 日誌與監控: 記錄下載次數、耗時、失敗率以便優化 (優先級: 中)
- 使用者體驗: 顯示檔案大小/預估時間、進度或排隊提示 (優先級: 中)
- 相容性與瀏覽器行為: Content-Type/Disposition 設定，避免瀏覽器誤開 (優先級: 低)
- 第三方庫選擇: SharpZipLib 或 System.IO.Compression 的取捨與授權 (優先級: 低)
- 維運流程: 異常回報、資源告警、例行壓力測試與升級計畫 (優先級: 低)