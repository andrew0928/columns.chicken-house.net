```markdown
# [架構師的修練] #2　SLO──如何確保服務水準？

## 摘要提示
- SLO定義: 以 SLA／SLO／SLI 三層概念把「服務品質」轉成可被驗證的規格。
- 監控指標: 將流程拆成 A/B/C1 與排隊長度 D，讓時間與負載能量化監控。
- 案例實作: 驗證簡訊因行銷訊息塞車，經分流與動態擴充化解延遲。
- 限制理論: 以 Drum-Buffer-Rope 模型鎖定瓶頸，避免資源浪費。
- 自動化調節: 透過延遲預估與 Feature Toggle，在過載時主動降級或暫停入口。
- 成本平衡: 以「運算單位」衡量雲端成本，找出服務水準與費用交集。
- 多重 SLO: 以 QoS／Rate-Limit 控制共用瓶頸，防止局部最佳化拖垮全局。
- DevOps循環: 量測→回饋→改善，把 SLO 與監控深度整合進開發流程。
- 能力連結: 架構師需整合開發、雲端、流程管理才能端出完整解法。
- 刻意練習: 把真實 SLO 案例當練功場，累積並串聯跨域知識網。

## 全文重點
作者以一年內在 91APP TechDay 與 .NET Conf 分享的「非同步系統 SLO」案例，示範架構師如何把開發技術、雲端基礎建設與管理理論融合，用系統化方法保證服務水準。文章先釐清 SLA／SLO／SLI 的定位，再從驗證簡訊被行銷訊息塞車的實務痛點出發，將整個流程拆成三段時間 A/B/C1 與佇列長度 D，使「五秒內送達」能被量測。接着運用監控 API 把數據送進 Dashboard，以燈號和預警驅動維運 SOP。

當延遲來自訊息堆積，作者先分流高優先與低優先訊息，並依限制理論 Drum-Buffer-Rope 找瓶頸、設緩衝與拉繩。若預估延遲超過 30 秒，系統自動對前端發訊號或切換備援方案，達到「提前降載」。文章亦討論兩個進階議題：其一是成本，透過「虛擬運算單位」把費用納入 SLI，讓 Dev、Ops、Infra 能在 SLO 與 Cost 之間作量化決策；其二是多服務競爭同一瓶頸時，必須用 QoS / Rate-Limit 手段避免局部最佳化導致整體退化。作者最後把整條流程對位到 DevOps 無限迴圈，強調有了可量測指標、回饋與自動化，才能真正落實服務導向的軟體開發。

## 段落重點
### 開始前先想一想：要解決的問題是什麼？
作者回顧自身負責的 FaaS 形非同步平台：眾多團隊提交任務，系統須在雲端以最省成本方式於時限內完成。驗證簡訊案例揭示：單靠「把程式寫快」無法保證用戶體驗，必須結合雲端資源調度與流程管理，才可能穩定達標。

### 主題：非同步系統的服務水準保證
回顧 2017~2020 系列研討會主題，從容器開發、MQ-RPC、微服務框架到 Process Pool，鋪陳今日探討 SLO 的基礎；並說明本篇將透過完整案例示範「連結知識」的威力。

### 1. 何謂服務水準？該如何量化與量測？
闡述 SLA（對客承諾）、SLO（目標）、SLI（指標）層次；以 99% request 300 ms 為例說明需先定義 SLO，再把 SLI 埋入系統並以燈號呈現，形成 DevOps 監控-改善迴圈。

### 2. Case Study：驗證簡訊的發送
概述系統初版共用同一 MQ，行銷訊息衝擊導致驗證簡訊延遲，暴露「時間型需求難以用傳統規格驗收」的困境。

### 2-1. 改善的第一步：找出正確的指標
將五秒目標拆成 A（前端處理）、B（排隊）、C1（Worker 處理）與 D（Queue 長度），並在程式四個節點寫入時間戳，送往監控系統做計算與警示。

### 2-2. 改善的第二步：解讀瓶頸在哪裡
根據 SOP 判讀 A/B/C1/D 組合，區分「訊息量爆炸」或「處理效能不足」；若 B 和 D 同時升高，初步以 scale-out Worker 解急。

### 2-3. 從開發的第一天就弄清楚 SLO
強調 Design for Operation；開發階段即需埋指標並與監控平台銜接，使上線後能直接以 Dashboard 觀測服務品質。

### 2-4. 藉由限制理論 (TOC) 找出對策
介紹 Drum-Buffer-Rope 概念：瓶頸決定節奏，前置 Buffer 保護產能，Rope 回拉入口；將 MQ 視為 Buffer，可依 Queue 長度調節流量。

### 2-5. 將限制理論套用到系統身上
落地作法是訊息分流：高優先的驗證簡訊使用獨立 Queue 與更多 Worker，確保瓶頸資源集中服務高價值任務。

### 2-6. 如果長時間無法滿足 SLO？
利用「預估等待 = D / 處理速率」計算是否超過 30 秒；若超標，透過 API 或 Feature Toggle 拉繩通知前端降級或暫停入口，避免大量過期訊息占用瓶頸。

### 2-7. Case Study 小結
此例證明：服務品質不只拼效能，更須管理優先權、瓶頸與成本；架構師的重要價值在於把技術、流程與商業需求串成可落地的方案。

### 3. 其他跟 SLO 相關的進階議題
提出「成本」與「多重 SLO 競合」兩大挑戰，並以雲費用指標與 QoS/RL 機制示範如何應對。

### 3-1. SLO 背後的成本問題
將雲資源化為抽象「運算單位」，與 SLO 數據一起監控；Dev 專注優化程式、Infra 降低平台成本、Ops 在 SLO 與成本間動態取捨。

### 3-2. 多個任務競爭有限的資源（瓶頸）
說明局部最佳化可能拖垮全局；當交易後處理擴充過度導致 DB 壅塞時，應反向利用 Rate-Limit 讓瓶頸“不跑那麼快”，維持整體吞吐。

### 4. 總結：改善 SLO 就是落實 DevOps 的精神
作者以四象限圖連結 SLA、SLO、SLI、監控與 SOP，強調「量測→回饋→改善」是 Dev 與 Ops 共同語言；唯有持續循環，才能真正把 Software 做成 Service，並將技術價值轉化為客戶信任與商業成果。
```