# 電腦時鐘越來越慢...

## 摘要提示
- 手機時鐘誤差: 手機每天慢幾分鐘，兩週累積到快二十分鐘，引發作者對時間問題的警覺。  
- USB 同步對時: 手機透過 USB 與 PC 同步，導致手機時間被 PC 的錯誤時間「污染」。  
- PC 向 DC 對時: 家用 PC 不是直接上網校時，而是向家中伺服器（Domain Controller）取時間。  
- 伺服器時間異常: 追查發現真正慢的是家中 Server，顯示伺服器本身對時機制出問題。  
- Hyper-V 架構: 為簡化重灌，作者把 AD 架在虛擬機 (Guest)，Host 負責 NAT/RRAS/檔案服務。  
- Guest/Host 雙向同步: Hyper-V 預設讓 Guest 跟 Host 同步時間，而 Host 又回頭跟 Guest 對時，形成迴圈。  
- 誤差累積: 每次僅有細微誤差，日積月累造成時間大幅落後。  
- 解決辦法: 關閉 Hyper-V 的「時間同步整合服務」，並讓 DC 直接到外部 NTP 伺服器校時。  
- DEBUG 心得: 看似簡單的「時鐘不準」背後可能牽涉多層架構，要層層驗證才能抓到真因。  
- 經驗分享: 作者藉本文提醒宅男／IT 人，虛擬化與對時機制交互作用易被忽略，值得注意。  

## 全文重點
作者近兩週發現自己的智慧型手機時鐘愈來愈慢，短短十來天就落後了近二十分鐘；奇怪的是，手機白天插在公司電腦 USB 充電時卻又顯得準確。經過初步比對，他察覺並非手機硬體問題，而是家中個人電腦本身時間就有偏差，手機在家充電時被同步到錯誤時間。  
為查清源頭，作者進一步檢視家中網路環境，發現桌機並非直接向網際網路的 NTP 伺服器校時，而是依照網域成員設定，向家中 Domain Controller 取時間；結果顯示真正「落後」的是這台伺服器。  
問題追溯到一個月前的系統重灌。為了簡化重建流程，作者將 Active Directory 裝在 Hyper-V 虛擬機 (Guest OS)，而實體主機 (Host OS) 則負責 NAT、RRAS、檔案服務等功能。Hyper-V 預設啟用「時間同步整合服務」，使 Guest 會不斷向 Host 對時；同時，因 Host 也是網域成員，又會向 AD(即 Guest) 要時間。於是 Guest 與 Host 形成一個時間同步迴圈，任何細微誤差都會在來回傳遞中被放大，最終造成每台設備的系統時鐘大幅落後。  
確定根因後，作者在 Hyper-V 管理介面取消 Guest 的「Time synchronization」整合服務，改讓 Domain Controller 直接對外部 NTP 伺服器校正。調整完成後，手機、PC 與 Server 的時間立即恢復一致，後續觀察亦未再出現飄移現象。  
本文透過一則看似微不足道的手機時間誤差案例，反映虛擬化與網域對時機制間的潛在衝突。作者提醒 IT 工程師：當系統同時身兼 Host 與網域成員，加上預設整合服務時，可能導致「自我迴圈」的同步陷阱；在排除時鐘問題時，需按層次檢視各對時來源，以免誤判。  

## 段落重點
### 問題發現：手機時鐘不準
作者注意到手機每天都會慢幾分鐘，短時間內累積到近二十分鐘；然而在公司充電時又能恢復準確。這反差顯示手機本身並無硬體故障，而是受到同步來源影響。手機透過 USB 與家中 PC 同步時間，若 PC 時鐘本身有誤差，手機自然也會被帶偏，因而引發後續調查動機。  

### 追查：PC 與 Server 的時間落後
檢查後發現家中 PC 不是直接向網際網路 NTP 伺服器校時，而是向家用 Domain Controller 取時間。當 PC 時鐘比對外部世界時顯得落後，代表真正的問題出在伺服器端。作者遂把調查焦點移向 Server，試圖弄清為何長期連網的伺服器竟然未能維持正確時間。  

### 架構細節：Hyper-V 與 AD 虛擬化交互
回顧一個月前的重灌流程，作者為節省帳號重建成本，直接在 Hyper-V 虛擬機中安裝 Windows Server，並昇格為 AD Domain Controller；Host OS 則負責 NAT、RRAS、File Server。Hyper-V 內建的「時間同步整合服務」讓 Guest 持續向 Host 同步時間，而 Host 又因加入網域而反向向 Guest（DC）取時。這種雙向依賴形成自我迴圈，只要單邊產生絲毫誤差，迴圈內就會不斷放大，最終使所有設備時鐘嚴重落後。  

### 解決方案與經驗分享
作者在 Hyper-V 設定中關閉 Guest 的「Time synchronization」功能，終止 Guest 與 Host 的時間迴圈，並改讓 Domain Controller 直接向外部 NTP 伺服器校時。調整後，Server、PC 與手機的時鐘立即回復精準，後續觀察亦未再偏移。事件說明：虛擬化環境下若未審慎規劃對時流程，便可能落入自我同步陷阱。作者藉文提醒 IT 界同好：面對「時鐘不準」這種看似小事，仍需層層驗證同步來源，才能避免被預設機制誤導。