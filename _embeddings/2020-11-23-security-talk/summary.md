# [架構師觀點] 資安沒有捷徑，請從根本做起!

## 摘要提示
- 密碼儲存: 服務端應以 salt + hash 方式保存密碼，避免資料庫外洩時可被還原。  
- 功能 vs 品質: 資安屬於品質要求而非功能需求，必須在設計階段內建。  
- 公開演算法: 採用經過驗證的加解密演算法並妥善管理金鑰，才能真正建立信任。  
- 分散式 Session: 透過 JWT 等標準化機制與每次請求的 token 驗證，兼顧效能與安全。  
- 權限管控: 以 RBAC、PBAC 或 ABAC 等成熟模型集中治理，減少遺漏與矛盾。  
- 團隊文化: 因時程壓力犧牲資安只會換來長期更高成本，亦危及公司信譽。  
- 土炮加密風險: 私有演算法缺乏數學基礎，易被統計或逆向分析破解。  
- 測試極限: 測試只能找缺陷，品質需在設計與開發階段「內建」。  
- 框架優先: 優先使用社群驗證過的安全框架，必要時也應遵循標準模式實作。  
- 沒有捷徑: 資安、品質、架構類問題都需踏實實作，臨時補洞終將付出代價。  

## 全文重點
本文作者從近期社群討論「是否該儲存可還原密碼」談起，指出資安議題不只是技術層面的「功能需求」，更是一種關乎企業存亡的「品質要求」與「信任議題」。首先以「功能需求 vs. 品質要求」區分：功能可用測試案例驗收，但品質需面對未知攻擊與極端情境，若未在架構階段納入，後期往往難以補救。  
密碼安全只是冰山一角；若在帳號設定時即以 salt + hash 方式保存，資料外洩也無法還原密碼，這屬於設計層面的正確決策。作者進一步說明信任來源：使用被廣泛驗證的公開加密演算法與足夠長度的金鑰，再配合嚴謹的金鑰管理，才可數學化保證資料機密性，而土炮加密往往因缺乏理論基礎或程式碼難以保密而不堪一擊。  
在大型或分散式系統裡，登入 Session 與功能授權尤為關鍵。透過 JWT 等標準 token，可在跨服務場景中免去頻繁 RPC 的成本，但前提是每次請求都要驗證簽章與有效期，否則形成安全死角。授權層面則建議使用 RBAC / PBAC / ABAC 或平台內建機制，以集中政策避免「只在 UI 隱藏」或「入口不一致」造成資訊外洩。  
作者強調，資安投資常被視為「吃力不討好」，最易在專案時程壓力下被犧牲，但任何省略都將以信譽或金錢加倍償還。品質是內建而非測試出來，安全機制也無捷徑可走；應遵循成熟框架與業界最佳實務，從根本打好基礎，才能換得長期穩定與使用者信任。  

## 段落重點
### 功能需求 vs 品質要求
作者先定義兩者差異：功能需求可透過正向表列的測試案例驗收，而品質要求屬負向表列，需證明「不會發生未授權行為」且須面對未知變數；品質測試難度高、修改成本大，因此必須在設計階段內建。以密碼儲存為例，只要架構上決定不保存明碼、改用 salt + hash，就能從源頭杜絕外洩風險；若事後才補救，往往需重構資料模式並付出高昂代價。

### 資安，是信任問題，你必須做「對的事」才能換來信任
安全機制的目的在於建立信任，關鍵在於「公開演算法 + 私密金鑰」。公開算法（如 RSA）安全性經過學界與業界長期驗證；只要金鑰長度足夠且保存妥當，數學可保證在可行時間內無法破解。反之，自訂演算法容易被統計分析、逆向工程破解。作者透過統計學破解密碼、程式碼難以保密等案例，提醒不要為了省工自創加密；依照標準做，才能得到可證明的安全性。

### 其他資安案例：登入 Session（認證）
當系統為分散式服務時，如何在 A 服務驗證後讓 B 服務承認使用者身份？業界慣用 JWT 搭配簽章，減少跨服務查詢的通訊負擔；然而每次請求仍需驗證簽章與時效，否則 token 可能被竄改。作者比喻火車票上的防偽設計：列車長不必回播售票系統，只要當場驗票即可，因此每筆 request 應像驗票般執行 token validation，犧牲少量 CPU 換取高效且安全的網路互動。

### 其他案例：功能的權限管控（授權）
授權機制若分散在各功能易遺漏，單一缺口即可洩露所有敏感資料。常見錯誤包含只在 UI 隱藏選單、不一致的多入口檢查等。作者建議：  
1. 先訂定全域且一致的安全規則，避免功能各自為政；  
2. 採用成熟模型（RBAC、PBAC、ABAC 或平台內建 Authorization）集中治理；  
3. 以 API 為主要資料接觸面，結合統一的身份 token 進行授權判斷。  
只要機制一致且實作到位，就能大幅降低「老鼠屎」式漏洞。

### 結論：沒有捷徑，老老實實的實作才是上策
品質與資安皆屬「內建」屬性，測試只能指出缺陷而無法創造品質。為追短期時程而削弱安全，只會在未來以信譽、金錢或可維護性加倍償還。作者勉勵開發者：儘量使用標準化框架與社群驗證模式；若確有必要自訂，也應遵守公認的設計準則與 pattern。唯有一步一腳印地從基礎做好，才能真的把風險降到最低，為產品與企業兌現「可信任」的承諾。