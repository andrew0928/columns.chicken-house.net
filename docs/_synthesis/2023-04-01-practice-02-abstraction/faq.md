---
layout: synthesis
title: "[架構師的修練] #3, 刻意練習 - 如何鍛鍊你的抽象化能力"
synthesis_type: faq
source_post: /2023/04/01/practice-02-abstraction/
redirect_from:
  - /2023/04/01/practice-02-abstraction/faq/
postid: 2023-04-01-practice-02-abstraction
---

# [架構師的修練] #3, 刻意練習 - 如何鍛鍊你的抽象化能力

## 問題與答案 (FAQ)

### Q&A 類別 A: 概念理解類

A-Q1: 什麼是抽象化（Abstraction）？
- A簡: 抽象化是擷取本質、隱藏細節，以穩定介面對應多變實作的能力，是軟體設計的核心思維。
- A詳: 抽象化是將複雜問題中可穩定、不變的本質提取為介面或協定，隱藏實作細節，只暴露必要的契約。其特點是：降低耦合、提升延展性、便於替換與測試。應用場景如折扣引擎的介面、API 規格、模組邊界定義等。透過抽象化，團隊能以固定的「語言」協作，讓實作、優化與替換不影響整體架構。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q2, A-Q5, B-Q2

A-Q2: 為什麼抽象化在軟體開發中重要？
- A簡: 它降低複雜度、分離關注點，確保系統可維護、可擴充，對長期演進至關重要。
- A詳: 抽象化讓架構聚焦於穩定的契約，實作能獨立演進。以折扣系統為例，規則多變，但介面穩定；只要介面定義良好，就能安全替換、增減規則。這對跨系統協作尤其重要：API/Interface 先行，減少溝通成本與實作風險。對應 AI 時代，抽象化能讓你準確描述需求（規格），讓 AI 產生可用的程式碼與測試。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q1, A-Q5, A-Q19, B-Q13

A-Q3: 什麼是刻意練習？為什麼與抽象化有關？
- A簡: 刻意練習是帶目標、回饋、難度漸進的訓練，能有效建立可遷移的抽象思維。
- A詳: 刻意練習強調明確目標、聚焦弱點、反覆回饋、逐步加難。抽象化屬高階認知技能，無法靠單次實作養成。透過設計題（如折扣引擎、生命遊戲），以標準化題幹反覆鍛鍊，逐步加入變因（購物車、優惠券），你能形成穩定的抽象模型與設計套路，提升可遷移的架構能力。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q4, A-Q30, C-Q7

A-Q4: 抽象化能力如何透過刻意練習鍛鍊？
- A簡: 以固定題幹、逐步加難、強化回饋的方式，練設計→實作→驗證→反思循環。
- A詳: 建議流程：選題（折扣引擎）、定規格（介面/輸入輸出）、先寫測試用例、實作最低可行設計、引入新需求（購物車、優惠券、提示）、重構與版本化、回顧與記錄設計決策。輔以 AI 產生 POC、測試案例，縮短試錯時間，把更多精力放在抽象與取捨，逐漸建立個人設計準則。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q3, B-Q8, C-Q7

A-Q5: 什麼是 Interface-First / API-First？
- A簡: 先定義介面或 API 規格作為協作契約，再開發實作與測試，降低風險。
- A詳: Interface-First 與 API-First 的精神是「規格先行」。先以介面或 OpenAPI 定義輸入輸出、錯誤、版本，作為團隊與跨系統的共同語言。之後才能有效由 AI 產生程式碼骨架與測試，讓兩者互相驗證，避免需求漂移。這對多系統協作、快速迭代與自動化尤為關鍵。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q2, B-Q13, C-Q9

A-Q6: 什麼是規格（Spec）？與程式碼有何關係？
- A簡: 規格是對行為的精確描述，程式碼與測試應是規格的可執行呈現。
- A詳: 規格包含範圍、資料模型、流程、邊界條件、錯誤碼與版本策略。良好規格能被機器與人理解，成為實作與測試的共同根據。AI 能從規格衍生骨架碼與測試，建立自我驗證循環，讓你以最小成本檢驗可行性、對齊需求，並支撐長期演進。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q8, B-Q14, C-Q9

A-Q7: 在 AI 時代，黃金圈 WHY/HOW/WHAT 的意義是？
- A簡: WHAT/HOW 逐漸被 AI 強化，自身價值轉向定義 WHY 與規格化 HOW。
- A詳: WHAT（知識）被搜尋與 AI 取代，HOW（技能）被協作式 AI 輔助大幅提速。人類需把重心放在 WHY（目的、策略、取捨），並能把 WHY 轉為可驗證的規格與測試，驅動 AI 生成 HOW/WHAT 的工件。這也是架構與產品價值的核心。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q30, B-Q20, C-Q8

A-Q8: AI 在設計與實作中的角色是什麼？
- A簡: AI 是強力助理，擅長產生實作與測試，需人提供規格、判斷與取捨。
- A詳: AI 能快速做 POC、產生骨架碼、補齊樣板、生成測試與文件。但 AI 不理解商業取捨、上下文利害關係。人應負責規格、優先級、風險與相容性決策。與 AI 的正確分工能成倍提升產出品質與速度。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q9, C-Q8, D-Q6

A-Q9: 人與 AI 在軟體開發中的互補關係是？
- A簡: 技能交給 AI，控制與整合由人把關；經驗靠刻意練習累積。
- A詳: 比喻為電輔車：體力（Skill）由 AI 放大；控制能力（協作、取捨、整合）由人；經驗透過刻意練習積累。面對設計題，人需能判斷與引導 AI，辨識答案優劣、提出修正，形成互補的高效組合。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q3, A-Q7, C-Q8

A-Q10: 什麼是 POC（Proof of Concept）？
- A簡: 以最小成本驗證概念可行性的實驗，降低決策與投入風險。
- A詳: POC 強調縮小範圍、快速成形與可驗證。例：以最小介面實作折扣計算，確認規則可插拔、結果可追蹤，再擴展到購物車與優惠券。AI 能加速 POC，讓你把更多精力放在抽象與決策。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q9, C-Q1, C-Q2

A-Q11: 折扣計算案例的核心需求是什麼？
- A簡: 規則可擴充、輸出折扣清單與提示，並可套用到完整購物車。
- A詳: 核心包含三點：可擴充未知規則（插拔式設計）、結果含 AppliedDiscounts（可追蹤）與 DiscountHints（引導達成條件）、支援購物車多品項計算。這些需求驅動介面模型、資料結構與流程設計。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q1, B-Q6, C-Q5

A-Q12: CalculationResult 應承載哪些資訊？
- A簡: 最終金額、已套用折扣清單、折扣提示，必要時含中間計算跡證。
- A詳: 建議包含 FinalPrice、AppliedDiscounts（名稱、金額、來源規則）、DiscountHints（未滿足條件）。可額外提供計算步驟、原始輸入摘要與版本資訊，提升可觀測性與可除錯性，支援審計與客服。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q3, B-Q16, C-Q5

A-Q13: 什麼是折扣提示（Discount Hints）？為何需要？
- A簡: 提示是未達成規則的接近條件，能引導使用者完成促銷目標。
- A詳: 折扣提示並非錯誤，而是差距資訊，如「再買一件可享滿額折扣」。它提升體驗與轉換率，也為行銷提供可觀測資料。實作上需在規則判斷中保留未滿足原因與缺口值，作為提示輸出。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q6, C-Q5, D-Q8

A-Q14: 為何要以購物車為輸入而非單一商品？
- A簡: 多數商業規則跨品項、跨總額，購物車能涵蓋整體情境。
- A詳: 單品計算無法支援滿額、滿件、混搭等複合規則，也不利處理全單折抵、運費門檻。改用購物車模型（CartItem/Product 清單）可擴展性更佳，與實務邏輯一致，減少後續重構成本。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q10, C-Q3, D-Q3

A-Q15: 何謂可擴充未知規則的設計？
- A簡: 以介面與策略模式封裝規則，透過 DI 或登錄機制外掛新規則。
- A詳: 將規則抽象為介面（如 IRetailDiscountCalculator），實作各規則類別，於執行期組合。搭配設定或描述檔控制順序與適用性，無須修改核心流程即可擴充，符合開放封閉原則。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q5, A-Q28, C-Q6

A-Q16: 輸入與輸出在介面中如何清晰表達？
- A簡: 使用明確參數與回傳物件，避免混淆；必要時用 out 或 Tuple。
- A詳: 將輸入（購物車、優惠券、上下文）與輸出（結果物件）分離。若需多輸出，傾向返回聚合結果類型（如 CalculationResult），兼顧可讀性與擴充性。避免以輸入參數承載輸出（如 ref 參數），以免語意混亂。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q12, C-Q4, D-Q1

A-Q17: Interface 與 API 有何差異與關聯？
- A簡: Interface 是進程內契約，API 多指跨進程/網路契約；兩者皆是規格。
- A詳: Interface 多用於語言層面的類型契約；API（特別是 HTTP API）是系統間協議。兩者皆強調輸入輸出、錯誤與版本。Interface First 支撐模組內設計；API First 支撐跨系統協作。理念一致、範圍不同。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q5, B-Q13, C-Q9

A-Q18: .NET 從 Framework 到 Core 的開放有何意義？
- A簡: 跨平台、擁抱開源與效能提升，促成更開放的生態與協作方式。
- A詳: 微軟轉向開源與跨平台，使 .NET 能在 Linux 運行、效能躍進，並帶來更豐富的工具鏈（容器、雲原生）。對架構師而言，抽象與規格重要性更高：跨平台與多語言協作需要穩定 API/Interface 作為橋樑。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q5, B-Q13

A-Q19: 為何以 API 為溝通協作的優先語言？
- A簡: API 規格可機器與人類共讀，利於自動化、測試與跨團隊對齊。
- A詳: API 規格（如 OpenAPI）可生成文件、SDK、測試、模擬服務，成為協作的單一真相來源。先定 API，可平行開發、降低誤解，並以契約測試管理變更，支撐長期演進與整合。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q13, B-Q15, C-Q9

A-Q20: 為何好的設計常難以推動？
- A簡: 成本、認知與路徑依賴阻力大；AI 可降低驗證與導入門檻。
- A詳: 抽象與規格需要前期投入，短期難見成效；既有路徑與習慣增加阻力。利用 AI 快速做 POC、測試與文件，能更快展示價值，降低推動難度。以小步快跑與可觀測性建立信任。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q10, B-Q14, C-Q1

A-Q21: AI 會取代哪些工作？不會取代什麼？
- A簡: 重複性技能性工作易被取代；理解 WHY、做決策與規格化能力不易被取代。
- A詳: 模板化程式碼、樣板文件、常規測試生成等將高度自動化。但問題定義、商業取捨、風險控管、規格制定、跨系統協作仍需人主導。會取代你的不是 AI，而是更會用 AI 的人。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q7, A-Q8, C-Q8

A-Q22: 為何「問對問題」那麼關鍵（Prompting）？
- A簡: 問題界定決定 AI 產出邊界與品質，是設計與規格化的前置工序。
- A詳: 精準的問題包含目標、約束、輸入輸出、例外情境與評估標準。這實為縮小搜尋空間、強化語意對齊的過程。良好 Prompt 能引導 AI 產生符合規格的實作與測試，反覆精煉達到你的心智模型。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q9, C-Q8, D-Q6

A-Q23: 如何判斷 AI 產出的設計好壞？
- A簡: 對照規格、檢查語意正確、可擴充性、可測試性與可觀測性。
- A詳: 建立評估清單：是否滿足需求（必備與可選）、介面語意清晰、輸入輸出分離、結果可追蹤、規則可插拔、錯誤處理完備、便於測試與監控。以契約測試與 POC 驗證，必要時要求 AI 迭代修正。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q14, C-Q7, D-Q1

A-Q24: 文中「控制能力」比喻代表什麼？
- A簡: 代表人對系統協作、取捨、整合與監控的主導能力。
- A詳: 即便 AI 放大技能輸出，系統級決策仍需人掌舵。控制能力包含需求權衡、跨系統協調、監控指標設計、風險管理與版本治理。這些能力透過實戰與刻意練習累積，是個人價值關鍵。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q9, B-Q15, D-Q7

A-Q25: 經驗如何累積？為何需要刻意練習？
- A簡: 有目標與回饋的重複實作才轉為可遷移的直覺與判斷。
- A詳: 零散經驗不會自動沉澱。刻意練習將案例標準化、拆分技能、設訂標準、記錄得失，才能將知識內化為判斷力。AI 能當教練與助手，但你需要主動設計練習路徑。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q3, A-Q4, C-Q7

A-Q26: 規格先行如何加速測試與驗證？
- A簡: 規格驅動自動生成測試與骨架，形成自我驗證迴路。
- A詳: 由 Spec 衍生 Use Case 與測試，AI 產生測試碼與實作骨架，兩者互證。你審核測試是否反映規格，將評審重心放在語意與邊界，而非逐行碼審，顯著加快驗證。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q8, B-Q14, C-Q7

A-Q27: 抽象化、封裝與模組化有何差異？
- A簡: 抽象化擷取本質；封裝隱藏實作；模組化劃分邊界，各有側重。
- A詳: 抽象化定義契約；封裝確保替換不影響外界；模組化以邊界管理複雜度與團隊分工。三者相輔相成，共同提升可維護性與擴充性。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q1, A-Q5, B-Q13

A-Q28: 什麼是開放封閉原則（OCP）？案例如何運用？
- A簡: 對擴充開放、對修改封閉；以外掛規則擴充折扣而不改核心流程。
- A詳: 核心引擎穩定，新增規則透過新類別註冊即可。順序與適用性由設定決定，不動核心碼。這降低風險並支援快速試驗行銷活動。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q15, B-Q5, C-Q6

A-Q29: 為何要保留折扣應用的可追蹤性？
- A簡: 便於除錯、客服與審計，支援數據分析與體驗優化。
- A詳: AppliedDiscounts 提供每步折扣來源與金額，支援還原計算路徑、解釋帳單、分析規則成效。也利於 A/B 測試與風控。缺失追蹤會讓問題診斷與對外說明困難。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q16, C-Q5, D-Q1

A-Q30: 在 AI 時代，工程師的核心價值是什麼？
- A簡: 問對問題、定規格、做取捨、整合與驗證，驅動 AI 發揮最大化。
- A詳: 將 WHY 轉為規格化的 HOW，並以 API/Interface 統一協作語言；以測試與可觀測性驗證；用版本策略管理演進；在跨系統與商業限制下做正確取捨。這些是不可替代的價值。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q7, A-Q19, B-Q15


### Q&A 類別 B: 技術原理類

B-Q1: 折扣計算引擎如何運作？
- A簡: 以購物車為輸入，串接多個規則計算，輸出含跡證與提示的結果。
- A詳: 引擎接收 CartItems/Context，依序或策略選擇規則執行。每則規則回報是否適用、折抵金額與提示。引擎彙總為 CalculationResult（FinalPrice、AppliedDiscounts、DiscountHints），並記錄版本與計算步驟，形成可觀測管線。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q11, B-Q4, C-Q3

B-Q2: IRetailDiscountCalculator 的機制是什麼？
- A簡: 以單一方法定義輸入輸出契約，將規則與流程解耦，支援外掛。
- A詳: 介面如 CalculateDiscount(input)→CalculationResult。規則各自實作，注入核心引擎。流程控制（順序、互斥、疊加）由引擎掌握，規則僅關注適用條件與效果，提升替換與測試性。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q1, A-Q15, C-Q1

B-Q3: CalculationResult 的資料流與組件？
- A簡: 彙整最終金額、折扣清單、提示與可觀測資料，作為唯一輸出。
- A詳: 結構包含 FinalPrice、AppliedDiscounts（Name、Amount、RuleId）、DiscountHints（Type、Message、Delta）與 Metadata（Version、TraceId）。規則回報部分結果，由引擎合併為單一輸出，避免狀態外洩與語意混亂。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q12, A-Q29, C-Q5

B-Q4: 規則套用流程如何設計（順序與組合）？
- A簡: 以策略或管線模式管理順序、互斥與累計，確保結果可預期。
- A詳: 常見模式：固定順序（如先滿額再券）、可配置權重、互斥群組、只取最大利益。需定義組合規則與衝突解決策略，並以配置與測試確保一致性。引擎負責流程，規則只負責判斷與計算。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q5, D-Q2, C-Q10

B-Q5: 可插拔規則架構如何設計（DI/策略模式）？
- A簡: 規則實作共同介面，透過 DI 容器註冊與解析，執行期組合。
- A詳: 使用介面+策略模式，規則類別各自關注條件與計算。DI 容器註冊多個實例，根據設定/標籤決定套用。可熱插拔或透過設定切換，支援 A/B 測試與灰度發布。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q15, C-Q6, D-Q2

B-Q6: 折扣提示（Hints）如何生成？
- A簡: 規則在未達條件時回報缺口資訊，引擎彙整為提示集合。
- A詳: 規則同時實作 TryApply 與 Explain 方法：若不適用，回傳「缺多少件/差多少額」等結構化資料。引擎在結果中輸出人類可讀訊息，並可供前端行銷引導。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q13, C-Q5, D-Q8

B-Q7: 從需求到介面的抽象流程是什麼？
- A簡: 萃取不變因素→定義輸入輸出→分離流程與規則→明確錯誤與版本。
- A詳: 先盤點需求：可擴充、可追蹤、可提示。將不變因素固化為介面與資料模型；把可變因素（規則）外掛化。定義錯誤與版本策略，確保未來演進安全。建立最小可行 POC 驗證。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q11, A-Q16, C-Q1

B-Q8: 介面到測試案例如何生成？
- A簡: 由規格衍生 Use Case 表格，AI 生成單元與契約測試覆蓋。
- A詳: 從介面定義與規則表，推導正常/邊界/互斥情境。AI 產生測試骨架與資料工廠，快速覆蓋。以契約測試固定外部行為，支撐實作重構與版本演進。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q6, A-Q26, C-Q7

B-Q9: 使用 AI 做 POC 的工作流？
- A簡: 明確需求→撰寫 Prompt→產生骨架→跑測試→迭代修正。
- A詳: 將需求轉為分步 Prompt（介面、範例、測試、重構），逐步逼近目標。每輪以測試與規格比對，要求 AI 說明差異並修正。保留對話紀錄與決策，方便知識移轉與審核。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q10, A-Q22, C-Q8

B-Q10: 單品到購物車的介面演化機制？
- A簡: 擴大輸入範型（decimal→List<CartItem>），調整語意與資料結構。
- A詳: 將計算單位由單值改為集合，重構規則以支援分攤、聚合與跨品項條件。保持回傳物件一致，避免破壞相容性。必要時引入版本欄位標示變更。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q14, C-Q3, D-Q3

B-Q11: 加入優惠券參數的設計考量？
- A簡: 明確券類型、適用範圍與衝突規則，簽章語意需清晰。
- A詳: 在輸入加入 Coupon（Id、Type、Scope、Quota、ValidPeriod）。定義與一般規則的相對順序與互斥關係。簽章應保持單一語意，避免混入輸出或隱式狀態。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q16, C-Q4, D-Q4

B-Q12: 輸入輸出建模選項（回傳物件 vs out vs Tuple）？
- A簡: 優先回傳聚合結果物件，語意清楚且易擴充；out/Tuple 用於特例。
- A詳: 回傳結果類別最具可讀性與延展性，便於新增欄位與文件化。out 適合效能敏感或多回傳小資料；Tuple 適合暫時性、內部用途。避免讓輸入參數承載輸出以免混淆。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q16, C-Q5, D-Q1

B-Q13: API First 與 Interface First 的技術架構？
- A簡: 以規格為中心，生成文件、SDK、測試與骨架，形成契約驅動開發。
- A詳: API First 用 OpenAPI/AsyncAPI 驅動外部協作；Interface First 用語言介面驅動內部設計。規格是單一真相來源，可生成 Mock、測試與程式碼。兩者共同支撐自動化與演進治理。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q5, A-Q19, C-Q9

B-Q14: 規格自我驗證流程（Code/Test 互證）？
- A簡: 規格→AI 產生測試與骨架→雙向驗證→報告差異→迭代修正。
- A詳: 以規格衍生測試用例，再用同規格產生程式骨架。兩者互相執行，若不一致即回饋到規格或實作修正。持續整合中自動跑契約與回歸測試，維持一致性。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q26, C-Q7, D-Q6

B-Q15: 跨系統協作的 API 設計原理？
- A簡: 穩定資源模型、清晰錯誤、版本相容、冪等與安全考量。
- A詳: 定義資源與操作、使用標準錯誤碼、規劃版本策略（URI/標頭/擴展欄位）、設計冪等鍵避免重複扣款、考量身份與授權。透過契約測試與監控確保一致行為。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q19, D-Q9, C-Q9

B-Q16: 可觀測性設計（記錄與追蹤）如何實作？
- A簡: 產出可關聯的 TraceId、規則應用清單與關鍵量測，支援診斷。
- A詳: 在結果中加入 TraceId、版本、規則應用順序與金額；記錄耗時指標、命中率、錯誤。串接分散式追蹤與集中化日誌，形成端到端可觀測能力。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q29, D-Q8, C-Q7

B-Q17: 效能最佳化機制有哪些？
- A簡: 批次計算、快取靜態規則、短路判斷、資料結構優化。
- A詳: 對不依賴購物車狀態的規則做快取；按成本排序規則、先執行可短路的規則；使用集合運算減少重複掃描；避免不必要物件分配。以量測數據驅動優化。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: D-Q5, C-Q10, B-Q16

B-Q18: 安全與一致性如何確保（券校驗/防重）？
- A簡: 券狀態校驗、冪等、簽名與時效、重放防護與審計追蹤。
- A詳: 驗證券有效期、使用次數、綁定對象；使用冪等鍵避免重複扣款；簽名/時間戳防篡改；所有操作記錄審計軌跡，確保可追溯。錯誤回應需清楚且不洩漏敏感情報。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: D-Q9, B-Q15, C-Q4

B-Q19: 介面版本演進與相容策略？
- A簡: 新增不破壞欄位、功能旗標、雙軌版本、明確棄用期。
- A詳: 以向後相容為優先：只能新增欄位、保留舊行為；導入功能旗標控制新規則；提供雙軌 API/介面；發布棄用公告與期限。以契約測試守護相容性。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: D-Q7, A-Q19, C-Q9

B-Q20: 用黃金圈驅動設計決策的機制？
- A簡: 以 WHY 定義價值與限制，再具體化為 HOW/WHAT 的規格與實作。
- A詳: 先釐清目標（可擴充、可追蹤、可提示），再推導設計原則（介面語意、流程分離、可觀測），最後化為具體介面、資料模型與流程。以測試驗證 WHY 是否落實。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q7, A-Q30, C-Q7


### Q&A 類別 C: 實作應用類（10題）

C-Q1: 如何實作 IRetailDiscountCalculator 與 CalculationResult？
- A簡: 定義單一方法與結果物件，回傳最終金額、折扣清單與提示集合。
- A詳: 
  - 實作步驟：
    1) 定義介面 Calculate(cart)→CalculationResult
    2) 建立 CalculationResult { FinalPrice, AppliedDiscounts, DiscountHints }
    3) 編寫基礎規則與引擎
  - 程式碼：
    ```
    public interface IDiscountCalculator {
      CalculationResult Calculate(IReadOnlyList<CartItem> cart);
    }
    public record CalculationResult(decimal FinalPrice,
      IReadOnlyList<Discount> Applied, IReadOnlyList<string> Hints);
    ```
  - 注意：明確輸入輸出、避免共享狀態、結果不可變更；優先小步前進。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q11, B-Q2, B-Q3

C-Q2: 如何擴充兩種折扣規則並套用？
- A簡: 各自實作介面，透過清單注入引擎依序執行並合併結果。
- A詳: 
  - 步驟：實作 SeniorRule、CouponRule；引擎迭代規則，累計折扣。
  - 程式碼：
    ```
    public interface IRule { RuleResult Apply(State s); }
    var rules = new List<IRule>{ new SeniorRule(), new CouponRule("ABC") };
    foreach (var r in rules) state = r.Apply(state);
    ```
  - 注意：定義互斥/疊加策略；記錄應用順序與金額；撰寫單元測試覆蓋。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: B-Q4, B-Q5, D-Q2

C-Q3: 如何將介面改為支援購物車？
- A簡: 將輸入改為 CartItem 清單，規則支援聚合與分攤邏輯。
- A詳: 
  - 步驟：decimal→IReadOnlyList<CartItem>；重構規則以處理滿額/滿件。
  - 程式碼：
    ```
    public record CartItem(string Sku, int Qty, decimal Price);
    public CalculationResult Calculate(IReadOnlyList<CartItem> cart) { ... }
    ```
  - 注意：避免浮點誤差；定義分攤規則；更新測試用例與文件。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q14, B-Q10, D-Q3

C-Q4: 如何在介面中加入優惠券並保持語意清晰？
- A簡: 將 Coupon 作為獨立輸入參數或 Context，一律只承載輸入資訊。
- A詳: 
  - 步驟：新增 Coupon 型別與簽章 overload；不混入輸出或狀態。
  - 程式碼：
    ```
    public record Coupon(string Code, string Type, DateTime Expiry);
    CalculationResult Calculate(IReadOnlyList<CartItem> cart, Coupon? coupon);
    ```
  - 注意：定義券與規則順序關係；校驗有效性；避免在參數中回填結果。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q11, B-Q12, D-Q4

C-Q5: 如何設計 CalculationResult 含 AppliedDiscounts 與 DiscountHints？
- A簡: 以結構化清單承載折扣與提示，利於追蹤、呈現與分析。
- A詳: 
  - 步驟：定義 Discount 與 Hint 型別；在引擎彙整輸出。
  - 程式碼：
    ```
    public record Discount(string Name, decimal Amount, string RuleId);
    public record Hint(string Message, string RuleId, decimal? Delta);
    public record CalculationResult(decimal FinalPrice,
      IReadOnlyList<Discount> Applied, IReadOnlyList<Hint> Hints);
    ```
  - 注意：統一幣值與四捨五入規則；附帶 RuleId 便於診斷。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q12, B-Q3, B-Q16

C-Q6: 如何以 DI 容器註冊與抽換規則？
- A簡: 規則以多重註冊方式加入容器，運行時解析順序並執行。
- A詳: 
  - 步驟：於容器註冊 IRule 的多個實作；引擎注入 IEnumerable<IRule>。
  - 程式碼：
    ```
    services.AddTransient<IRule, SeniorRule>();
    services.AddTransient<IRule, CouponRule>();
    public Engine(IEnumerable<IRule> rules) { _rules = rules; }
    ```
  - 注意：可用標籤/順序屬性；環境切換與 A/B 測試；避免單例狀態污染。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q5, D-Q2, B-Q19

C-Q7: 如何用單元測試驗證折扣引擎？
- A簡: 以用例驅動測試正常與邊界情境，覆蓋順序、互斥與提示。
- A詳: 
  - 步驟：從規格生成用例；撰寫 Arrange/Act/Assert；引入契約測試。
  - 程式碼：
    ```
    [Fact] public void Apply_Senior_Then_Coupon() {
      var cart = new[]{ new CartItem("A",1,100m) };
      var r = engine.Calculate(cart, new Coupon("ABC","10%",dt));
      r.FinalPrice.ShouldBe(72m);
      r.Applied.Count.ShouldBe(2);
    }
    ```
  - 注意：固定四捨五入；檢查 Applied 與 Hints；基準資料自動化。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q8, B-Q14, D-Q8

C-Q8: 如何撰寫 Prompt 引導 AI 產生正確介面與範例？
- A簡: 指定需求、輸入輸出、限制與評估標準，要求差異說明與迭代。
- A詳: 
  - 步驟：分段提示（介面→購物車→優惠券→結果追蹤）；提供反例與期望。
  - 範例：
    ```
    定義可擴充折扣介面，輸出含 Applied/Hints；
    將輸入改為購物車；加入 Coupon 參數；
    回傳物件承載輸出，不使用 ref/out。
    ```
  - 注意：要求 AI 解釋設計差異；附上測試期望；逐步收斂。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q22, B-Q9, D-Q6

C-Q9: 如何以 API First 撰寫 OpenAPI 並生成骨架？
- A簡: 先寫 OpenAPI 描述資源與模型，用工具生成伺服器/客戶端骨架。
- A詳: 
  - 步驟：定義 /discounts/calculate、CartItem、CalculationResult；
  - 片段：
    ```
    paths:
      /discounts/calc:
        post:
          requestBody: { CartRequest }
          responses: { 200: { CalculationResult } }
    ```
  - 使用工具（如 NSwag/Swashbuckle）產生 SDK/Stub；以契約測試驗證。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: A-Q5, B-Q13, D-Q9

C-Q10: 如何優化規則套用順序並避免重複折扣？
- A簡: 建立優先級與互斥群組，加入短路與最大利益策略。
- A詳: 
  - 步驟：規則設定 Priority、Group、Exclusive；引擎按優先級執行；
  - 程式碼：
    ```
    if (group.Exclusive) applyBestOnly();
    if (canShortCircuit) break;
    ```
  - 注意：以測試覆蓋互斥與最大利益；紀錄決策理由供審核。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q4, B-Q17, D-Q2


### Q&A 類別 D: 問題解決類（10題）

D-Q1: 遇到介面只回傳金額，無法追蹤折扣怎麼辦？
- A簡: 調整回傳為聚合結果物件，加入折扣清單與提示，補上可觀測欄位。
- A詳: 
  - 症狀：只能看到 FinalPrice，無法還原計算路徑。
  - 可能原因：過度簡化介面、忽略追蹤需求。
  - 解決：改回傳 CalculationResult（Applied/Hints/TraceId）；重寫規則回報資料；更新測試。
  - 預防：在規格中強制追蹤欄位；以契約測試守護。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q12, B-Q3, B-Q16

D-Q2: 折扣規則互相衝突造成重複折抵怎麼解？
- A簡: 引入互斥群組與最大利益策略，設計權重與短路機制。
- A詳: 
  - 症狀：同時套用多個規則導致過度折扣。
  - 原因：缺乏衝突與順序策略。
  - 解決：定義 Priority/Group/Exclusive；引擎選最大利益；短路不再套用。
  - 預防：測試覆蓋互斥與順序；配置化管理策略。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q4, C-Q10, B-Q5

D-Q3: 單品改購物車後結果錯誤如何診斷？
- A簡: 檢查資料模型、聚合與分攤邏輯，加入步驟級追蹤與測試。
- A詳: 
  - 症狀：轉為購物車後金額不符預期。
  - 原因：分攤/聚合錯誤、四捨五入不一致。
  - 解決：明確分攤規則；統一幣值處理；逐步追蹤規則輸出。
  - 預防：建立多品項用例；引入金額容忍度與貨幣工具。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q10, C-Q3, B-Q16

D-Q4: 優惠券語意含糊導致錯誤套用怎麼辦？
- A簡: 明確定義券類型與適用範圍，強化校驗與互斥策略。
- A詳: 
  - 症狀：不該適用之券被套用。
  - 原因：簽章與模型語意不清、校驗不足。
  - 解決：擴充 Coupon 模型；加入校驗與順序策略；錯誤碼清楚。
  - 預防：規格示例化；契約測試涵蓋異常情境。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q11, C-Q4, B-Q15

D-Q5: 規則過多造成效能不佳的原因與對策？
- A簡: 規則無差別執行、無快取與短路；需量測後排序與剪枝。
- A詳: 
  - 症狀：計算延遲上升。
  - 原因：規則成本高、順序不當、重複計算。
  - 解決：量測耗時；按命中率與成本排序；快取靜態結果；短路不必要計算。
  - 預防：在引擎加入效能計量；定期重排策略。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q17, C-Q10, B-Q16

D-Q6: AI 產生的程式碼編譯過但不合規格怎麼辦？
- A簡: 以規格與測試為準繩，要求 AI 解釋差異並迭代修正。
- A詳: 
  - 症狀：行為偏離需求但無編譯錯誤。
  - 原因：Prompt 不完整、語意誤解。
  - 解決：補充限制與例外案例；加入契約測試；要求差異說明與修正。
  - 預防：先寫規格與測試；迭代式 Prompt 設計。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q22, B-Q14, C-Q8

D-Q7: 規格變更造成版本不相容如何處理？
- A簡: 採向後相容策略、雙軌版本與棄用期，並提供遷移指南。
- A詳: 
  - 症狀：新舊客戶端出錯。
  - 原因：破壞式變更未管理。
  - 解決：維持舊介面；提供 v2；映射層；明確棄用時間。
  - 預防：版本政策與審核流程；契約測試守護相容。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q19, B-Q15, C-Q9

D-Q8: 折扣提示與實際折扣不一致怎麼排查？
- A簡: 比對規則輸入、命中條件與輸出，檢查提示生成邏輯。
- A詳: 
  - 症狀：顯示提示與實際結果矛盾。
  - 原因：提示邏輯與規則演算法脫鉤、四捨五入差異。
  - 解決：統一使用同一套判斷；將提示來源與規則綁定。
  - 預防：測試覆蓋提示與結果一致性；監控異常比率。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q6, B-Q16, C-Q7

D-Q9: 跨系統 API 呼叫錯誤（400/422）如何診斷？
- A簡: 檢查契約、驗證錯誤碼與回應體，對照 OpenAPI 與契約測試。
- A詳: 
  - 症狀：請求被拒（參數錯、驗證失敗）。
  - 原因：契約不一致、序列化差異、版本錯誤。
  - 解決：比對 OpenAPI；重放請求；檢查必填欄位與格式；更新 SDK。
  - 預防：契約測試與自動生成 SDK；版本治理。
- 難度: 中級
- 學習階段: 核心
- 關聯概念: B-Q15, C-Q9, B-Q19

D-Q10: 資料品質差導致 AI 回答偏差如何預防？
- A簡: 提供乾淨輸入與清楚上下文，對答案設檢核與測試回路。
- A詳: 
  - 症狀：AI 產出不穩定或誤解。
  - 原因：Prompt 模糊、上下文不足、例外未涵蓋。
  - 解決：補充範例、反例與邊界；分段提問；加上評估標準。
  - 預防：建立 Prompt 模板庫；用測試與 POC 驗證後再採納。
- 難度: 初級
- 學習階段: 基礎
- 關聯概念: A-Q22, B-Q9, C-Q8


### 學習路徑索引

- 初學者：建議先學習哪 15 題
    - A-Q1: 什麼是抽象化（Abstraction）？
    - A-Q2: 為什麼抽象化在軟體開發中重要？
    - A-Q3: 什麼是刻意練習？為什麼與抽象化有關？
    - A-Q5: 什麼是 Interface-First / API-First？
    - A-Q6: 什麼是規格（Spec）？與程式碼有何關係？
    - A-Q7: 在 AI 時代，黃金圈 WHY/HOW/WHAT 的意義是？
    - A-Q8: AI 在設計與實作中的角色是什麼？
    - A-Q10: 什麼是 POC（Proof of Concept）？
    - A-Q11: 折扣計算案例的核心需求是什麼？
    - A-Q14: 為何要以購物車為輸入而非單一商品？
    - B-Q1: 折扣計算引擎如何運作？
    - B-Q2: IRetailDiscountCalculator 的機制是什麼？
    - C-Q1: 如何實作 IRetailDiscountCalculator 與 CalculationResult？
    - C-Q2: 如何擴充兩種折扣規則並套用？
    - D-Q1: 遇到介面只回傳金額，無法追蹤折扣怎麼辦？

- 中級者：建議學習哪 20 題
    - A-Q12: CalculationResult 應承載哪些資訊？
    - A-Q13: 什麼是折扣提示（Discount Hints）？為何需要？
    - A-Q15: 何謂可擴充未知規則的設計？
    - A-Q16: 輸入與輸出在介面中如何清晰表達？
    - A-Q19: 為何以 API 為溝通協作的優先語言？
    - A-Q28: 什麼是開放封閉原則（OCP）？案例如何運用？
    - A-Q29: 為何要保留折扣應用的可追蹤性？
    - B-Q3: CalculationResult 的資料流與組件？
    - B-Q4: 規則套用流程如何設計（順序與組合）？
    - B-Q5: 可插拔規則架構如何設計（DI/策略模式）？
    - B-Q6: 折扣提示（Hints）如何生成？
    - B-Q8: 介面到測試案例如何生成？
    - B-Q10: 單品到購物車的介面演化機制？
    - B-Q11: 加入優惠券參數的設計考量？
    - B-Q12: 輸入輸出建模選項（回傳物件 vs out vs Tuple）？
    - B-Q13: API First 與 Interface First 的技術架構？
    - B-Q14: 規格自我驗證流程（Code/Test 互證）？
    - C-Q3: 如何將介面改為支援購物車？
    - C-Q5: 如何設計 CalculationResult 含 AppliedDiscounts 與 DiscountHints？
    - C-Q7: 如何用單元測試驗證折扣引擎？

- 高級者：建議關注哪 15 題
    - A-Q20: 為何好的設計常難以推動？
    - A-Q30: 在 AI 時代，工程師的核心價值是什麼？
    - B-Q15: 跨系統協作的 API 設計原理？
    - B-Q16: 可觀測性設計（記錄與追蹤）如何實作？
    - B-Q17: 效能最佳化機制有哪些？
    - B-Q18: 安全與一致性如何確保（券校驗/防重）？
    - B-Q19: 介面版本演進與相容策略？
    - B-Q20: 用黃金圈驅動設計決策的機制？
    - C-Q4: 如何在介面中加入優惠券並保持語意清晰？
    - C-Q6: 如何以 DI 容器註冊與抽換規則？
    - C-Q9: 如何以 API First 撰寫 OpenAPI 並生成骨架？
    - C-Q10: 如何優化規則套用順序並避免重複折扣？
    - D-Q2: 折扣規則互相衝突造成重複折抵怎麼解？
    - D-Q5: 規則過多造成效能不佳的原因與對策？
    - D-Q7: 規格變更造成版本不相容如何處理？
