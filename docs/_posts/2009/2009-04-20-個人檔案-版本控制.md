---
layout: post
title: "個人檔案 + 版本控制..."
categories:

tags: ["Tips","技術隨筆","有的沒的"]
published: true
comments: true
permalink: "/2009/04/20/個人檔案-版本控制/"
redirect_from:
  - /columns/post/2009/04/20/e5808be4babae6aa94e6a188-2b-e78988e69cace68ea7e588b6.aspx/
  - /post/2009/04/20/e5808be4babae6aa94e6a188-2b-e78988e69cace68ea7e588b6.aspx/
  - /post/e5808be4babae6aa94e6a188-2b-e78988e69cace68ea7e588b6.aspx/
  - /columns/2009/04/20/e5808be4babae6aa94e6a188-2b-e78988e69cace68ea7e588b6.aspx/
  - /columns/e5808be4babae6aa94e6a188-2b-e78988e69cace68ea7e588b6.aspx/
wordpress_postid: 40
---

自從過年時換了 SERVER 的作業系統，加上過年前 NOTEBOOK 掛掉換 [X40 + SSD](http://columns.chicken-house.net/post/ThinkPadX40-SSD.aspx) 之後，這幾個月都陷在東換換西調調的狀態中 @_@, 好在換了 2008 之後，有 Hyper-V 的幫忙，問題簡化不少...。不過今天要講的倒是很不起眼的小東西: [SVN (Subversion)](http://subversion.tigris.org/)。

SVN 這種[版本控制系統](http://en.wikipedia.org/wiki/Revision_control)，通常是用來作程式碼的版本管理。也對啦，除了軟體開發之外，其它場合好像也不大需要這麼複雜的版本機制。不過這類系統弄多了，平常在非軟體開發的場合，也發現其實很多時後都有檔案版本問題要處理。像是平常的文件 (WORD)，簡報 (PPT) 等等，都會作好一份通用的，碰到 A 客戶就改一改拿來用，B 客戶再改一改... 這不就是 brench / merge 之類的問題嘛? 所以我一直在找這樣的 solution，看看有沒有適合一般使用的。不過到現在，也換了好幾種作法，歷年來試過的作法有好幾種:

1. [VSS](http://msdn.microsoft.com/en-us/aa740435.aspx) (Microsoft Visual SourceSafe 5.0)

   這個有用過的人，看版本號碼就知道有多古老了… 不過真正在用是 6.0 版開始。因為工作上會用的到，就順便拿來用了。它的好處是很簡單，搞懂它的邏輯就很容易上手。架設也簡單，完全是 File Based, 不需要架設專用的 Server。不過這也是後來換掉它的原因之一。

   它的使用方式，是以嚴格的控制為主要邏輯。什麼意思? 意思是你不能隨意更改檔案，要開使改檔案之前，要先 check-out 才能開始改。這樣的邏輯就是要避免未來一連串的版本衝突 (conflict) 及合併 (merge) 帶來的問題。 以軟體開發的角度來看，這樣的作法還不錯，整個團隊的開發是值得這樣作的。不過拿來管理個人檔案的話，就太過頭了。個人檔案不大會發生 LOCK 的問題，就是我改你也改，最後存檔總會有一個人的資料被蓋掉... 不過，如果我是大老闆，有十幾個秘書在幫我打雜的話就難說了 [H]

2. [VSS (Windows Volume Shadow Copy Service)](http://columns.chicken-house.net/post/Volume-Shadow-Copy-Service-.aspx)

   Visual Source Safe 用了之後，發現障礙多於它帶來的優點 (以處理一般文件而言)。主要的缺點是，VSS 透過網路 / Internet / VPN 使用的速度實在是龜到可以，雖然後來 Microsoft 推出了 LAN Boost Service (還是很慢)，也另外推出了 HTTP / Web Service 的存取方式 (只能透過 Visual Studio) 速度也不快。另一個缺點是一定要先開 VSS Explorer / Visual Studio, 我不過只是想開個 WORD 檔啊...

   所以後來換了另一個角度找 solution, 就試用了 windows 2003 內建的 VSS (Volume Shadow Copy Service), 替代版本控制用的軟體。它是做在 File System 層次上的機制，用了 [Copy On Write](http://en.wikipedia.org/wiki/Copy_on_write) (COW.. 這是縮寫，不是在罵人...) 的方式，做版本的差異控制。因此只要把檔案放在開啟 VSS 的磁碟機，完全不用更改任何使用習慣..。

   但是太自動的東西還是不適用。這種作法主要的問題在於版本太不精確了。VSS 仰賴定期作快照 ([snapshot](http://en.wikipedia.org/wiki/Snapshot_algorithm)) 來作版本的管理。定期做的快照，留下來的版本很可能是無意義的，你也無法針對特定檔案的特定版本作註記 or 回複... 另外自動的快照也無法選則那些檔案要進版本，那些要退出。總之一切全自動，沒有什麼好選的。很簡單，但是功能也很有限。

   不過即使如此，一般情況下也夠用了，操作也夠簡單，當作第二種保護機制也不錯。這個 solution 我也用了好一陣子...。

3. TFS (Team Foundation Server)

   老實說，連一般小型軟體開發，用到 TFS 都太肥了一點，自己的檔案管理用到這個真是太離譜了... 哈哈，因此這個 solution 只是閃過念頭而已，跟本沒實際裝起來試過。用這個方案，工具會是個大問題... 用的時後得開個 Visual Studio, SERVER 還得裝一大票軟體 (IIS, TFS, SQL + Reporting, SharePoint Team Service, AD…)

4. USB DISK + PortableApps

   其實這個算不上是個 SOLUTION，只不過順便把它列上來，待會說明用。某次無意間，同事告訴我 [PortableApps.com](http://portableapps.com/) 這個工具，它是個灌在 USB 隨身碟上面的工具 & 一些綠色軟體，有自己專用的 "開始" 選單，方便你插上隨便一台電腦，就把它當作你自己的 PC 一樣使用... 老實說還不錯用 (Y)，我就試著用一陣子，把所有個人相關的資料都移到上面了。現在的工作環境有點複雜，公司一台 PC，家裡一台 PC，偶爾還需要用 notebook 去客戶那邊簡報 (咳，就是我那台只有 8GB SSD 的 X40，正好沒地方放檔案)

   用了一陣子還不錯，不過碰到的又是很常見的問題: 檔案掉了怎辦? 備份問題? 讀寫速度問題? Flash Disk 寫入次數限制問題... 不外乎常備份，每天一份 ZIP 檔，用苦力作好版本控制…

5. USB DISK + SVN

   最後，就是現在用的方案了... 主要是補 (4) 的不足: 一般的定期 ZIP 備份就跟快照一樣，事後要追出變更其實很麻煩，每次變更想加個註解又更麻煩了。當然搭配 Visual Source Safe 這種工具，把 Working Folder 指到 USB DISK 上就可以兩全齊美了。

   不過使用便利則是另一個問題，我希望能夠找個無腦一點的工具，不需事先 check-out (lock) 的動作就可以開始編輯，改完再決定 check-in (commit) 或是 undo (revert) 的模式最好。用了 USB DISK 就是希望能拔來拔去，如果必需配合特定工具 & 要即時連上 SERVER，那就有點麻煩... 想看看，當我 USB DISK 插到 NOTEBOOK 帶到客戶那邊去，都按兩下打開 PPT 在簡報了，臨時要改幾個字，用 VSS 的話，我得關掉 PPT，打開 VSS，CHECK-OUT，打開PPT，修改...

   所以後來的首選就變成 SVN 了。SVN 因應 internet / open source project 的開發模式，採取的就跟 Microsoft 是不同的策略，就是先改再說。SVN 賭你不會多人同時編同一個檔案，就算會，也不會編同一段 code … 真的碰到就再人工處理吧。另外它支援各種不同的 protocol, 透過 internet 這種連線來使用，效能也不會很糟糕...

到目前為止，我用的就是 (5) USB DISK + SVN 這種 solution, 老實說越用越覺的它不錯 (Y)。SVN 我還是個新手，應該輪不到我來介紹他的特色吧 XD，不過我還是挑幾個特別的地方介紹一下，這些是我用它的主要原因啊...

1. 操作邏輯合適

   SVN 是 CVS 的接班人，它先天就繼承了 CVS 的特性: 就是適用 open source 的開發團隊。Open Source 的開發團隊跟一般的開發團隊有什麼差別? 一般商業開發都是正職的工作，很固定且很密集的進行開發及變更，因此像 Microsoft Solution (VSS / TFS) 那種要事先 lock 的機制會比較有效率。不過 open source project 就反過來，業餘的比例比較高，而且人都散布在世界各地，如果真正用 LOCK 的機制大概會哭出來吧...。我要改的檔案被你 LOCK 住了，不過我又不知道你是誰? 除了等就沒辦法了...。

   因此 SVN 先天就是以這樣的觀點來設計: 你先改了再說，改完就 commit 。反正只要沒人跟你改同一個檔案就沒事... 如果運氣真的不好，那這個人不要跟你改同一段 code 也沒事，直接 merge 就好... 只有真的很背的時後，有人跟你改同一段，那麼後 commit 的人就要負責處理 merge 的問題。不過機率很低嘛 (沒錯，尤其是只有我自己用的時後)，你可以不用管它...

   過去用 VSS 常碰到這種情況: 原本只是開個文件起來看 (READ)，跟本沒想要去改它，就沒有先作 check-out 的動作了。不過看到一半發現內容有誤，想要修正時... 問題就來了。以 WORD 來說，已經開起來才去 check-out 檔案的話，WORD還是會認為檔案是唯讀的... 除非你關掉 WORD 再開啟一次才有用。不過這麼一來思緒都被打斷了...。

   當然，還是一樣，正規的開發動作還可以要求，一般的文書處理要求到這樣就有點過頭了。因此 SVN 這樣的邏輯就佔了點優勢，我最常碰到的案例就是: 要出門開會，把 USB_DISK 拔出來帶走。開會過程中 (在外面，沒有網路連線) 修修改改 PPT 的內容，回到公司後直接在 NB 或是把 USB DISK 插回 PC，再用 SVN 作 commit 的動作...。

2. SERVER 的資訊跟著目錄

   有些工具 (像是 TFS)，你的工作目錄對應到那個 SERVER，是工具在維護的 (TFS 的 workspace)，這時搭配 USB DISK 可能會在不同的電腦 (可能是我的 PC，也可能是我的 NOTEBOOK，甚至是帶回家裡用)。一般把設定綁在工具上的作法就很頭痛，因為好幾台都要設成一樣的，而且 USB DISK 還有可能每次的磁碟機路逕都不大一樣...

   我用的工具是小烏龜 (TortoiseSVN)，它的設定就是在每個目錄下放個 .svn / _svn 的子目錄，檔案總管按右鍵叫出 SVN 的選單後，藏在裡面的設定就自動套上來了。這種操作模式，剛好對於我的用法 (USB_DISK) 很方便...

3. 更精確，更有效率的 "備份機制"

   現在隨身碟廠商，都很愛在商品上加一些小工具，有的有壓縮，有的有密碼保護... 不過 USB DISK 很容易掉，所以所有廠商都不會忘記附上一個備份工具。連我前面介紹的 PortableApps.com 都有附一個 ( 7-ZIP + SHELL )。不過這些備份工具都有個通病... 它就真的只是 "備份" 而已，是讓你心安的。使用時機是你自己要勤勞點，記得每天按 BACKUP。要還原回來，通常就是整支 USB DISK 的內容都還原回來了，如果你只想要還原某幾個檔，或是只要查看過去備份的某個檔，那你得點好幾下滑鼠，甚至是要把整個備份解開才看的到。

   另一個備份問題是，每次都是 FULL BACKUP ... 雖然有些工具作的比較好，有差異備份 ( PortableApps.com 就有提供 7-ZIP 的差異備份)，不過不還原還好，一旦要把舊資料撈出來也是很辛苦。當然這些並不是備份工具的錯，備份本來就是作這些事。中間有落差的地方在於 USER 需要的是一個歸檔的機制啊，除了備份也需要調閱舊的版本內容。這時版本控管工具，正好就成為 USB DISK 在 PC 上的第一線 "備份資料庫" 了。當你在 check-in / commit 時，不自覺的就在版本系統內放了一份備份了，不放心的人可以再啟用像 VSS (Volume Shadow Copy Service) 或是定期壓 ZIP 這類一般的備份機制作第二層保護，就很足夠了。

   這裡的重點倒不是備份安不安全啦，而是這樣的操作方式，很自然的就會在 SVN Repository 內留下一份內容，同時也方便你替這個版本作註記，未來要調閱，甚至是比對內容差異都很容易...

4. 異地存取

   USB DISK 雖然很方便，也可以隨身攜帶，但是我就是會常常忘掉它... 常常忘了拔就出門... 在外面如果還要存取我的 USB DISK 的內容，有網路的話，版本控制系統也很好用。我用的 SVN SERVER 是 Visual SVN，它就有個很簡易的 WEB 介面，真的忘了帶還可以連回我自己的 PC，把檔案下載回來。

   如果用的電腦有灌 SVN CLIENT，那你還可以做些基本的操作...。這套比起來就比 VSS 強的多。VSS 完全是 file system base, 透過遠端的操作必需先用網芳之類模擬 file I/O 的方式，效能很糟糕... 雖然 2003 年左右 Microsoft 替 VSS 加其了很多功能，像是 LAN Boost Service (我搞不懂它怎麼做的)，或是替 VSS 加上 Web Service Interface (可以透過 HTTP)，不過效果都不盡理想。

這些功能加一加，就是我現在在用的個人檔案管理方案了啦。家裡有台現成 SERVER，很多問題就更好解了。這套作法正好给有需要的人參考看看，如果你用了有什麼心得，或是有其它更好的用法也歡迎分享 :D
